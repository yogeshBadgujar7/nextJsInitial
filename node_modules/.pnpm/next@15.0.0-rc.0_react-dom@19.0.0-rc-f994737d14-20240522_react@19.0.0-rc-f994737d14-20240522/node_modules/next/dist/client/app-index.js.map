{"version":3,"sources":["../../src/client/app-index.tsx"],"sourcesContent":["import '../build/polyfills/polyfill-module'\n// @ts-ignore react-dom/client exists when using React 18\nimport ReactDOMClient from 'react-dom/client'\nimport React, { use } from 'react'\n// @ts-ignore\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { createFromReadableStream } from 'react-server-dom-webpack/client'\n\nimport { HeadManagerContext } from '../shared/lib/head-manager-context.shared-runtime'\nimport { onRecoverableError } from './on-recoverable-error'\nimport { callServer } from './app-call-server'\nimport { isNextRouterError } from './components/is-next-router-error'\nimport {\n  ActionQueueContext,\n  createMutableActionQueue,\n} from '../shared/lib/router/action-queue'\nimport { HMR_ACTIONS_SENT_TO_BROWSER } from '../server/dev/hot-reloader-types'\n\n// Since React doesn't call onerror for errors caught in error boundaries.\nconst origConsoleError = window.console.error\nwindow.console.error = (...args) => {\n  // See https://github.com/facebook/react/blob/d50323eb845c5fde0d720cae888bf35dedd05506/packages/react-reconciler/src/ReactFiberErrorLogger.js#L78\n  if (\n    process.env.NODE_ENV !== 'production'\n      ? isNextRouterError(args[1])\n      : isNextRouterError(args[0])\n  ) {\n    return\n  }\n  origConsoleError.apply(window.console, args)\n}\n\nwindow.addEventListener('error', (ev: WindowEventMap['error']): void => {\n  if (isNextRouterError(ev.error)) {\n    ev.preventDefault()\n    return\n  }\n})\n\n/// <reference types=\"react-dom/experimental\" />\n\nconst appElement: HTMLElement | Document | null = document\n\nconst encoder = new TextEncoder()\n\nlet initialServerDataBuffer: string[] | undefined = undefined\nlet initialServerDataWriter: ReadableStreamDefaultController | undefined =\n  undefined\nlet initialServerDataLoaded = false\nlet initialServerDataFlushed = false\n\nlet initialFormStateData: null | any = null\n\nfunction nextServerDataCallback(\n  seg:\n    | [isBootStrap: 0]\n    | [isNotBootstrap: 1, responsePartial: string]\n    | [isFormState: 2, formState: any]\n): void {\n  if (seg[0] === 0) {\n    initialServerDataBuffer = []\n  } else if (seg[0] === 1) {\n    if (!initialServerDataBuffer)\n      throw new Error('Unexpected server data: missing bootstrap script.')\n\n    if (initialServerDataWriter) {\n      initialServerDataWriter.enqueue(encoder.encode(seg[1]))\n    } else {\n      initialServerDataBuffer.push(seg[1])\n    }\n  } else if (seg[0] === 2) {\n    initialFormStateData = seg[1]\n  }\n}\n\n// There might be race conditions between `nextServerDataRegisterWriter` and\n// `DOMContentLoaded`. The former will be called when React starts to hydrate\n// the root, the latter will be called when the DOM is fully loaded.\n// For streaming, the former is called first due to partial hydration.\n// For non-streaming, the latter can be called first.\n// Hence, we use two variables `initialServerDataLoaded` and\n// `initialServerDataFlushed` to make sure the writer will be closed and\n// `initialServerDataBuffer` will be cleared in the right time.\nfunction nextServerDataRegisterWriter(ctr: ReadableStreamDefaultController) {\n  if (initialServerDataBuffer) {\n    initialServerDataBuffer.forEach((val) => {\n      ctr.enqueue(encoder.encode(val))\n    })\n    if (initialServerDataLoaded && !initialServerDataFlushed) {\n      ctr.close()\n      initialServerDataFlushed = true\n      initialServerDataBuffer = undefined\n    }\n  }\n\n  initialServerDataWriter = ctr\n}\n\n// When `DOMContentLoaded`, we can close all pending writers to finish hydration.\nconst DOMContentLoaded = function () {\n  if (initialServerDataWriter && !initialServerDataFlushed) {\n    initialServerDataWriter.close()\n    initialServerDataFlushed = true\n    initialServerDataBuffer = undefined\n  }\n  initialServerDataLoaded = true\n}\n// It's possible that the DOM is already loaded.\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', DOMContentLoaded, false)\n} else {\n  DOMContentLoaded()\n}\n\nconst nextServerDataLoadingGlobal = ((self as any).__next_f =\n  (self as any).__next_f || [])\nnextServerDataLoadingGlobal.forEach(nextServerDataCallback)\nnextServerDataLoadingGlobal.push = nextServerDataCallback\n\nconst readable = new ReadableStream({\n  start(controller) {\n    nextServerDataRegisterWriter(controller)\n  },\n})\n\nconst initialServerResponse = createFromReadableStream(readable, {\n  callServer,\n})\n\nfunction ServerRoot(): React.ReactNode {\n  return use(initialServerResponse)\n}\n\nconst StrictModeIfEnabled = process.env.__NEXT_STRICT_MODE_APP\n  ? React.StrictMode\n  : React.Fragment\n\nfunction Root({ children }: React.PropsWithChildren<{}>) {\n  if (process.env.__NEXT_TEST_MODE) {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useEffect(() => {\n      window.__NEXT_HYDRATED = true\n      window.__NEXT_HYDRATED_CB?.()\n    }, [])\n  }\n\n  return children\n}\n\nexport function hydrate() {\n  const actionQueue = createMutableActionQueue()\n\n  const reactEl = (\n    <StrictModeIfEnabled>\n      <HeadManagerContext.Provider value={{ appDir: true }}>\n        <ActionQueueContext.Provider value={actionQueue}>\n          <Root>\n            <ServerRoot />\n          </Root>\n        </ActionQueueContext.Provider>\n      </HeadManagerContext.Provider>\n    </StrictModeIfEnabled>\n  )\n\n  const rootLayoutMissingTags = window.__next_root_layout_missing_tags\n  const hasMissingTags = !!rootLayoutMissingTags?.length\n\n  const options = {\n    onRecoverableError,\n  } satisfies ReactDOMClient.RootOptions\n  const isError =\n    document.documentElement.id === '__next_error__' || hasMissingTags\n\n  if (process.env.NODE_ENV !== 'production') {\n    // Patch console.error to collect information about hydration errors\n    const patchConsoleError =\n      require('./components/react-dev-overlay/internal/helpers/hydration-error-info')\n        .patchConsoleError as typeof import('./components/react-dev-overlay/internal/helpers/hydration-error-info').patchConsoleError\n    if (!isError) {\n      patchConsoleError()\n    }\n  }\n\n  if (isError) {\n    if (process.env.NODE_ENV !== 'production') {\n      // if an error is thrown while rendering an RSC stream, this will catch it in dev\n      // and show the error overlay\n      const ReactDevOverlay: typeof import('./components/react-dev-overlay/app/ReactDevOverlay').default =\n        require('./components/react-dev-overlay/app/ReactDevOverlay')\n          .default as typeof import('./components/react-dev-overlay/app/ReactDevOverlay').default\n\n      const INITIAL_OVERLAY_STATE: typeof import('./components/react-dev-overlay/shared').INITIAL_OVERLAY_STATE =\n        require('./components/react-dev-overlay/shared').INITIAL_OVERLAY_STATE\n\n      const getSocketUrl: typeof import('./components/react-dev-overlay/internal/helpers/get-socket-url').getSocketUrl =\n        require('./components/react-dev-overlay/internal/helpers/get-socket-url')\n          .getSocketUrl as typeof import('./components/react-dev-overlay/internal/helpers/get-socket-url').getSocketUrl\n\n      const FallbackLayout = hasMissingTags\n        ? ({ children }: { children: React.ReactNode }) => (\n            <html id=\"__next_error__\">\n              <body>{children}</body>\n            </html>\n          )\n        : React.Fragment\n      const errorTree = (\n        <FallbackLayout>\n          <ReactDevOverlay\n            state={{ ...INITIAL_OVERLAY_STATE, rootLayoutMissingTags }}\n            onReactError={() => {}}\n          >\n            {reactEl}\n          </ReactDevOverlay>\n        </FallbackLayout>\n      )\n      const socketUrl = getSocketUrl(process.env.__NEXT_ASSET_PREFIX || '')\n      const socket = new window.WebSocket(`${socketUrl}/_next/webpack-hmr`)\n\n      // add minimal \"hot reload\" support for RSC errors\n      const handler = (event: MessageEvent) => {\n        let obj\n        try {\n          obj = JSON.parse(event.data)\n        } catch {}\n\n        if (!obj || !('action' in obj)) {\n          return\n        }\n\n        if (\n          obj.action === HMR_ACTIONS_SENT_TO_BROWSER.SERVER_COMPONENT_CHANGES\n        ) {\n          window.location.reload()\n        }\n      }\n\n      socket.addEventListener('message', handler)\n      ReactDOMClient.createRoot(appElement as any, options).render(errorTree)\n    } else {\n      ReactDOMClient.createRoot(appElement as any, options).render(reactEl)\n    }\n  } else {\n    React.startTransition(() =>\n      (ReactDOMClient as any).hydrateRoot(appElement, reactEl, {\n        ...options,\n        formState: initialFormStateData,\n      })\n    )\n  }\n\n  // TODO-APP: Remove this logic when Float has GC built-in in development.\n  if (process.env.NODE_ENV !== 'production') {\n    const { linkGc } =\n      require('./app-link-gc') as typeof import('./app-link-gc')\n    linkGc()\n  }\n}\n"],"names":["hydrate","origConsoleError","window","console","error","args","process","env","NODE_ENV","isNextRouterError","apply","addEventListener","ev","preventDefault","appElement","document","encoder","TextEncoder","initialServerDataBuffer","undefined","initialServerDataWriter","initialServerDataLoaded","initialServerDataFlushed","initialFormStateData","nextServerDataCallback","seg","Error","enqueue","encode","push","nextServerDataRegisterWriter","ctr","forEach","val","close","DOMContentLoaded","readyState","nextServerDataLoadingGlobal","self","__next_f","readable","ReadableStream","start","controller","initialServerResponse","createFromReadableStream","callServer","ServerRoot","use","StrictModeIfEnabled","__NEXT_STRICT_MODE_APP","React","StrictMode","Fragment","Root","children","__NEXT_TEST_MODE","useEffect","__NEXT_HYDRATED","__NEXT_HYDRATED_CB","actionQueue","createMutableActionQueue","reactEl","HeadManagerContext","Provider","value","appDir","ActionQueueContext","rootLayoutMissingTags","__next_root_layout_missing_tags","hasMissingTags","length","options","onRecoverableError","isError","documentElement","id","patchConsoleError","require","ReactDevOverlay","default","INITIAL_OVERLAY_STATE","getSocketUrl","FallbackLayout","html","body","errorTree","state","onReactError","socketUrl","__NEXT_ASSET_PREFIX","socket","WebSocket","handler","event","obj","JSON","parse","data","action","HMR_ACTIONS_SENT_TO_BROWSER","SERVER_COMPONENT_CHANGES","location","reload","ReactDOMClient","createRoot","render","startTransition","hydrateRoot","formState","linkGc"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}