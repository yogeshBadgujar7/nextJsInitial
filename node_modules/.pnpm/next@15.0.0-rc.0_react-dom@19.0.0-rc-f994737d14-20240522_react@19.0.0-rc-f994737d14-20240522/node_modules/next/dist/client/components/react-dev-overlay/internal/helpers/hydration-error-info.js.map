{"version":3,"sources":["../../../../../../src/client/components/react-dev-overlay/internal/helpers/hydration-error-info.ts"],"sourcesContent":["import { getHydrationErrorStackInfo } from '../../../is-hydration-error'\n\nexport type HydrationErrorState = {\n  // Hydration warning template format: <message> <serverContent> <clientContent>\n  warning?: [string, string, string]\n  componentStack?: string\n  serverContent?: string\n  clientContent?: string\n  // React 19 hydration diff format: <notes> <link> <component diff?>\n  notes?: string\n  reactOutputComponentDiff?: string\n}\n\ntype NullableText = string | null | undefined\n\nexport const hydrationErrorState: HydrationErrorState = {}\n\n// https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMHydrationDiff-test.js used as a reference\nconst htmlTagsWarnings = new Set([\n  'Warning: Cannot render a sync or defer <script> outside the main document without knowing its order. Try adding async=\"\" or moving it into the root <head> tag.%s',\n  'Warning: In HTML, %s cannot be a child of <%s>.%s\\nThis will cause a hydration error.%s',\n  'Warning: In HTML, %s cannot be a descendant of <%s>.\\nThis will cause a hydration error.%s',\n  'Warning: In HTML, text nodes cannot be a child of <%s>.\\nThis will cause a hydration error.',\n  \"Warning: In HTML, whitespace text nodes cannot be a child of <%s>. Make sure you don't have any extra whitespace between tags on each line of your source code.\\nThis will cause a hydration error.\",\n  'Warning: Expected server HTML to contain a matching <%s> in <%s>.%s',\n  'Warning: Did not expect server HTML to contain a <%s> in <%s>.%s',\n])\nconst textAndTagsMismatchWarnings = new Set([\n  'Warning: Expected server HTML to contain a matching text node for \"%s\" in <%s>.%s',\n  'Warning: Did not expect server HTML to contain the text node \"%s\" in <%s>.%s',\n])\nconst textMismatchWarning =\n  'Warning: Text content did not match. Server: \"%s\" Client: \"%s\"%s'\n\nexport const getHydrationWarningType = (\n  msg: NullableText\n): 'tag' | 'text' | 'text-in-tag' => {\n  if (isHtmlTagsWarning(msg)) return 'tag'\n  if (isTextInTagsMismatchWarning(msg)) return 'text-in-tag'\n  return 'text'\n}\n\nconst isHtmlTagsWarning = (msg: NullableText) =>\n  Boolean(msg && htmlTagsWarnings.has(msg))\n\nconst isTextMismatchWarning = (msg: NullableText) => textMismatchWarning === msg\nconst isTextInTagsMismatchWarning = (msg: NullableText) =>\n  Boolean(msg && textAndTagsMismatchWarnings.has(msg))\n\nconst isKnownHydrationWarning = (msg: NullableText) =>\n  isHtmlTagsWarning(msg) ||\n  isTextInTagsMismatchWarning(msg) ||\n  isTextMismatchWarning(msg)\n\nexport const getReactHydrationDiffSegments = (msg: NullableText) => {\n  if (msg) {\n    const { message, diff } = getHydrationErrorStackInfo(msg)\n    if (message) return [message, diff]\n  }\n  return undefined\n}\n\n/**\n * Patch console.error to capture hydration errors.\n * If any of the knownHydrationWarnings are logged, store the message and component stack.\n * When the hydration runtime error is thrown, the message and component stack are added to the error.\n * This results in a more helpful error message in the error overlay.\n */\nexport function patchConsoleError() {\n  const prev = console.error\n  console.error = function (msg, serverContent, clientContent, componentStack) {\n    if (isKnownHydrationWarning(msg)) {\n      hydrationErrorState.warning = [\n        // remove the last %s from the message\n        msg,\n        serverContent,\n        clientContent,\n      ]\n      hydrationErrorState.componentStack = componentStack\n      hydrationErrorState.serverContent = serverContent\n      hydrationErrorState.clientContent = clientContent\n    }\n\n    // @ts-expect-error argument is defined\n    prev.apply(console, arguments)\n  }\n}\n"],"names":["getHydrationWarningType","getReactHydrationDiffSegments","hydrationErrorState","patchConsoleError","htmlTagsWarnings","Set","textAndTagsMismatchWarnings","textMismatchWarning","msg","isHtmlTagsWarning","isTextInTagsMismatchWarning","Boolean","has","isTextMismatchWarning","isKnownHydrationWarning","message","diff","getHydrationErrorStackInfo","undefined","prev","console","error","serverContent","clientContent","componentStack","warning","apply","arguments"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;;;;;;;IAkCaA,uBAAuB;eAAvBA;;IAoBAC,6BAA6B;eAA7BA;;IAvCAC,mBAAmB;eAAnBA;;IAqDGC,iBAAiB;eAAjBA;;;kCApE2B;AAepC,MAAMD,sBAA2C,CAAC;AAEzD,iIAAiI;AACjI,MAAME,mBAAmB,IAAIC,IAAI;IAC/B;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AACD,MAAMC,8BAA8B,IAAID,IAAI;IAC1C;IACA;CACD;AACD,MAAME,sBACJ;AAEK,MAAMP,0BAA0B,CACrCQ;IAEA,IAAIC,kBAAkBD,MAAM,OAAO;IACnC,IAAIE,4BAA4BF,MAAM,OAAO;IAC7C,OAAO;AACT;AAEA,MAAMC,oBAAoB,CAACD,MACzBG,QAAQH,OAAOJ,iBAAiBQ,GAAG,CAACJ;AAEtC,MAAMK,wBAAwB,CAACL,MAAsBD,wBAAwBC;AAC7E,MAAME,8BAA8B,CAACF,MACnCG,QAAQH,OAAOF,4BAA4BM,GAAG,CAACJ;AAEjD,MAAMM,0BAA0B,CAACN,MAC/BC,kBAAkBD,QAClBE,4BAA4BF,QAC5BK,sBAAsBL;AAEjB,MAAMP,gCAAgC,CAACO;IAC5C,IAAIA,KAAK;QACP,MAAM,EAAEO,OAAO,EAAEC,IAAI,EAAE,GAAGC,IAAAA,4CAA0B,EAACT;QACrD,IAAIO,SAAS,OAAO;YAACA;YAASC;SAAK;IACrC;IACA,OAAOE;AACT;AAQO,SAASf;IACd,MAAMgB,OAAOC,QAAQC,KAAK;IAC1BD,QAAQC,KAAK,GAAG,SAAUb,GAAG,EAAEc,aAAa,EAAEC,aAAa,EAAEC,cAAc;QACzE,IAAIV,wBAAwBN,MAAM;YAChCN,oBAAoBuB,OAAO,GAAG;gBAC5B,sCAAsC;gBACtCjB;gBACAc;gBACAC;aACD;YACDrB,oBAAoBsB,cAAc,GAAGA;YACrCtB,oBAAoBoB,aAAa,GAAGA;YACpCpB,oBAAoBqB,aAAa,GAAGA;QACtC;QAEA,uCAAuC;QACvCJ,KAAKO,KAAK,CAACN,SAASO;IACtB;AACF"}