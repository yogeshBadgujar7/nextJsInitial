{"version":3,"sources":["../../../src/lib/metadata/is-metadata-route.ts"],"sourcesContent":["import type { PageExtensions } from '../../build/page-extensions-type'\nimport { normalizePathSep } from '../../shared/lib/page-path/normalize-path-sep'\n\nexport const STATIC_METADATA_IMAGES = {\n  icon: {\n    filename: 'icon',\n    extensions: ['ico', 'jpg', 'jpeg', 'png', 'svg'],\n  },\n  apple: {\n    filename: 'apple-icon',\n    extensions: ['jpg', 'jpeg', 'png'],\n  },\n  favicon: {\n    filename: 'favicon',\n    extensions: ['ico'],\n  },\n  openGraph: {\n    filename: 'opengraph-image',\n    extensions: ['jpg', 'jpeg', 'png', 'gif'],\n  },\n  twitter: {\n    filename: 'twitter-image',\n    extensions: ['jpg', 'jpeg', 'png', 'gif'],\n  },\n} as const\n\n// Match routes that are metadata routes, e.g. /sitemap.xml, /favicon.<ext>, /<icon>.<ext>, etc.\n// TODO-METADATA: support more metadata routes with more extensions\nconst defaultExtensions = ['js', 'jsx', 'ts', 'tsx']\n\nconst getExtensionRegexString = (extensions: readonly string[]) =>\n  `(?:${extensions.join('|')})`\n\n// When you only pass the file extension as `[]`, it will only match the static convention files\n// e.g. /robots.txt, /sitemap.xml, /favicon.ico, /manifest.json\n// When you pass the file extension as `['js', 'jsx', 'ts', 'tsx']`, it will also match the dynamic convention files\n// e.g. /robots.js, /sitemap.tsx, /favicon.jsx, /manifest.ts\n// When `withExtension` is false, it will match the static convention files without the extension, by default it's true\n// e.g. /robots, /sitemap, /favicon, /manifest, use to match dynamic API routes like app/robots.ts\nexport function isMetadataRouteFile(\n  appDirRelativePath: string,\n  pageExtensions: PageExtensions,\n  withExtension: boolean\n) {\n  const metadataRouteFilesRegex = [\n    new RegExp(\n      `^[\\\\\\\\/]robots${\n        withExtension\n          ? `\\\\.${getExtensionRegexString(pageExtensions.concat('txt'))}$`\n          : ''\n      }`\n    ),\n    new RegExp(\n      `^[\\\\\\\\/]manifest${\n        withExtension\n          ? `\\\\.${getExtensionRegexString(\n              pageExtensions.concat('webmanifest', 'json')\n            )}$`\n          : ''\n      }`\n    ),\n    new RegExp(`^[\\\\\\\\/]favicon\\\\.ico$`),\n    new RegExp(\n      `[\\\\\\\\/]sitemap${\n        withExtension\n          ? `\\\\.${getExtensionRegexString(pageExtensions.concat('xml'))}$`\n          : ''\n      }`\n    ),\n    new RegExp(\n      `[\\\\\\\\/]${STATIC_METADATA_IMAGES.icon.filename}\\\\d?${\n        withExtension\n          ? `\\\\.${getExtensionRegexString(\n              pageExtensions.concat(STATIC_METADATA_IMAGES.icon.extensions)\n            )}$`\n          : ''\n      }`\n    ),\n    new RegExp(\n      `[\\\\\\\\/]${STATIC_METADATA_IMAGES.apple.filename}\\\\d?${\n        withExtension\n          ? `\\\\.${getExtensionRegexString(\n              pageExtensions.concat(STATIC_METADATA_IMAGES.apple.extensions)\n            )}$`\n          : ''\n      }`\n    ),\n    new RegExp(\n      `[\\\\\\\\/]${STATIC_METADATA_IMAGES.openGraph.filename}\\\\d?${\n        withExtension\n          ? `\\\\.${getExtensionRegexString(\n              pageExtensions.concat(STATIC_METADATA_IMAGES.openGraph.extensions)\n            )}$`\n          : ''\n      }`\n    ),\n    new RegExp(\n      `[\\\\\\\\/]${STATIC_METADATA_IMAGES.twitter.filename}\\\\d?${\n        withExtension\n          ? `\\\\.${getExtensionRegexString(\n              pageExtensions.concat(STATIC_METADATA_IMAGES.twitter.extensions)\n            )}$`\n          : ''\n      }`\n    ),\n  ]\n\n  const normalizedAppDirRelativePath = normalizePathSep(appDirRelativePath)\n  return metadataRouteFilesRegex.some((r) =>\n    r.test(normalizedAppDirRelativePath)\n  )\n}\n\nexport function isStaticMetadataRouteFile(appDirRelativePath: string) {\n  return isMetadataRouteFile(appDirRelativePath, [], true)\n}\n\nexport function isStaticMetadataRoute(page: string) {\n  return (\n    page === '/robots' ||\n    page === '/manifest' ||\n    isStaticMetadataRouteFile(page)\n  )\n}\n\n/*\n * Remove the 'app' prefix or '/route' suffix, only check the route name since they're only allowed in root app directory\n * e.g.\n * /app/robots -> /robots\n * app/robots -> /robots\n * /robots -> /robots\n */\nexport function isMetadataRoute(route: string): boolean {\n  let page = route.replace(/^\\/?app\\//, '').replace(/\\/route$/, '')\n  if (page[0] !== '/') page = '/' + page\n\n  return (\n    !page.endsWith('/page') &&\n    isMetadataRouteFile(page, defaultExtensions, false)\n  )\n}\n"],"names":["STATIC_METADATA_IMAGES","isMetadataRoute","isMetadataRouteFile","isStaticMetadataRoute","isStaticMetadataRouteFile","icon","filename","extensions","apple","favicon","openGraph","twitter","defaultExtensions","getExtensionRegexString","join","appDirRelativePath","pageExtensions","withExtension","metadataRouteFilesRegex","RegExp","concat","normalizedAppDirRelativePath","normalizePathSep","some","r","test","page","route","replace","endsWith"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}