{"version":3,"sources":["../../../src/server/response-cache/utils.ts"],"sourcesContent":["import type { IncrementalCacheItem, ResponseCacheEntry } from './types'\n\nimport RenderResult from '../render-result'\n\nexport async function fromResponseCacheEntry(\n  cacheEntry: ResponseCacheEntry\n): Promise<IncrementalCacheItem> {\n  return {\n    ...cacheEntry,\n    value:\n      cacheEntry.value?.kind === 'PAGE'\n        ? {\n            kind: 'PAGE',\n            html: await cacheEntry.value.html.toUnchunkedString(true),\n            postponed: cacheEntry.value.postponed,\n            pageData: cacheEntry.value.pageData,\n            headers: cacheEntry.value.headers,\n            status: cacheEntry.value.status,\n          }\n        : cacheEntry.value,\n  }\n}\n\nexport async function toResponseCacheEntry(\n  response: IncrementalCacheItem\n): Promise<ResponseCacheEntry | null> {\n  if (!response) return null\n\n  if (response.value?.kind === 'FETCH') {\n    throw new Error(\n      'Invariant: unexpected cachedResponse of kind fetch in response cache'\n    )\n  }\n\n  return {\n    isMiss: response.isMiss,\n    isStale: response.isStale,\n    revalidate: response.revalidate,\n    value:\n      response.value?.kind === 'PAGE'\n        ? {\n            kind: 'PAGE',\n            html: RenderResult.fromStatic(response.value.html),\n            pageData: response.value.pageData,\n            postponed: response.value.postponed,\n            headers: response.value.headers,\n            status: response.value.status,\n          }\n        : response.value,\n  }\n}\n"],"names":["RenderResult","fromResponseCacheEntry","cacheEntry","value","kind","html","toUnchunkedString","postponed","pageData","headers","status","toResponseCacheEntry","response","Error","isMiss","isStale","revalidate","fromStatic"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAEA,OAAOA,kBAAkB,mBAAkB;AAE3C,OAAO,eAAeC,uBACpBC,UAA8B;QAK1BA;IAHJ,OAAO;QACL,GAAGA,UAAU;QACbC,OACED,EAAAA,oBAAAA,WAAWC,KAAK,qBAAhBD,kBAAkBE,IAAI,MAAK,SACvB;YACEA,MAAM;YACNC,MAAM,MAAMH,WAAWC,KAAK,CAACE,IAAI,CAACC,iBAAiB,CAAC;YACpDC,WAAWL,WAAWC,KAAK,CAACI,SAAS;YACrCC,UAAUN,WAAWC,KAAK,CAACK,QAAQ;YACnCC,SAASP,WAAWC,KAAK,CAACM,OAAO;YACjCC,QAAQR,WAAWC,KAAK,CAACO,MAAM;QACjC,IACAR,WAAWC,KAAK;IACxB;AACF;AAEA,OAAO,eAAeQ,qBACpBC,QAA8B;QAI1BA,iBAWAA;IAbJ,IAAI,CAACA,UAAU,OAAO;IAEtB,IAAIA,EAAAA,kBAAAA,SAAST,KAAK,qBAAdS,gBAAgBR,IAAI,MAAK,SAAS;QACpC,MAAM,IAAIS,MACR;IAEJ;IAEA,OAAO;QACLC,QAAQF,SAASE,MAAM;QACvBC,SAASH,SAASG,OAAO;QACzBC,YAAYJ,SAASI,UAAU;QAC/Bb,OACES,EAAAA,mBAAAA,SAAST,KAAK,qBAAdS,iBAAgBR,IAAI,MAAK,SACrB;YACEA,MAAM;YACNC,MAAML,aAAaiB,UAAU,CAACL,SAAST,KAAK,CAACE,IAAI;YACjDG,UAAUI,SAAST,KAAK,CAACK,QAAQ;YACjCD,WAAWK,SAAST,KAAK,CAACI,SAAS;YACnCE,SAASG,SAAST,KAAK,CAACM,OAAO;YAC/BC,QAAQE,SAAST,KAAK,CAACO,MAAM;QAC/B,IACAE,SAAST,KAAK;IACtB;AACF"}