{"version":3,"sources":["../../../../src/server/lib/server-ipc/invoke-request.ts"],"sourcesContent":["import type { IncomingMessage } from 'http'\nimport type { Readable } from 'stream'\nimport { filterReqHeaders, ipcForbiddenHeaders } from './utils'\n\nexport const invokeRequest = async (\n  targetUrl: string,\n  requestInit: {\n    headers: IncomingMessage['headers']\n    method: IncomingMessage['method']\n    signal?: AbortSignal\n  },\n  readableBody?: string | Readable | ReadableStream\n) => {\n  const invokeHeaders = filterReqHeaders(\n    {\n      'cache-control': '',\n      ...requestInit.headers,\n    },\n    ipcForbiddenHeaders\n  ) as IncomingMessage['headers']\n\n  return await fetch(targetUrl, {\n    headers: invokeHeaders as any as Headers,\n    method: requestInit.method,\n    redirect: 'manual',\n    signal: requestInit.signal,\n\n    ...(requestInit.method !== 'GET' &&\n    requestInit.method !== 'HEAD' &&\n    readableBody\n      ? {\n          body: readableBody as BodyInit,\n          duplex: 'half',\n        }\n      : {}),\n\n    next: {\n      // @ts-ignore\n      internal: true,\n    },\n  })\n}\n"],"names":["filterReqHeaders","ipcForbiddenHeaders","invokeRequest","targetUrl","requestInit","readableBody","invokeHeaders","headers","fetch","method","redirect","signal","body","duplex","next","internal"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;","mappings":"AAEA,SAASA,gBAAgB,EAAEC,mBAAmB,QAAQ,UAAS;AAE/D,OAAO,MAAMC,gBAAgB,OAC3BC,WACAC,aAKAC;IAEA,MAAMC,gBAAgBN,iBACpB;QACE,iBAAiB;QACjB,GAAGI,YAAYG,OAAO;IACxB,GACAN;IAGF,OAAO,MAAMO,MAAML,WAAW;QAC5BI,SAASD;QACTG,QAAQL,YAAYK,MAAM;QAC1BC,UAAU;QACVC,QAAQP,YAAYO,MAAM;QAE1B,GAAIP,YAAYK,MAAM,KAAK,SAC3BL,YAAYK,MAAM,KAAK,UACvBJ,eACI;YACEO,MAAMP;YACNQ,QAAQ;QACV,IACA,CAAC,CAAC;QAENC,MAAM;YACJ,aAAa;YACbC,UAAU;QACZ;IACF;AACF,EAAC"}