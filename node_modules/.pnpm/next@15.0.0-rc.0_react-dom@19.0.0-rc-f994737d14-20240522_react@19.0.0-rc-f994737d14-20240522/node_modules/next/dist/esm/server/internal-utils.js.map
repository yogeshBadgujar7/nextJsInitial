{"version":3,"sources":["../../src/server/internal-utils.ts"],"sourcesContent":["import type { IncomingHttpHeaders } from 'http'\nimport type { NextParsedUrlQuery } from './request-meta'\n\nimport { NEXT_RSC_UNION_QUERY } from '../client/components/app-router-headers'\nimport { INTERNAL_HEADERS } from '../shared/lib/constants'\n\nconst INTERNAL_QUERY_NAMES = [\n  '__nextFallback',\n  '__nextLocale',\n  '__nextInferredLocaleFromDefault',\n  '__nextDefaultLocale',\n  '__nextIsNotFound',\n  NEXT_RSC_UNION_QUERY,\n] as const\n\nconst EDGE_EXTENDED_INTERNAL_QUERY_NAMES = ['__nextDataReq'] as const\n\nexport function stripInternalQueries(query: NextParsedUrlQuery) {\n  for (const name of INTERNAL_QUERY_NAMES) {\n    delete query[name]\n  }\n}\n\nexport function stripInternalSearchParams<T extends string | URL>(\n  url: T,\n  isEdge: boolean\n): T {\n  const isStringUrl = typeof url === 'string'\n  const instance = isStringUrl ? new URL(url) : (url as URL)\n  for (const name of INTERNAL_QUERY_NAMES) {\n    instance.searchParams.delete(name)\n  }\n\n  if (isEdge) {\n    for (const name of EDGE_EXTENDED_INTERNAL_QUERY_NAMES) {\n      instance.searchParams.delete(name)\n    }\n  }\n\n  return (isStringUrl ? instance.toString() : instance) as T\n}\n\n/**\n * Strip internal headers from the request headers.\n *\n * @param headers the headers to strip of internal headers\n */\nexport function stripInternalHeaders(headers: IncomingHttpHeaders) {\n  for (const key of INTERNAL_HEADERS) {\n    delete headers[key]\n  }\n}\n"],"names":["NEXT_RSC_UNION_QUERY","INTERNAL_HEADERS","INTERNAL_QUERY_NAMES","EDGE_EXTENDED_INTERNAL_QUERY_NAMES","stripInternalQueries","query","name","stripInternalSearchParams","url","isEdge","isStringUrl","instance","URL","searchParams","delete","toString","stripInternalHeaders","headers","key"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAGA,SAASA,oBAAoB,QAAQ,0CAAyC;AAC9E,SAASC,gBAAgB,QAAQ,0BAAyB;AAE1D,MAAMC,uBAAuB;IAC3B;IACA;IACA;IACA;IACA;IACAF;CACD;AAED,MAAMG,qCAAqC;IAAC;CAAgB;AAE5D,OAAO,SAASC,qBAAqBC,KAAyB;IAC5D,KAAK,MAAMC,QAAQJ,qBAAsB;QACvC,OAAOG,KAAK,CAACC,KAAK;IACpB;AACF;AAEA,OAAO,SAASC,0BACdC,GAAM,EACNC,MAAe;IAEf,MAAMC,cAAc,OAAOF,QAAQ;IACnC,MAAMG,WAAWD,cAAc,IAAIE,IAAIJ,OAAQA;IAC/C,KAAK,MAAMF,QAAQJ,qBAAsB;QACvCS,SAASE,YAAY,CAACC,MAAM,CAACR;IAC/B;IAEA,IAAIG,QAAQ;QACV,KAAK,MAAMH,QAAQH,mCAAoC;YACrDQ,SAASE,YAAY,CAACC,MAAM,CAACR;QAC/B;IACF;IAEA,OAAQI,cAAcC,SAASI,QAAQ,KAAKJ;AAC9C;AAEA;;;;CAIC,GACD,OAAO,SAASK,qBAAqBC,OAA4B;IAC/D,KAAK,MAAMC,OAAOjB,iBAAkB;QAClC,OAAOgB,OAAO,CAACC,IAAI;IACrB;AACF"}