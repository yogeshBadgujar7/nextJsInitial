{"version":3,"sources":["../../src/build/index.ts"],"sourcesContent":["import type { AppBuildManifest } from './webpack/plugins/app-build-manifest-plugin'\nimport type { PagesManifest } from './webpack/plugins/pages-manifest-plugin'\nimport type { ExportPathMap, NextConfigComplete } from '../server/config-shared'\nimport type { MiddlewareManifest } from './webpack/plugins/middleware-plugin'\nimport type { ActionManifest } from './webpack/plugins/flight-client-entry-plugin'\nimport type { ExportAppOptions } from '../export/types'\nimport type { Revalidate } from '../server/lib/revalidate'\n\nimport '../lib/setup-exception-listeners'\n\nimport { loadEnvConfig, type LoadedEnvFiles } from '@next/env'\nimport { bold, yellow } from '../lib/picocolors'\nimport crypto from 'crypto'\nimport { makeRe } from 'next/dist/compiled/picomatch'\nimport { existsSync, promises as fs } from 'fs'\nimport os from 'os'\nimport { Worker } from '../lib/worker'\nimport { defaultConfig } from '../server/config-shared'\nimport devalue from 'next/dist/compiled/devalue'\nimport findUp from 'next/dist/compiled/find-up'\nimport { nanoid } from 'next/dist/compiled/nanoid/index.cjs'\nimport { Sema } from 'next/dist/compiled/async-sema'\nimport path from 'path'\nimport {\n  STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR,\n  PUBLIC_DIR_MIDDLEWARE_CONFLICT,\n  MIDDLEWARE_FILENAME,\n  PAGES_DIR_ALIAS,\n  INSTRUMENTATION_HOOK_FILENAME,\n  RSC_PREFETCH_SUFFIX,\n  RSC_SUFFIX,\n} from '../lib/constants'\nimport { FileType, fileExists } from '../lib/file-exists'\nimport { findPagesDir } from '../lib/find-pages-dir'\nimport loadCustomRoutes, {\n  normalizeRouteRegex,\n} from '../lib/load-custom-routes'\nimport type {\n  CustomRoutes,\n  Header,\n  Redirect,\n  Rewrite,\n  RouteHas,\n} from '../lib/load-custom-routes'\nimport { nonNullable } from '../lib/non-nullable'\nimport { recursiveDelete } from '../lib/recursive-delete'\nimport { verifyPartytownSetup } from '../lib/verify-partytown-setup'\nimport { validateTurboNextConfig } from '../lib/turbopack-warning'\nimport {\n  BUILD_ID_FILE,\n  BUILD_MANIFEST,\n  CLIENT_STATIC_FILES_PATH,\n  EXPORT_DETAIL,\n  EXPORT_MARKER,\n  AUTOMATIC_FONT_OPTIMIZATION_MANIFEST,\n  IMAGES_MANIFEST,\n  PAGES_MANIFEST,\n  PHASE_PRODUCTION_BUILD,\n  PRERENDER_MANIFEST,\n  REACT_LOADABLE_MANIFEST,\n  ROUTES_MANIFEST,\n  SERVER_DIRECTORY,\n  SERVER_FILES_MANIFEST,\n  STATIC_STATUS_PAGES,\n  MIDDLEWARE_MANIFEST,\n  APP_PATHS_MANIFEST,\n  APP_PATH_ROUTES_MANIFEST,\n  APP_BUILD_MANIFEST,\n  RSC_MODULE_TYPES,\n  NEXT_FONT_MANIFEST,\n  SUBRESOURCE_INTEGRITY_MANIFEST,\n  MIDDLEWARE_BUILD_MANIFEST,\n  MIDDLEWARE_REACT_LOADABLE_MANIFEST,\n  SERVER_REFERENCE_MANIFEST,\n  FUNCTIONS_CONFIG_MANIFEST,\n  UNDERSCORE_NOT_FOUND_ROUTE_ENTRY,\n  UNDERSCORE_NOT_FOUND_ROUTE,\n} from '../shared/lib/constants'\nimport { getSortedRoutes, isDynamicRoute } from '../shared/lib/router/utils'\nimport type { __ApiPreviewProps } from '../server/api-utils'\nimport loadConfig from '../server/config'\nimport type { BuildManifest } from '../server/get-page-files'\nimport { normalizePagePath } from '../shared/lib/page-path/normalize-page-path'\nimport { getPagePath } from '../server/require'\nimport * as ciEnvironment from '../telemetry/ci-info'\nimport {\n  turborepoTraceAccess,\n  TurborepoAccessTraceResult,\n  writeTurborepoAccessTraceResult,\n} from './turborepo-access-trace'\n\nimport {\n  eventBuildOptimize,\n  eventCliSession,\n  eventBuildFeatureUsage,\n  eventNextPlugins,\n  EVENT_BUILD_FEATURE_USAGE,\n  eventPackageUsedInGetServerSideProps,\n  eventBuildCompleted,\n} from '../telemetry/events'\nimport type { EventBuildFeatureUsage } from '../telemetry/events'\nimport { Telemetry } from '../telemetry/storage'\nimport {\n  isDynamicMetadataRoute,\n  getPageStaticInfo,\n} from './analysis/get-page-static-info'\nimport { createPagesMapping, getPageFilePath, sortByPageExts } from './entries'\nimport { PAGE_TYPES } from '../lib/page-types'\nimport { generateBuildId } from './generate-build-id'\nimport { isWriteable } from './is-writeable'\nimport * as Log from './output/log'\nimport createSpinner from './spinner'\nimport { trace, flushAllTraces, setGlobal, type Span } from '../trace'\nimport {\n  detectConflictingPaths,\n  computeFromManifest,\n  getJsPageSizeInKb,\n  printCustomRoutes,\n  printTreeView,\n  copyTracedFiles,\n  isReservedPage,\n  isAppBuiltinNotFoundPage,\n  collectRoutesUsingEdgeRuntime,\n} from './utils'\nimport type { PageInfo, PageInfos, AppConfig } from './utils'\nimport { writeBuildId } from './write-build-id'\nimport { normalizeLocalePath } from '../shared/lib/i18n/normalize-locale-path'\nimport isError from '../lib/is-error'\nimport type { NextError } from '../lib/is-error'\nimport { isEdgeRuntime } from '../lib/is-edge-runtime'\nimport { recursiveCopy } from '../lib/recursive-copy'\nimport { recursiveReadDir } from '../lib/recursive-readdir'\nimport {\n  loadBindings,\n  lockfilePatchPromise,\n  teardownTraceSubscriber,\n  teardownHeapProfiler,\n  createDefineEnv,\n} from './swc'\nimport { getNamedRouteRegex } from '../shared/lib/router/utils/route-regex'\nimport { getFilesInDir } from '../lib/get-files-in-dir'\nimport { eventSwcPlugins } from '../telemetry/events/swc-plugins'\nimport { normalizeAppPath } from '../shared/lib/router/utils/app-paths'\nimport {\n  ACTION,\n  NEXT_ROUTER_PREFETCH_HEADER,\n  RSC_HEADER,\n  RSC_CONTENT_TYPE_HEADER,\n  NEXT_ROUTER_STATE_TREE,\n  NEXT_DID_POSTPONE_HEADER,\n} from '../client/components/app-router-headers'\nimport { webpackBuild } from './webpack-build'\nimport { NextBuildContext, type MappedPages } from './build-context'\nimport { normalizePathSep } from '../shared/lib/page-path/normalize-path-sep'\nimport { isAppRouteRoute } from '../lib/is-app-route-route'\nimport { createClientRouterFilter } from '../lib/create-client-router-filter'\nimport { createValidFileMatcher } from '../server/lib/find-page-file'\nimport { startTypeChecking } from './type-check'\nimport { generateInterceptionRoutesRewrites } from '../lib/generate-interception-routes-rewrites'\n\nimport { buildDataRoute } from '../server/lib/router-utils/build-data-route'\nimport { initialize as initializeIncrementalCache } from '../server/lib/incremental-cache-server'\nimport { nodeFs } from '../server/lib/node-fs-methods'\nimport { collectBuildTraces } from './collect-build-traces'\nimport type { BuildTraceContext } from './webpack/plugins/next-trace-entrypoints-plugin'\nimport { formatManifest } from './manifests/formatter/format-manifest'\nimport { getStartServerInfo, logStartInfo } from '../server/lib/app-info-log'\nimport type { NextEnabledDirectories } from '../server/base-server'\nimport { hasCustomExportOutput } from '../export/utils'\nimport { interopDefault } from '../lib/interop-default'\nimport { formatDynamicImportPath } from '../lib/format-dynamic-import-path'\nimport { isInterceptionRouteAppPath } from '../server/future/helpers/interception-routes'\nimport {\n  getTurbopackJsConfig,\n  handleEntrypoints,\n  type EntryIssuesMap,\n  handleRouteType,\n  handlePagesErrorRoute,\n  formatIssue,\n  isRelevantWarning,\n} from '../server/dev/turbopack-utils'\nimport { TurbopackManifestLoader } from '../server/dev/turbopack/manifest-loader'\nimport type { Entrypoints } from '../server/dev/turbopack/types'\nimport { buildCustomRoute } from '../lib/build-custom-route'\nimport { createProgress } from './progress'\nimport { traceMemoryUsage } from '../lib/memory/trace'\nimport { generateEncryptionKeyBase64 } from '../server/app-render/encryption-utils'\nimport type { DeepReadonly } from '../shared/lib/deep-readonly'\nimport uploadTrace from '../trace/upload-trace'\nimport {\n  checkIsAppPPREnabled,\n  checkIsRoutePPREnabled,\n} from '../server/lib/experimental/ppr'\n\ninterface ExperimentalBypassForInfo {\n  experimentalBypassFor?: RouteHas[]\n}\n\ninterface ExperimentalPPRInfo {\n  experimentalPPR: boolean | undefined\n}\n\ninterface DataRouteRouteInfo {\n  dataRoute: string | null\n  prefetchDataRoute: string | null | undefined\n}\n\nexport interface SsgRoute\n  extends ExperimentalBypassForInfo,\n    DataRouteRouteInfo,\n    ExperimentalPPRInfo {\n  initialRevalidateSeconds: Revalidate\n  srcRoute: string | null\n  initialStatus?: number\n  initialHeaders?: Record<string, string>\n}\n\nexport interface DynamicSsgRoute\n  extends ExperimentalBypassForInfo,\n    DataRouteRouteInfo,\n    ExperimentalPPRInfo {\n  fallback: string | null | false\n  routeRegex: string\n  dataRouteRegex: string | null\n  prefetchDataRouteRegex: string | null | undefined\n}\n\nexport type PrerenderManifest = {\n  version: 4\n  routes: { [route: string]: SsgRoute }\n  dynamicRoutes: { [route: string]: DynamicSsgRoute }\n  notFoundRoutes: string[]\n  preview: __ApiPreviewProps\n}\n\ntype ManifestBuiltRoute = {\n  /**\n   * The route pattern used to match requests for this route.\n   */\n  regex: string\n}\n\nexport type ManifestRewriteRoute = ManifestBuiltRoute & Rewrite\nexport type ManifestRedirectRoute = ManifestBuiltRoute & Redirect\nexport type ManifestHeaderRoute = ManifestBuiltRoute & Header\n\nexport type ManifestRoute = ManifestBuiltRoute & {\n  page: string\n  namedRegex?: string\n  routeKeys?: { [key: string]: string }\n}\n\nexport type ManifestDataRoute = {\n  page: string\n  routeKeys?: { [key: string]: string }\n  dataRouteRegex: string\n  namedDataRouteRegex?: string\n}\n\nexport type RoutesManifest = {\n  version: number\n  pages404: boolean\n  basePath: string\n  redirects: Array<Redirect>\n  rewrites?:\n    | Array<ManifestRewriteRoute>\n    | {\n        beforeFiles: Array<ManifestRewriteRoute>\n        afterFiles: Array<ManifestRewriteRoute>\n        fallback: Array<ManifestRewriteRoute>\n      }\n  headers: Array<ManifestHeaderRoute>\n  staticRoutes: Array<ManifestRoute>\n  dynamicRoutes: Array<ManifestRoute>\n  dataRoutes: Array<ManifestDataRoute>\n  i18n?: {\n    domains?: Array<{\n      http?: true\n      domain: string\n      locales?: string[]\n      defaultLocale: string\n    }>\n    locales: string[]\n    defaultLocale: string\n    localeDetection?: false\n  }\n  rsc: {\n    header: typeof RSC_HEADER\n    didPostponeHeader: typeof NEXT_DID_POSTPONE_HEADER\n    varyHeader: string\n    prefetchHeader: typeof NEXT_ROUTER_PREFETCH_HEADER\n    suffix: typeof RSC_SUFFIX\n    prefetchSuffix: typeof RSC_PREFETCH_SUFFIX\n  }\n  skipMiddlewareUrlNormalize?: boolean\n  caseSensitive?: boolean\n}\n\nfunction pageToRoute(page: string) {\n  const routeRegex = getNamedRouteRegex(page, true)\n  return {\n    page,\n    regex: normalizeRouteRegex(routeRegex.re.source),\n    routeKeys: routeRegex.routeKeys,\n    namedRegex: routeRegex.namedRegex,\n  }\n}\n\nfunction getCacheDir(distDir: string): string {\n  const cacheDir = path.join(distDir, 'cache')\n  if (ciEnvironment.isCI && !ciEnvironment.hasNextSupport) {\n    const hasCache = existsSync(cacheDir)\n\n    if (!hasCache) {\n      // Intentionally not piping to stderr which is what `Log.warn` does in case people fail in CI when\n      // stderr is detected.\n      console.log(\n        `${Log.prefixes.warn} No build cache found. Please configure build caching for faster rebuilds. Read more: https://nextjs.org/docs/messages/no-cache`\n      )\n    }\n  }\n  return cacheDir\n}\n\nasync function writeFileUtf8(filePath: string, content: string): Promise<void> {\n  await fs.writeFile(filePath, content, 'utf-8')\n}\n\nfunction readFileUtf8(filePath: string): Promise<string> {\n  return fs.readFile(filePath, 'utf8')\n}\n\nasync function writeManifest<T extends object>(\n  filePath: string,\n  manifest: T\n): Promise<void> {\n  await writeFileUtf8(filePath, formatManifest(manifest))\n}\n\nasync function readManifest<T extends object>(filePath: string): Promise<T> {\n  return JSON.parse(await readFileUtf8(filePath))\n}\n\nasync function writePrerenderManifest(\n  distDir: string,\n  manifest: DeepReadonly<PrerenderManifest>\n): Promise<void> {\n  await writeManifest(path.join(distDir, PRERENDER_MANIFEST), manifest)\n  await writeEdgePartialPrerenderManifest(distDir, manifest)\n}\n\nasync function writeEdgePartialPrerenderManifest(\n  distDir: string,\n  manifest: DeepReadonly<Partial<PrerenderManifest>>\n): Promise<void> {\n  // We need to write a partial prerender manifest to make preview mode settings available in edge middleware.\n  // Use env vars in JS bundle and inject the actual vars to edge manifest.\n  const edgePartialPrerenderManifest: DeepReadonly<Partial<PrerenderManifest>> =\n    {\n      routes: {},\n      dynamicRoutes: {},\n      notFoundRoutes: [],\n      version: manifest.version,\n      preview: {\n        previewModeId: 'process.env.__NEXT_PREVIEW_MODE_ID',\n        previewModeSigningKey: 'process.env.__NEXT_PREVIEW_MODE_SIGNING_KEY',\n        previewModeEncryptionKey:\n          'process.env.__NEXT_PREVIEW_MODE_ENCRYPTION_KEY',\n      },\n    }\n  await writeFileUtf8(\n    path.join(distDir, PRERENDER_MANIFEST.replace(/\\.json$/, '.js')),\n    `self.__PRERENDER_MANIFEST=${JSON.stringify(\n      JSON.stringify(edgePartialPrerenderManifest)\n    )}`\n  )\n}\n\nasync function writeClientSsgManifest(\n  prerenderManifest: DeepReadonly<PrerenderManifest>,\n  {\n    buildId,\n    distDir,\n    locales,\n  }: { buildId: string; distDir: string; locales: string[] }\n) {\n  const ssgPages = new Set<string>(\n    [\n      ...Object.entries(prerenderManifest.routes)\n        // Filter out dynamic routes\n        .filter(([, { srcRoute }]) => srcRoute == null)\n        .map(([route]) => normalizeLocalePath(route, locales).pathname),\n      ...Object.keys(prerenderManifest.dynamicRoutes),\n    ].sort()\n  )\n\n  const clientSsgManifestContent = `self.__SSG_MANIFEST=${devalue(\n    ssgPages\n  )};self.__SSG_MANIFEST_CB&&self.__SSG_MANIFEST_CB()`\n\n  await writeFileUtf8(\n    path.join(distDir, CLIENT_STATIC_FILES_PATH, buildId, '_ssgManifest.js'),\n    clientSsgManifestContent\n  )\n}\n\ninterface FunctionsConfigManifest {\n  version: number\n  functions: Record<string, Record<string, string | number>>\n}\n\nasync function writeFunctionsConfigManifest(\n  distDir: string,\n  manifest: FunctionsConfigManifest\n): Promise<void> {\n  await writeManifest(\n    path.join(distDir, SERVER_DIRECTORY, FUNCTIONS_CONFIG_MANIFEST),\n    manifest\n  )\n}\n\ninterface RequiredServerFilesManifest {\n  version: number\n  config: NextConfigComplete\n  appDir: string\n  relativeAppDir: string\n  files: string[]\n  ignore: string[]\n}\n\nasync function writeRequiredServerFilesManifest(\n  distDir: string,\n  requiredServerFiles: RequiredServerFilesManifest\n) {\n  await writeManifest(\n    path.join(distDir, SERVER_FILES_MANIFEST),\n    requiredServerFiles\n  )\n}\n\nasync function writeImagesManifest(\n  distDir: string,\n  config: NextConfigComplete\n): Promise<void> {\n  const images = { ...config.images }\n  const { deviceSizes, imageSizes } = images\n  ;(images as any).sizes = [...deviceSizes, ...imageSizes]\n  images.remotePatterns = (config?.images?.remotePatterns || []).map((p) => ({\n    // Should be the same as matchRemotePattern()\n    protocol: p.protocol,\n    hostname: makeRe(p.hostname).source,\n    port: p.port,\n    pathname: makeRe(p.pathname ?? '**', { dot: true }).source,\n  }))\n\n  await writeManifest(path.join(distDir, IMAGES_MANIFEST), {\n    version: 1,\n    images,\n  })\n}\n\nconst STANDALONE_DIRECTORY = 'standalone' as const\nasync function writeStandaloneDirectory(\n  nextBuildSpan: Span,\n  distDir: string,\n  pageKeys: { pages: string[]; app: string[] | undefined },\n  denormalizedAppPages: string[] | undefined,\n  outputFileTracingRoot: string,\n  requiredServerFiles: RequiredServerFilesManifest,\n  middlewareManifest: MiddlewareManifest,\n  hasInstrumentationHook: boolean,\n  staticPages: Set<string>,\n  loadedEnvFiles: LoadedEnvFiles,\n  appDir: string | undefined\n) {\n  await nextBuildSpan\n    .traceChild('write-standalone-directory')\n    .traceAsyncFn(async () => {\n      await copyTracedFiles(\n        // requiredServerFiles.appDir Refers to the application directory, not App Router.\n        requiredServerFiles.appDir,\n        distDir,\n        pageKeys.pages,\n        denormalizedAppPages,\n        outputFileTracingRoot,\n        requiredServerFiles.config,\n        middlewareManifest,\n        hasInstrumentationHook,\n        staticPages\n      )\n\n      for (const file of [\n        ...requiredServerFiles.files,\n        path.join(requiredServerFiles.config.distDir, SERVER_FILES_MANIFEST),\n        ...loadedEnvFiles.reduce<string[]>((acc, envFile) => {\n          if (['.env', '.env.production'].includes(envFile.path)) {\n            acc.push(envFile.path)\n          }\n          return acc\n        }, []),\n      ]) {\n        // requiredServerFiles.appDir Refers to the application directory, not App Router.\n        const filePath = path.join(requiredServerFiles.appDir, file)\n        const outputPath = path.join(\n          distDir,\n          STANDALONE_DIRECTORY,\n          path.relative(outputFileTracingRoot, filePath)\n        )\n        await fs.mkdir(path.dirname(outputPath), {\n          recursive: true,\n        })\n        await fs.copyFile(filePath, outputPath)\n      }\n      await recursiveCopy(\n        path.join(distDir, SERVER_DIRECTORY, 'pages'),\n        path.join(\n          distDir,\n          STANDALONE_DIRECTORY,\n          path.relative(outputFileTracingRoot, distDir),\n          SERVER_DIRECTORY,\n          'pages'\n        ),\n        { overwrite: true }\n      )\n      if (appDir) {\n        const originalServerApp = path.join(distDir, SERVER_DIRECTORY, 'app')\n        if (existsSync(originalServerApp)) {\n          await recursiveCopy(\n            originalServerApp,\n            path.join(\n              distDir,\n              STANDALONE_DIRECTORY,\n              path.relative(outputFileTracingRoot, distDir),\n              SERVER_DIRECTORY,\n              'app'\n            ),\n            { overwrite: true }\n          )\n        }\n      }\n    })\n}\n\nfunction getNumberOfWorkers(config: NextConfigComplete) {\n  if (\n    config.experimental.cpus &&\n    config.experimental.cpus !== defaultConfig.experimental!.cpus\n  ) {\n    return config.experimental.cpus\n  }\n\n  if (config.experimental.memoryBasedWorkersCount) {\n    return Math.max(\n      Math.min(config.experimental.cpus || 1, Math.floor(os.freemem() / 1e9)),\n      // enforce a minimum of 4 workers\n      4\n    )\n  }\n\n  if (config.experimental.cpus) {\n    return config.experimental.cpus\n  }\n\n  // Fall back to 4 workers if a count is not specified\n  return 4\n}\n\nconst staticWorkerPath = require.resolve('./worker')\nconst staticWorkerExposedMethods = [\n  'hasCustomGetInitialProps',\n  'isPageStatic',\n  'getDefinedNamedExports',\n  'exportPage',\n] as const\ntype StaticWorker = typeof import('./worker') & Worker\ntype PageDataCollectionKeys = Exclude<\n  (typeof staticWorkerExposedMethods)[number],\n  'exportPage'\n>\n\nfunction createStaticWorker(\n  config: NextConfigComplete,\n  incrementalCacheIpcPort?: number,\n  incrementalCacheIpcValidationKey?: string\n): StaticWorker {\n  let infoPrinted = false\n  const timeout = config.staticPageGenerationTimeout || 0\n\n  return new Worker(staticWorkerPath, {\n    timeout: timeout * 1000,\n    logger: Log,\n    onRestart: (method, args, attempts) => {\n      if (method === 'exportPage') {\n        const [arg] = args as Parameters<StaticWorker['exportPage']>\n        const pagePath = arg.path\n        if (attempts >= 3) {\n          throw new Error(\n            `Static page generation for ${pagePath} is still timing out after 3 attempts. See more info here https://nextjs.org/docs/messages/static-page-generation-timeout`\n          )\n        }\n        Log.warn(\n          `Restarted static page generation for ${pagePath} because it took more than ${timeout} seconds`\n        )\n      } else {\n        const [arg] = args as Parameters<StaticWorker[PageDataCollectionKeys]>\n        const pagePath = arg.page\n        if (attempts >= 2) {\n          throw new Error(\n            `Collecting page data for ${pagePath} is still timing out after 2 attempts. See more info here https://nextjs.org/docs/messages/page-data-collection-timeout`\n          )\n        }\n        Log.warn(\n          `Restarted collecting page data for ${pagePath} because it took more than ${timeout} seconds`\n        )\n      }\n      if (!infoPrinted) {\n        Log.warn(\n          'See more info here https://nextjs.org/docs/messages/static-page-generation-timeout'\n        )\n        infoPrinted = true\n      }\n    },\n    numWorkers: getNumberOfWorkers(config),\n    forkOptions: {\n      env: {\n        ...process.env,\n        __NEXT_INCREMENTAL_CACHE_IPC_PORT: incrementalCacheIpcPort\n          ? incrementalCacheIpcPort + ''\n          : undefined,\n        __NEXT_INCREMENTAL_CACHE_IPC_KEY: incrementalCacheIpcValidationKey,\n      },\n    },\n    enableWorkerThreads: config.experimental.workerThreads,\n    exposedMethods: staticWorkerExposedMethods,\n  }) as StaticWorker\n}\n\nasync function writeFullyStaticExport(\n  config: NextConfigComplete,\n  incrementalCacheIpcPort: number | undefined,\n  incrementalCacheIpcValidationKey: string | undefined,\n  dir: string,\n  enabledDirectories: NextEnabledDirectories,\n  configOutDir: string,\n  nextBuildSpan: Span\n): Promise<void> {\n  const exportApp = require('../export')\n    .default as typeof import('../export').default\n\n  const pagesWorker = createStaticWorker(\n    config,\n    incrementalCacheIpcPort,\n    incrementalCacheIpcValidationKey\n  )\n  const appWorker = createStaticWorker(\n    config,\n    incrementalCacheIpcPort,\n    incrementalCacheIpcValidationKey\n  )\n\n  await exportApp(\n    dir,\n    {\n      buildExport: false,\n      nextConfig: config,\n      enabledDirectories,\n      silent: true,\n      threads: config.experimental.cpus,\n      outdir: path.join(dir, configOutDir),\n      // The worker already explicitly binds `this` to each of the\n      // exposed methods.\n      exportAppPageWorker: appWorker?.exportPage,\n      exportPageWorker: pagesWorker?.exportPage,\n      endWorker: async () => {\n        await pagesWorker.end()\n        await appWorker.end()\n      },\n    },\n    nextBuildSpan\n  )\n\n  // ensure the worker is not left hanging\n  pagesWorker.close()\n  appWorker.close()\n}\n\nasync function getBuildId(\n  isGenerateMode: boolean,\n  distDir: string,\n  nextBuildSpan: Span,\n  config: NextConfigComplete\n) {\n  if (isGenerateMode) {\n    return await fs.readFile(path.join(distDir, 'BUILD_ID'), 'utf8')\n  }\n  return await nextBuildSpan\n    .traceChild('generate-buildid')\n    .traceAsyncFn(() => generateBuildId(config.generateBuildId, nanoid))\n}\n\nconst IS_TURBOPACK_BUILD = process.env.TURBOPACK && process.env.TURBOPACK_BUILD\n\nexport default async function build(\n  dir: string,\n  reactProductionProfiling = false,\n  debugOutput = false,\n  runLint = true,\n  noMangling = false,\n  appDirOnly = false,\n  turboNextBuild = false,\n  experimentalBuildMode: 'default' | 'compile' | 'generate',\n  traceUploadUrl: string | undefined\n): Promise<void> {\n  const isCompileMode = experimentalBuildMode === 'compile'\n  const isGenerateMode = experimentalBuildMode === 'generate'\n\n  let loadedConfig: NextConfigComplete | undefined\n  try {\n    const nextBuildSpan = trace('next-build', undefined, {\n      buildMode: experimentalBuildMode,\n      isTurboBuild: String(turboNextBuild),\n      version: process.env.__NEXT_VERSION as string,\n    })\n\n    NextBuildContext.nextBuildSpan = nextBuildSpan\n    NextBuildContext.dir = dir\n    NextBuildContext.appDirOnly = appDirOnly\n    NextBuildContext.reactProductionProfiling = reactProductionProfiling\n    NextBuildContext.noMangling = noMangling\n\n    await nextBuildSpan.traceAsyncFn(async () => {\n      // attempt to load global env values so they are available in next.config.js\n      const { loadedEnvFiles } = nextBuildSpan\n        .traceChild('load-dotenv')\n        .traceFn(() => loadEnvConfig(dir, false, Log))\n      NextBuildContext.loadedEnvFiles = loadedEnvFiles\n\n      const turborepoAccessTraceResult = new TurborepoAccessTraceResult()\n      const config: NextConfigComplete = await nextBuildSpan\n        .traceChild('load-next-config')\n        .traceAsyncFn(() =>\n          turborepoTraceAccess(\n            () =>\n              loadConfig(PHASE_PRODUCTION_BUILD, dir, {\n                // Log for next.config loading process\n                silent: false,\n              }),\n            turborepoAccessTraceResult\n          )\n        )\n      loadedConfig = config\n\n      process.env.NEXT_DEPLOYMENT_ID = config.deploymentId || ''\n      NextBuildContext.config = config\n\n      let configOutDir = 'out'\n      if (hasCustomExportOutput(config)) {\n        configOutDir = config.distDir\n        config.distDir = '.next'\n      }\n      const distDir = path.join(dir, config.distDir)\n      setGlobal('phase', PHASE_PRODUCTION_BUILD)\n      setGlobal('distDir', distDir)\n\n      const buildId = await getBuildId(\n        isGenerateMode,\n        distDir,\n        nextBuildSpan,\n        config\n      )\n      NextBuildContext.buildId = buildId\n\n      const customRoutes: CustomRoutes = await nextBuildSpan\n        .traceChild('load-custom-routes')\n        .traceAsyncFn(() => loadCustomRoutes(config))\n\n      const { headers, rewrites, redirects } = customRoutes\n      const combinedRewrites: Rewrite[] = [\n        ...rewrites.beforeFiles,\n        ...rewrites.afterFiles,\n        ...rewrites.fallback,\n      ]\n      const hasRewrites = combinedRewrites.length > 0\n\n      NextBuildContext.originalRewrites = config._originalRewrites\n      NextBuildContext.originalRedirects = config._originalRedirects\n\n      const cacheDir = getCacheDir(distDir)\n\n      const telemetry = new Telemetry({ distDir })\n\n      setGlobal('telemetry', telemetry)\n\n      const publicDir = path.join(dir, 'public')\n      const { pagesDir, appDir } = findPagesDir(dir)\n      NextBuildContext.pagesDir = pagesDir\n      NextBuildContext.appDir = appDir\n\n      const enabledDirectories: NextEnabledDirectories = {\n        app: typeof appDir === 'string',\n        pages: typeof pagesDir === 'string',\n      }\n\n      // Generate a random encryption key for this build.\n      // This key is used to encrypt cross boundary values and can be used to generate hashes.\n      const encryptionKey = await generateEncryptionKeyBase64()\n      NextBuildContext.encryptionKey = encryptionKey\n\n      const isSrcDir = path\n        .relative(dir, pagesDir || appDir || '')\n        .startsWith('src')\n      const hasPublicDir = existsSync(publicDir)\n\n      telemetry.record(\n        eventCliSession(dir, config, {\n          webpackVersion: 5,\n          cliCommand: 'build',\n          isSrcDir,\n          hasNowJson: !!(await findUp('now.json', { cwd: dir })),\n          isCustomServer: null,\n          turboFlag: false,\n          pagesDir: !!pagesDir,\n          appDir: !!appDir,\n        })\n      )\n\n      eventNextPlugins(path.resolve(dir)).then((events) =>\n        telemetry.record(events)\n      )\n\n      eventSwcPlugins(path.resolve(dir), config).then((events) =>\n        telemetry.record(events)\n      )\n\n      // Always log next version first then start rest jobs\n      const { envInfo, expFeatureInfo } = await getStartServerInfo(dir, false)\n      logStartInfo({\n        networkUrl: null,\n        appUrl: null,\n        envInfo,\n        expFeatureInfo,\n      })\n\n      const ignoreESLint = Boolean(config.eslint.ignoreDuringBuilds)\n      const shouldLint = !ignoreESLint && runLint\n\n      const typeCheckingOptions: Parameters<typeof startTypeChecking>[0] = {\n        dir,\n        appDir,\n        pagesDir,\n        runLint,\n        shouldLint,\n        ignoreESLint,\n        telemetry,\n        nextBuildSpan,\n        config,\n        cacheDir,\n      }\n\n      // For app directory, we run type checking after build. That's because\n      // we dynamically generate types for each layout and page in the app\n      // directory.\n      if (!appDir && !isCompileMode)\n        await startTypeChecking(typeCheckingOptions)\n\n      if (appDir && 'exportPathMap' in config) {\n        Log.error(\n          'The \"exportPathMap\" configuration cannot be used with the \"app\" directory. Please use generateStaticParams() instead.'\n        )\n        await telemetry.flush()\n        process.exit(1)\n      }\n\n      const buildLintEvent: EventBuildFeatureUsage = {\n        featureName: 'build-lint',\n        invocationCount: shouldLint ? 1 : 0,\n      }\n      telemetry.record({\n        eventName: EVENT_BUILD_FEATURE_USAGE,\n        payload: buildLintEvent,\n      })\n\n      const validFileMatcher = createValidFileMatcher(\n        config.pageExtensions,\n        appDir\n      )\n\n      const pagesPaths =\n        !appDirOnly && pagesDir\n          ? await nextBuildSpan.traceChild('collect-pages').traceAsyncFn(() =>\n              recursiveReadDir(pagesDir, {\n                pathnameFilter: validFileMatcher.isPageFile,\n              })\n            )\n          : []\n\n      const middlewareDetectionRegExp = new RegExp(\n        `^${MIDDLEWARE_FILENAME}\\\\.(?:${config.pageExtensions.join('|')})$`\n      )\n\n      const instrumentationHookDetectionRegExp = new RegExp(\n        `^${INSTRUMENTATION_HOOK_FILENAME}\\\\.(?:${config.pageExtensions.join(\n          '|'\n        )})$`\n      )\n\n      const rootDir = path.join((pagesDir || appDir)!, '..')\n      const instrumentationHookEnabled = Boolean(\n        config.experimental.instrumentationHook\n      )\n\n      const includes = [\n        middlewareDetectionRegExp,\n        ...(instrumentationHookEnabled\n          ? [instrumentationHookDetectionRegExp]\n          : []),\n      ]\n\n      const rootPaths = (await getFilesInDir(rootDir))\n        .filter((file) => includes.some((include) => include.test(file)))\n        .sort(sortByPageExts(config.pageExtensions))\n        .map((file) => path.join(rootDir, file).replace(dir, ''))\n\n      const hasInstrumentationHook = rootPaths.some((p) =>\n        p.includes(INSTRUMENTATION_HOOK_FILENAME)\n      )\n      const hasMiddlewareFile = rootPaths.some((p) =>\n        p.includes(MIDDLEWARE_FILENAME)\n      )\n\n      NextBuildContext.hasInstrumentationHook = hasInstrumentationHook\n\n      const previewProps: __ApiPreviewProps = {\n        previewModeId: crypto.randomBytes(16).toString('hex'),\n        previewModeSigningKey: crypto.randomBytes(32).toString('hex'),\n        previewModeEncryptionKey: crypto.randomBytes(32).toString('hex'),\n      }\n      NextBuildContext.previewProps = previewProps\n\n      const mappedPages = nextBuildSpan\n        .traceChild('create-pages-mapping')\n        .traceFn(() =>\n          createPagesMapping({\n            isDev: false,\n            pageExtensions: config.pageExtensions,\n            pagesType: PAGE_TYPES.PAGES,\n            pagePaths: pagesPaths,\n            pagesDir,\n          })\n        )\n      NextBuildContext.mappedPages = mappedPages\n\n      let mappedAppPages: MappedPages | undefined\n      let denormalizedAppPages: string[] | undefined\n\n      if (appDir) {\n        const appPaths = await nextBuildSpan\n          .traceChild('collect-app-paths')\n          .traceAsyncFn(() =>\n            recursiveReadDir(appDir, {\n              pathnameFilter: (absolutePath) =>\n                validFileMatcher.isAppRouterPage(absolutePath) ||\n                // For now we only collect the root /not-found page in the app\n                // directory as the 404 fallback\n                validFileMatcher.isRootNotFound(absolutePath),\n              ignorePartFilter: (part) => part.startsWith('_'),\n            })\n          )\n\n        mappedAppPages = nextBuildSpan\n          .traceChild('create-app-mapping')\n          .traceFn(() =>\n            createPagesMapping({\n              pagePaths: appPaths,\n              isDev: false,\n              pagesType: PAGE_TYPES.APP,\n              pageExtensions: config.pageExtensions,\n              pagesDir: pagesDir,\n            })\n          )\n\n        // If the metadata route doesn't contain generating dynamic exports,\n        // we can replace the dynamic catch-all route and use the static route instead.\n        for (const [pageKey, pagePath] of Object.entries(mappedAppPages)) {\n          if (pageKey.includes('[[...__metadata_id__]]')) {\n            const pageFilePath = getPageFilePath({\n              absolutePagePath: pagePath,\n              pagesDir,\n              appDir,\n              rootDir,\n            })\n\n            const isDynamic = await isDynamicMetadataRoute(pageFilePath)\n            if (!isDynamic) {\n              delete mappedAppPages[pageKey]\n              mappedAppPages[pageKey.replace('[[...__metadata_id__]]/', '')] =\n                pagePath\n            }\n\n            if (\n              pageKey.includes('sitemap/[[...__metadata_id__]]') &&\n              isDynamic\n            ) {\n              delete mappedAppPages[pageKey]\n              mappedAppPages[\n                pageKey.replace(\n                  'sitemap/[[...__metadata_id__]]',\n                  'sitemap/[__metadata_id__]'\n                )\n              ] = pagePath\n            }\n          }\n        }\n\n        NextBuildContext.mappedAppPages = mappedAppPages\n      }\n\n      const mappedRootPaths = createPagesMapping({\n        isDev: false,\n        pageExtensions: config.pageExtensions,\n        pagePaths: rootPaths,\n        pagesType: PAGE_TYPES.ROOT,\n        pagesDir: pagesDir,\n      })\n      NextBuildContext.mappedRootPaths = mappedRootPaths\n\n      const pagesPageKeys = Object.keys(mappedPages)\n\n      const conflictingAppPagePaths: [pagePath: string, appPath: string][] = []\n      const appPageKeys = new Set<string>()\n      if (mappedAppPages) {\n        denormalizedAppPages = Object.keys(mappedAppPages)\n        for (const appKey of denormalizedAppPages) {\n          const normalizedAppPageKey = normalizeAppPath(appKey)\n          const pagePath = mappedPages[normalizedAppPageKey]\n          if (pagePath) {\n            const appPath = mappedAppPages[appKey]\n            conflictingAppPagePaths.push([\n              pagePath.replace(/^private-next-pages/, 'pages'),\n              appPath.replace(/^private-next-app-dir/, 'app'),\n            ])\n          }\n          appPageKeys.add(normalizedAppPageKey)\n        }\n      }\n\n      const appPaths = Array.from(appPageKeys)\n      // Interception routes are modelled as beforeFiles rewrites\n      rewrites.beforeFiles.push(\n        ...generateInterceptionRoutesRewrites(appPaths, config.basePath)\n      )\n\n      NextBuildContext.rewrites = rewrites\n\n      const totalAppPagesCount = appPaths.length\n\n      const pageKeys = {\n        pages: pagesPageKeys,\n        app: appPaths.length > 0 ? appPaths : undefined,\n      }\n\n      // Turbopack already handles conflicting app and page routes.\n      if (!IS_TURBOPACK_BUILD) {\n        const numConflictingAppPaths = conflictingAppPagePaths.length\n        if (mappedAppPages && numConflictingAppPaths > 0) {\n          Log.error(\n            `Conflicting app and page file${\n              numConflictingAppPaths === 1 ? ' was' : 's were'\n            } found, please remove the conflicting files to continue:`\n          )\n          for (const [pagePath, appPath] of conflictingAppPagePaths) {\n            Log.error(`  \"${pagePath}\" - \"${appPath}\"`)\n          }\n          await telemetry.flush()\n          process.exit(1)\n        }\n      }\n\n      const conflictingPublicFiles: string[] = []\n      const hasPages404 = mappedPages['/404']?.startsWith(PAGES_DIR_ALIAS)\n      const hasApp404 = !!mappedAppPages?.[UNDERSCORE_NOT_FOUND_ROUTE_ENTRY]\n      const hasCustomErrorPage =\n        mappedPages['/_error'].startsWith(PAGES_DIR_ALIAS)\n\n      if (hasPublicDir) {\n        const hasPublicUnderScoreNextDir = existsSync(\n          path.join(publicDir, '_next')\n        )\n        if (hasPublicUnderScoreNextDir) {\n          throw new Error(PUBLIC_DIR_MIDDLEWARE_CONFLICT)\n        }\n      }\n\n      await nextBuildSpan\n        .traceChild('public-dir-conflict-check')\n        .traceAsyncFn(async () => {\n          // Check if pages conflict with files in `public`\n          // Only a page of public file can be served, not both.\n          for (const page in mappedPages) {\n            const hasPublicPageFile = await fileExists(\n              path.join(publicDir, page === '/' ? '/index' : page),\n              FileType.File\n            )\n            if (hasPublicPageFile) {\n              conflictingPublicFiles.push(page)\n            }\n          }\n\n          const numConflicting = conflictingPublicFiles.length\n\n          if (numConflicting) {\n            throw new Error(\n              `Conflicting public and page file${\n                numConflicting === 1 ? ' was' : 's were'\n              } found. https://nextjs.org/docs/messages/conflicting-public-file-page\\n${conflictingPublicFiles.join(\n                '\\n'\n              )}`\n            )\n          }\n        })\n\n      const nestedReservedPages = pageKeys.pages.filter((page) => {\n        return (\n          page.match(/\\/(_app|_document|_error)$/) && path.dirname(page) !== '/'\n        )\n      })\n\n      if (nestedReservedPages.length) {\n        Log.warn(\n          `The following reserved Next.js pages were detected not directly under the pages directory:\\n` +\n            nestedReservedPages.join('\\n') +\n            `\\nSee more info here: https://nextjs.org/docs/messages/nested-reserved-page\\n`\n        )\n      }\n\n      const restrictedRedirectPaths = ['/_next'].map((p) =>\n        config.basePath ? `${config.basePath}${p}` : p\n      )\n\n      const routesManifestPath = path.join(distDir, ROUTES_MANIFEST)\n      const routesManifest: RoutesManifest = nextBuildSpan\n        .traceChild('generate-routes-manifest')\n        .traceFn(() => {\n          const sortedRoutes = getSortedRoutes([\n            ...pageKeys.pages,\n            ...(pageKeys.app ?? []),\n          ])\n          const dynamicRoutes: Array<ReturnType<typeof pageToRoute>> = []\n          const staticRoutes: typeof dynamicRoutes = []\n\n          for (const route of sortedRoutes) {\n            if (isDynamicRoute(route)) {\n              dynamicRoutes.push(pageToRoute(route))\n            } else if (!isReservedPage(route)) {\n              staticRoutes.push(pageToRoute(route))\n            }\n          }\n\n          return {\n            version: 3,\n            pages404: true,\n            caseSensitive: !!config.experimental.caseSensitiveRoutes,\n            basePath: config.basePath,\n            redirects: redirects.map((r) =>\n              buildCustomRoute('redirect', r, restrictedRedirectPaths)\n            ),\n            headers: headers.map((r) => buildCustomRoute('header', r)),\n            dynamicRoutes,\n            staticRoutes,\n            dataRoutes: [],\n            i18n: config.i18n || undefined,\n            rsc: {\n              header: RSC_HEADER,\n              // This vary header is used as a default. It is technically re-assigned in `base-server`,\n              // and may include an additional Vary option for `Next-URL`.\n              varyHeader: `${RSC_HEADER}, ${NEXT_ROUTER_STATE_TREE}, ${NEXT_ROUTER_PREFETCH_HEADER}`,\n              prefetchHeader: NEXT_ROUTER_PREFETCH_HEADER,\n              didPostponeHeader: NEXT_DID_POSTPONE_HEADER,\n              contentTypeHeader: RSC_CONTENT_TYPE_HEADER,\n              suffix: RSC_SUFFIX,\n              prefetchSuffix: RSC_PREFETCH_SUFFIX,\n            },\n            skipMiddlewareUrlNormalize: config.skipMiddlewareUrlNormalize,\n          } as RoutesManifest\n        })\n\n      if (rewrites.beforeFiles.length === 0 && rewrites.fallback.length === 0) {\n        routesManifest.rewrites = rewrites.afterFiles.map((r) =>\n          buildCustomRoute('rewrite', r)\n        )\n      } else {\n        routesManifest.rewrites = {\n          beforeFiles: rewrites.beforeFiles.map((r) =>\n            buildCustomRoute('rewrite', r)\n          ),\n          afterFiles: rewrites.afterFiles.map((r) =>\n            buildCustomRoute('rewrite', r)\n          ),\n          fallback: rewrites.fallback.map((r) =>\n            buildCustomRoute('rewrite', r)\n          ),\n        }\n      }\n\n      if (config.experimental.clientRouterFilter) {\n        const nonInternalRedirects = (config._originalRedirects || []).filter(\n          (r: any) => !r.internal\n        )\n        const clientRouterFilters = createClientRouterFilter(\n          appPaths,\n          config.experimental.clientRouterFilterRedirects\n            ? nonInternalRedirects\n            : [],\n          config.experimental.clientRouterFilterAllowedRate\n        )\n\n        NextBuildContext.clientRouterFilters = clientRouterFilters\n      }\n\n      const distDirCreated = await nextBuildSpan\n        .traceChild('create-dist-dir')\n        .traceAsyncFn(async () => {\n          try {\n            await fs.mkdir(distDir, { recursive: true })\n            return true\n          } catch (err) {\n            if (isError(err) && err.code === 'EPERM') {\n              return false\n            }\n            throw err\n          }\n        })\n\n      if (!distDirCreated || !(await isWriteable(distDir))) {\n        throw new Error(\n          '> Build directory is not writeable. https://nextjs.org/docs/messages/build-dir-not-writeable'\n        )\n      }\n\n      if (config.cleanDistDir && !isGenerateMode) {\n        await recursiveDelete(distDir, /^cache/)\n      }\n\n      // Ensure commonjs handling is used for files in the distDir (generally .next)\n      // Files outside of the distDir can be \"type\": \"module\"\n      await writeFileUtf8(\n        path.join(distDir, 'package.json'),\n        '{\"type\": \"commonjs\"}'\n      )\n\n      // We need to write the manifest with rewrites before build\n      await nextBuildSpan\n        .traceChild('write-routes-manifest')\n        .traceAsyncFn(() => writeManifest(routesManifestPath, routesManifest))\n\n      await writeEdgePartialPrerenderManifest(distDir, {})\n\n      const outputFileTracingRoot =\n        config.experimental.outputFileTracingRoot || dir\n\n      const pagesManifestPath = path.join(\n        distDir,\n        SERVER_DIRECTORY,\n        PAGES_MANIFEST\n      )\n\n      const { cacheHandler } = config\n\n      const requiredServerFilesManifest = nextBuildSpan\n        .traceChild('generate-required-server-files')\n        .traceFn(() => {\n          const serverFilesManifest: RequiredServerFilesManifest = {\n            version: 1,\n            config: {\n              ...config,\n              configFile: undefined,\n              ...(ciEnvironment.hasNextSupport\n                ? {\n                    compress: false,\n                  }\n                : {}),\n              cacheHandler: cacheHandler\n                ? path.relative(distDir, cacheHandler)\n                : config.cacheHandler,\n              experimental: {\n                ...config.experimental,\n                trustHostHeader: ciEnvironment.hasNextSupport,\n\n                // @ts-expect-error internal field TODO: fix this, should use a separate mechanism to pass the info.\n                isExperimentalCompile: isCompileMode,\n              },\n            },\n            appDir: dir,\n            relativeAppDir: path.relative(outputFileTracingRoot, dir),\n            files: [\n              ROUTES_MANIFEST,\n              path.relative(distDir, pagesManifestPath),\n              BUILD_MANIFEST,\n              PRERENDER_MANIFEST,\n              PRERENDER_MANIFEST.replace(/\\.json$/, '.js'),\n              path.join(SERVER_DIRECTORY, MIDDLEWARE_MANIFEST),\n              path.join(SERVER_DIRECTORY, MIDDLEWARE_BUILD_MANIFEST + '.js'),\n              path.join(\n                SERVER_DIRECTORY,\n                MIDDLEWARE_REACT_LOADABLE_MANIFEST + '.js'\n              ),\n              ...(appDir\n                ? [\n                    ...(config.experimental.sri\n                      ? [\n                          path.join(\n                            SERVER_DIRECTORY,\n                            SUBRESOURCE_INTEGRITY_MANIFEST + '.js'\n                          ),\n                          path.join(\n                            SERVER_DIRECTORY,\n                            SUBRESOURCE_INTEGRITY_MANIFEST + '.json'\n                          ),\n                        ]\n                      : []),\n                    path.join(SERVER_DIRECTORY, APP_PATHS_MANIFEST),\n                    path.join(APP_PATH_ROUTES_MANIFEST),\n                    APP_BUILD_MANIFEST,\n                    path.join(\n                      SERVER_DIRECTORY,\n                      SERVER_REFERENCE_MANIFEST + '.js'\n                    ),\n                    path.join(\n                      SERVER_DIRECTORY,\n                      SERVER_REFERENCE_MANIFEST + '.json'\n                    ),\n                  ]\n                : []),\n              REACT_LOADABLE_MANIFEST,\n              config.optimizeFonts\n                ? path.join(\n                    SERVER_DIRECTORY,\n                    AUTOMATIC_FONT_OPTIMIZATION_MANIFEST\n                  )\n                : null,\n              BUILD_ID_FILE,\n              path.join(SERVER_DIRECTORY, NEXT_FONT_MANIFEST + '.js'),\n              path.join(SERVER_DIRECTORY, NEXT_FONT_MANIFEST + '.json'),\n              ...(hasInstrumentationHook\n                ? [\n                    path.join(\n                      SERVER_DIRECTORY,\n                      `${INSTRUMENTATION_HOOK_FILENAME}.js`\n                    ),\n                    path.join(\n                      SERVER_DIRECTORY,\n                      `edge-${INSTRUMENTATION_HOOK_FILENAME}.js`\n                    ),\n                  ]\n                : []),\n            ]\n              .filter(nonNullable)\n              .map((file) => path.join(config.distDir, file)),\n            ignore: [] as string[],\n          }\n\n          return serverFilesManifest\n        })\n\n      async function turbopackBuild(): Promise<{\n        duration: number\n        buildTraceContext: undefined\n      }> {\n        if (!IS_TURBOPACK_BUILD) {\n          throw new Error(\"next build doesn't support turbopack yet\")\n        }\n\n        await validateTurboNextConfig({\n          dir,\n          isDev: false,\n        })\n\n        const startTime = process.hrtime()\n        const bindings = await loadBindings(config?.experimental?.useWasmBinary)\n        const dev = false\n        const project = await bindings.turbo.createProject({\n          projectPath: dir,\n          rootPath: config.experimental.outputFileTracingRoot || dir,\n          nextConfig: config,\n          jsConfig: await getTurbopackJsConfig(dir, config),\n          watch: false,\n          dev,\n          env: process.env as Record<string, string>,\n          defineEnv: createDefineEnv({\n            isTurbopack: true,\n            clientRouterFilters: NextBuildContext.clientRouterFilters,\n            config,\n            dev,\n            distDir,\n            fetchCacheKeyPrefix: config.experimental.fetchCacheKeyPrefix,\n            hasRewrites,\n            // TODO: Implement\n            middlewareMatchers: undefined,\n          }),\n          buildId: NextBuildContext.buildId!,\n          encryptionKey: NextBuildContext.encryptionKey!,\n          previewProps: NextBuildContext.previewProps!,\n        })\n\n        await fs.mkdir(path.join(distDir, 'server'), { recursive: true })\n        await fs.mkdir(path.join(distDir, 'static', buildId), {\n          recursive: true,\n        })\n        await fs.writeFile(\n          path.join(distDir, 'package.json'),\n          JSON.stringify(\n            {\n              type: 'commonjs',\n            },\n            null,\n            2\n          )\n        )\n\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const entrypointsSubscription = project.entrypointsSubscribe()\n        const currentEntrypoints: Entrypoints = {\n          global: {\n            app: undefined,\n            document: undefined,\n            error: undefined,\n\n            middleware: undefined,\n            instrumentation: undefined,\n          },\n\n          app: new Map(),\n          page: new Map(),\n        }\n\n        const currentEntryIssues: EntryIssuesMap = new Map()\n\n        const manifestLoader = new TurbopackManifestLoader({\n          buildId,\n          distDir,\n          encryptionKey,\n        })\n\n        // TODO: implement this\n        const emptyRewritesObjToBeImplemented = {\n          beforeFiles: [],\n          afterFiles: [],\n          fallback: [],\n        }\n\n        const entrypointsResult = await entrypointsSubscription.next()\n        if (entrypointsResult.done) {\n          throw new Error('Turbopack did not return any entrypoints')\n        }\n        entrypointsSubscription.return?.().catch(() => {})\n\n        const entrypoints = entrypointsResult.value\n\n        const topLevelErrors: {\n          message: string\n        }[] = []\n        for (const issue of entrypoints.issues) {\n          topLevelErrors.push({\n            message: formatIssue(issue),\n          })\n        }\n\n        if (topLevelErrors.length > 0) {\n          throw new Error(\n            `Turbopack build failed with ${\n              topLevelErrors.length\n            } issues:\\n${topLevelErrors.map((e) => e.message).join('\\n')}`\n          )\n        }\n\n        await handleEntrypoints({\n          entrypoints,\n          currentEntrypoints,\n          currentEntryIssues,\n          manifestLoader,\n          nextConfig: config,\n          rewrites: emptyRewritesObjToBeImplemented,\n          logErrors: false,\n        })\n\n        const progress = createProgress(\n          currentEntrypoints.page.size + currentEntrypoints.app.size + 1,\n          'Building'\n        )\n        const promises: Promise<any>[] = []\n        const sema = new Sema(10)\n        const enqueue = (fn: () => Promise<void>) => {\n          promises.push(\n            (async () => {\n              await sema.acquire()\n              try {\n                await fn()\n              } finally {\n                sema.release()\n                progress()\n              }\n            })()\n          )\n        }\n\n        for (const [page, route] of currentEntrypoints.page) {\n          enqueue(() =>\n            handleRouteType({\n              dev,\n              page,\n              pathname: page,\n              route,\n\n              currentEntryIssues,\n              entrypoints: currentEntrypoints,\n              manifestLoader,\n              rewrites: emptyRewritesObjToBeImplemented,\n              logErrors: false,\n            })\n          )\n        }\n\n        for (const [page, route] of currentEntrypoints.app) {\n          enqueue(() =>\n            handleRouteType({\n              page,\n              dev: false,\n              pathname: normalizeAppPath(page),\n              route,\n              currentEntryIssues,\n              entrypoints: currentEntrypoints,\n              manifestLoader,\n              rewrites: emptyRewritesObjToBeImplemented,\n              logErrors: false,\n            })\n          )\n        }\n\n        enqueue(() =>\n          handlePagesErrorRoute({\n            currentEntryIssues,\n            entrypoints: currentEntrypoints,\n            manifestLoader,\n            rewrites: emptyRewritesObjToBeImplemented,\n            logErrors: false,\n          })\n        )\n        await Promise.all(promises)\n\n        await manifestLoader.writeManifests({\n          rewrites: emptyRewritesObjToBeImplemented,\n          pageEntrypoints: currentEntrypoints.page,\n        })\n\n        const errors: {\n          page: string\n          message: string\n        }[] = []\n        const warnings: {\n          page: string\n          message: string\n        }[] = []\n        for (const [page, entryIssues] of currentEntryIssues) {\n          for (const issue of entryIssues.values()) {\n            if (issue.severity !== 'warning') {\n              errors.push({\n                page,\n                message: formatIssue(issue),\n              })\n            } else {\n              if (isRelevantWarning(issue)) {\n                warnings.push({\n                  page,\n                  message: formatIssue(issue),\n                })\n              }\n            }\n          }\n        }\n\n        if (warnings.length > 0) {\n          Log.warn(\n            `Turbopack build collected ${warnings.length} warnings:\\n${warnings\n              .map((e) => {\n                return 'Page: ' + e.page + '\\n' + e.message\n              })\n              .join('\\n')}`\n          )\n        }\n\n        if (errors.length > 0) {\n          throw new Error(\n            `Turbopack build failed with ${errors.length} errors:\\n${errors\n              .map((e) => {\n                return 'Page: ' + e.page + '\\n' + e.message\n              })\n              .join('\\n')}`\n          )\n        }\n\n        return {\n          duration: process.hrtime(startTime)[0],\n          buildTraceContext: undefined,\n        }\n      }\n\n      let buildTraceContext: undefined | BuildTraceContext\n      let buildTracesPromise: Promise<any> | undefined = undefined\n\n      // If there's has a custom webpack config and disable the build worker.\n      // Otherwise respect the option if it's set.\n      const useBuildWorker =\n        config.experimental.webpackBuildWorker ||\n        (config.experimental.webpackBuildWorker === undefined &&\n          !config.webpack)\n      const runServerAndEdgeInParallel =\n        config.experimental.parallelServerCompiles\n      const collectServerBuildTracesInParallel =\n        config.experimental.parallelServerBuildTraces ||\n        (config.experimental.parallelServerBuildTraces === undefined &&\n          isCompileMode)\n\n      nextBuildSpan.setAttribute(\n        'has-custom-webpack-config',\n        String(!!config.webpack)\n      )\n      nextBuildSpan.setAttribute('use-build-worker', String(useBuildWorker))\n\n      if (\n        !useBuildWorker &&\n        (runServerAndEdgeInParallel || collectServerBuildTracesInParallel)\n      ) {\n        throw new Error(\n          'The \"parallelServerBuildTraces\" and \"parallelServerCompiles\" options may only be used when build workers can be used. Read more: https://nextjs.org/docs/messages/parallel-build-without-worker'\n        )\n      }\n\n      Log.info('Creating an optimized production build ...')\n      traceMemoryUsage('Starting build', nextBuildSpan)\n\n      if (!isGenerateMode) {\n        if (runServerAndEdgeInParallel || collectServerBuildTracesInParallel) {\n          let durationInSeconds = 0\n\n          const serverBuildPromise = webpackBuild(useBuildWorker, [\n            'server',\n          ]).then((res) => {\n            traceMemoryUsage('Finished server compilation', nextBuildSpan)\n            buildTraceContext = res.buildTraceContext\n            durationInSeconds += res.duration\n\n            if (collectServerBuildTracesInParallel) {\n              const buildTraceWorker = new Worker(\n                require.resolve('./collect-build-traces'),\n                {\n                  numWorkers: 1,\n                  exposedMethods: ['collectBuildTraces'],\n                }\n              ) as Worker & typeof import('./collect-build-traces')\n\n              buildTracesPromise = buildTraceWorker\n                .collectBuildTraces({\n                  dir,\n                  config,\n                  distDir,\n                  // Serialize Map as this is sent to the worker.\n                  edgeRuntimeRoutes: collectRoutesUsingEdgeRuntime(new Map()),\n                  staticPages: [],\n                  hasSsrAmpPages: false,\n                  buildTraceContext,\n                  outputFileTracingRoot,\n                  isFlyingShuttle: !!config.experimental.flyingShuttle,\n                })\n                .catch((err) => {\n                  console.error(err)\n                  process.exit(1)\n                })\n            }\n          })\n          if (!runServerAndEdgeInParallel) {\n            await serverBuildPromise\n          }\n\n          const edgeBuildPromise = webpackBuild(useBuildWorker, [\n            'edge-server',\n          ]).then((res) => {\n            durationInSeconds += res.duration\n            traceMemoryUsage('Finished edge-server compilation', nextBuildSpan)\n          })\n          if (runServerAndEdgeInParallel) {\n            await serverBuildPromise\n          }\n          await edgeBuildPromise\n\n          await webpackBuild(useBuildWorker, ['client']).then((res) => {\n            durationInSeconds += res.duration\n            traceMemoryUsage('Finished client compilation', nextBuildSpan)\n          })\n\n          Log.event('Compiled successfully')\n\n          telemetry.record(\n            eventBuildCompleted(pagesPaths, {\n              durationInSeconds,\n              totalAppPagesCount,\n            })\n          )\n        } else {\n          const { duration: compilerDuration, ...rest } = turboNextBuild\n            ? await turbopackBuild()\n            : await webpackBuild(useBuildWorker, null)\n          traceMemoryUsage('Finished build', nextBuildSpan)\n\n          buildTraceContext = rest.buildTraceContext\n\n          telemetry.record(\n            eventBuildCompleted(pagesPaths, {\n              durationInSeconds: compilerDuration,\n              totalAppPagesCount,\n            })\n          )\n        }\n      }\n\n      // For app directory, we run type checking after build.\n      if (appDir && !isCompileMode && !isGenerateMode) {\n        await startTypeChecking(typeCheckingOptions)\n        traceMemoryUsage('Finished type checking', nextBuildSpan)\n      }\n\n      const postCompileSpinner = createSpinner('Collecting page data')\n\n      const buildManifestPath = path.join(distDir, BUILD_MANIFEST)\n      const appBuildManifestPath = path.join(distDir, APP_BUILD_MANIFEST)\n\n      let staticAppPagesCount = 0\n      let serverAppPagesCount = 0\n      let edgeRuntimeAppCount = 0\n      let edgeRuntimePagesCount = 0\n      const ssgPages = new Set<string>()\n      const ssgStaticFallbackPages = new Set<string>()\n      const ssgBlockingFallbackPages = new Set<string>()\n      const staticPages = new Set<string>()\n      const invalidPages = new Set<string>()\n      const hybridAmpPages = new Set<string>()\n      const serverPropsPages = new Set<string>()\n      const additionalSsgPaths = new Map<string, Array<string>>()\n      const additionalSsgPathsEncoded = new Map<string, Array<string>>()\n      const appStaticPaths = new Map<string, Array<string>>()\n      const appStaticPathsEncoded = new Map<string, Array<string>>()\n      const appNormalizedPaths = new Map<string, string>()\n      const appDynamicParamPaths = new Set<string>()\n      const appDefaultConfigs = new Map<string, AppConfig>()\n      const pageInfos: PageInfos = new Map<string, PageInfo>()\n      const pagesManifest = await readManifest<PagesManifest>(pagesManifestPath)\n      const buildManifest = await readManifest<BuildManifest>(buildManifestPath)\n      const appBuildManifest = appDir\n        ? await readManifest<AppBuildManifest>(appBuildManifestPath)\n        : undefined\n\n      const isAppPPREnabled = checkIsAppPPREnabled(config.experimental.ppr)\n\n      const appPathRoutes: Record<string, string> = {}\n\n      if (appDir) {\n        const appPathsManifest = await readManifest<Record<string, string>>(\n          path.join(distDir, SERVER_DIRECTORY, APP_PATHS_MANIFEST)\n        )\n\n        for (const key in appPathsManifest) {\n          appPathRoutes[key] = normalizeAppPath(key)\n        }\n\n        await writeManifest(\n          path.join(distDir, APP_PATH_ROUTES_MANIFEST),\n          appPathRoutes\n        )\n      }\n\n      process.env.NEXT_PHASE = PHASE_PRODUCTION_BUILD\n\n      let incrementalCacheIpcPort\n      let incrementalCacheIpcValidationKey\n\n      if (config.experimental.staticWorkerRequestDeduping) {\n        let CacheHandler\n        if (cacheHandler) {\n          CacheHandler = interopDefault(\n            await import(formatDynamicImportPath(dir, cacheHandler)).then(\n              (mod) => mod.default || mod\n            )\n          )\n        }\n\n        const cacheInitialization = await initializeIncrementalCache({\n          fs: nodeFs,\n          dev: false,\n          pagesDir: true,\n          appDir: true,\n          fetchCache: true,\n          flushToDisk: ciEnvironment.hasNextSupport\n            ? false\n            : config.experimental.isrFlushToDisk,\n          serverDistDir: path.join(distDir, 'server'),\n          fetchCacheKeyPrefix: config.experimental.fetchCacheKeyPrefix,\n          maxMemoryCacheSize: config.cacheMaxMemorySize,\n          getPrerenderManifest: () => ({\n            version: -1 as any, // letting us know this doesn't conform to spec\n            routes: {},\n            dynamicRoutes: {},\n            notFoundRoutes: [],\n            preview: null as any, // `preview` is special case read in next-dev-server\n          }),\n          requestHeaders: {},\n          CurCacheHandler: CacheHandler,\n          minimalMode: ciEnvironment.hasNextSupport,\n          allowedRevalidateHeaderKeys:\n            config.experimental.allowedRevalidateHeaderKeys,\n          isAppPPREnabled,\n        })\n\n        incrementalCacheIpcPort = cacheInitialization.ipcPort\n        incrementalCacheIpcValidationKey = cacheInitialization.ipcValidationKey\n      }\n\n      const pagesStaticWorkers = createStaticWorker(\n        config,\n\n        incrementalCacheIpcPort,\n        incrementalCacheIpcValidationKey\n      )\n      const appStaticWorkers = appDir\n        ? createStaticWorker(\n            config,\n            incrementalCacheIpcPort,\n            incrementalCacheIpcValidationKey\n          )\n        : undefined\n\n      const analysisBegin = process.hrtime()\n      const staticCheckSpan = nextBuildSpan.traceChild('static-check')\n\n      const functionsConfigManifest: FunctionsConfigManifest = {\n        version: 1,\n        functions: {},\n      }\n\n      const {\n        customAppGetInitialProps,\n        namedExports,\n        isNextImageImported,\n        hasSsrAmpPages,\n        hasNonStaticErrorPage,\n      } = await staticCheckSpan.traceAsyncFn(async () => {\n        if (isCompileMode) {\n          return {\n            customAppGetInitialProps: false,\n            namedExports: [],\n            isNextImageImported: true,\n            hasSsrAmpPages: !!pagesDir,\n            hasNonStaticErrorPage: true,\n          }\n        }\n\n        const { configFileName, publicRuntimeConfig, serverRuntimeConfig } =\n          config\n        const runtimeEnvConfig = { publicRuntimeConfig, serverRuntimeConfig }\n\n        const nonStaticErrorPageSpan = staticCheckSpan.traceChild(\n          'check-static-error-page'\n        )\n        const errorPageHasCustomGetInitialProps =\n          nonStaticErrorPageSpan.traceAsyncFn(\n            async () =>\n              hasCustomErrorPage &&\n              (await pagesStaticWorkers.hasCustomGetInitialProps({\n                page: '/_error',\n                distDir,\n                runtimeEnvConfig,\n                checkingApp: false,\n              }))\n          )\n\n        const errorPageStaticResult = nonStaticErrorPageSpan.traceAsyncFn(\n          async () =>\n            hasCustomErrorPage &&\n            pagesStaticWorkers.isPageStatic({\n              dir,\n              page: '/_error',\n              distDir,\n              configFileName,\n              runtimeEnvConfig,\n              httpAgentOptions: config.httpAgentOptions,\n              locales: config.i18n?.locales,\n              defaultLocale: config.i18n?.defaultLocale,\n              nextConfigOutput: config.output,\n              pprConfig: config.experimental.ppr,\n            })\n        )\n\n        const appPageToCheck = '/_app'\n\n        const customAppGetInitialPropsPromise =\n          pagesStaticWorkers.hasCustomGetInitialProps({\n            page: appPageToCheck,\n            distDir,\n            runtimeEnvConfig,\n            checkingApp: true,\n          })\n\n        const namedExportsPromise = pagesStaticWorkers.getDefinedNamedExports({\n          page: appPageToCheck,\n          distDir,\n          runtimeEnvConfig,\n        })\n\n        // eslint-disable-next-line @typescript-eslint/no-shadow\n        let isNextImageImported: boolean | undefined\n        // eslint-disable-next-line @typescript-eslint/no-shadow\n        let hasSsrAmpPages = false\n\n        const computedManifestData = await computeFromManifest(\n          { build: buildManifest, app: appBuildManifest },\n          distDir,\n          config.experimental.gzipSize\n        )\n\n        const middlewareManifest: MiddlewareManifest = require(\n          path.join(distDir, SERVER_DIRECTORY, MIDDLEWARE_MANIFEST)\n        )\n\n        const actionManifest = appDir\n          ? (require(\n              path.join(\n                distDir,\n                SERVER_DIRECTORY,\n                SERVER_REFERENCE_MANIFEST + '.json'\n              )\n            ) as ActionManifest)\n          : null\n        const entriesWithAction = actionManifest ? new Set() : null\n        if (actionManifest && entriesWithAction) {\n          for (const id in actionManifest.node) {\n            for (const entry in actionManifest.node[id].workers) {\n              entriesWithAction.add(entry)\n            }\n          }\n          for (const id in actionManifest.edge) {\n            for (const entry in actionManifest.edge[id].workers) {\n              entriesWithAction.add(entry)\n            }\n          }\n        }\n\n        for (const key of Object.keys(middlewareManifest?.functions)) {\n          if (key.startsWith('/api')) {\n            edgeRuntimePagesCount++\n          }\n        }\n\n        await Promise.all(\n          Object.entries(pageKeys)\n            .reduce<Array<{ pageType: keyof typeof pageKeys; page: string }>>(\n              (acc, [key, files]) => {\n                if (!files) {\n                  return acc\n                }\n\n                const pageType = key as keyof typeof pageKeys\n\n                for (const page of files) {\n                  acc.push({ pageType, page })\n                }\n\n                return acc\n              },\n              []\n            )\n            .map(({ pageType, page }) => {\n              const checkPageSpan = staticCheckSpan.traceChild('check-page', {\n                page,\n              })\n              return checkPageSpan.traceAsyncFn(async () => {\n                const actualPage = normalizePagePath(page)\n                const [size, totalSize] = await getJsPageSizeInKb(\n                  pageType,\n                  actualPage,\n                  distDir,\n                  buildManifest,\n                  appBuildManifest,\n                  config.experimental.gzipSize,\n                  computedManifestData\n                )\n\n                let isRoutePPREnabled = false\n                let isSSG = false\n                let isStatic = false\n                let isServerComponent = false\n                let isHybridAmp = false\n                let ssgPageRoutes: string[] | null = null\n                let pagePath = ''\n\n                if (pageType === 'pages') {\n                  pagePath =\n                    pagesPaths.find((p) => {\n                      p = normalizePathSep(p)\n                      return (\n                        p.startsWith(actualPage + '.') ||\n                        p.startsWith(actualPage + '/index.')\n                      )\n                    }) || ''\n                }\n                let originalAppPath: string | undefined\n\n                if (pageType === 'app' && mappedAppPages) {\n                  for (const [originalPath, normalizedPath] of Object.entries(\n                    appPathRoutes\n                  )) {\n                    if (normalizedPath === page) {\n                      pagePath = mappedAppPages[originalPath].replace(\n                        /^private-next-app-dir/,\n                        ''\n                      )\n                      originalAppPath = originalPath\n                      break\n                    }\n                  }\n                }\n\n                const pageFilePath = isAppBuiltinNotFoundPage(pagePath)\n                  ? require.resolve(\n                      'next/dist/client/components/not-found-error'\n                    )\n                  : path.join(\n                      (pageType === 'pages' ? pagesDir : appDir) || '',\n                      pagePath\n                    )\n\n                const staticInfo = pagePath\n                  ? await getPageStaticInfo({\n                      pageFilePath,\n                      nextConfig: config,\n                      // TODO: fix type mismatch\n                      pageType:\n                        pageType === 'app' ? PAGE_TYPES.APP : PAGE_TYPES.PAGES,\n                    })\n                  : undefined\n\n                if (staticInfo?.extraConfig) {\n                  functionsConfigManifest.functions[page] =\n                    staticInfo.extraConfig\n                }\n\n                const pageRuntime = middlewareManifest.functions[\n                  originalAppPath || page\n                ]\n                  ? 'edge'\n                  : staticInfo?.runtime\n\n                if (!isCompileMode) {\n                  isServerComponent =\n                    pageType === 'app' &&\n                    staticInfo?.rsc !== RSC_MODULE_TYPES.client\n\n                  if (pageType === 'app' || !isReservedPage(page)) {\n                    try {\n                      let edgeInfo: any\n\n                      if (isEdgeRuntime(pageRuntime)) {\n                        if (pageType === 'app') {\n                          edgeRuntimeAppCount++\n                        } else {\n                          edgeRuntimePagesCount++\n                        }\n\n                        const manifestKey =\n                          pageType === 'pages' ? page : originalAppPath || ''\n\n                        edgeInfo = middlewareManifest.functions[manifestKey]\n                      }\n\n                      let isPageStaticSpan =\n                        checkPageSpan.traceChild('is-page-static')\n                      let workerResult = await isPageStaticSpan.traceAsyncFn(\n                        () => {\n                          return (\n                            pageType === 'app'\n                              ? appStaticWorkers\n                              : pagesStaticWorkers\n                          )!.isPageStatic({\n                            dir,\n                            page,\n                            originalAppPath,\n                            distDir,\n                            configFileName,\n                            runtimeEnvConfig,\n                            httpAgentOptions: config.httpAgentOptions,\n                            locales: config.i18n?.locales,\n                            defaultLocale: config.i18n?.defaultLocale,\n                            parentId: isPageStaticSpan.getId(),\n                            pageRuntime,\n                            edgeInfo,\n                            pageType,\n                            cacheHandler: config.cacheHandler,\n                            isrFlushToDisk: ciEnvironment.hasNextSupport\n                              ? false\n                              : config.experimental.isrFlushToDisk,\n                            maxMemoryCacheSize: config.cacheMaxMemorySize,\n                            nextConfigOutput: config.output,\n                            pprConfig: config.experimental.ppr,\n                          })\n                        }\n                      )\n\n                      if (pageType === 'app' && originalAppPath) {\n                        appNormalizedPaths.set(originalAppPath, page)\n                        // TODO-APP: handle prerendering with edge\n                        if (isEdgeRuntime(pageRuntime)) {\n                          isStatic = false\n                          isSSG = false\n\n                          Log.warnOnce(\n                            `Using edge runtime on a page currently disables static generation for that page`\n                          )\n                        } else {\n                          // If this route can be partially pre-rendered, then\n                          // mark it as such and mark that it can be\n                          // generated server-side.\n                          if (workerResult.isRoutePPREnabled) {\n                            isRoutePPREnabled = workerResult.isRoutePPREnabled\n                            isSSG = true\n                            isStatic = true\n\n                            appStaticPaths.set(originalAppPath, [])\n                            appStaticPathsEncoded.set(originalAppPath, [])\n                          }\n\n                          if (\n                            workerResult.encodedPrerenderRoutes &&\n                            workerResult.prerenderRoutes\n                          ) {\n                            appStaticPaths.set(\n                              originalAppPath,\n                              workerResult.prerenderRoutes\n                            )\n                            appStaticPathsEncoded.set(\n                              originalAppPath,\n                              workerResult.encodedPrerenderRoutes\n                            )\n                            ssgPageRoutes = workerResult.prerenderRoutes\n                            isSSG = true\n                          }\n\n                          const appConfig = workerResult.appConfig || {}\n                          const isInterceptionRoute =\n                            isInterceptionRouteAppPath(page)\n                          if (appConfig.revalidate !== 0) {\n                            const isDynamic = isDynamicRoute(page)\n                            const hasGenerateStaticParams =\n                              !!workerResult.prerenderRoutes?.length\n\n                            if (\n                              config.output === 'export' &&\n                              isDynamic &&\n                              !hasGenerateStaticParams\n                            ) {\n                              throw new Error(\n                                `Page \"${page}\" is missing \"generateStaticParams()\" so it cannot be used with \"output: export\" config.`\n                              )\n                            }\n\n                            // Mark the app as static if:\n                            // - It's not an interception route (these currently depend on request headers and cannot be computed at build)\n                            // - It has no dynamic param\n                            // - It doesn't have generateStaticParams but `dynamic` is set to\n                            //   `error` or `force-static`\n                            if (!isInterceptionRoute) {\n                              if (!isDynamic) {\n                                appStaticPaths.set(originalAppPath, [page])\n                                appStaticPathsEncoded.set(originalAppPath, [\n                                  page,\n                                ])\n                                isStatic = true\n                              } else if (\n                                !hasGenerateStaticParams &&\n                                (appConfig.dynamic === 'error' ||\n                                  appConfig.dynamic === 'force-static')\n                              ) {\n                                appStaticPaths.set(originalAppPath, [])\n                                appStaticPathsEncoded.set(originalAppPath, [])\n                                isStatic = true\n                                isRoutePPREnabled = false\n                              }\n                            }\n                          }\n\n                          if (workerResult.prerenderFallback) {\n                            // whether or not to allow requests for paths not\n                            // returned from generateStaticParams\n                            appDynamicParamPaths.add(originalAppPath)\n                          }\n                          appDefaultConfigs.set(originalAppPath, appConfig)\n                        }\n                      } else {\n                        if (isEdgeRuntime(pageRuntime)) {\n                          if (workerResult.hasStaticProps) {\n                            console.warn(\n                              `\"getStaticProps\" is not yet supported fully with \"experimental-edge\", detected on ${page}`\n                            )\n                          }\n                          // TODO: add handling for statically rendering edge\n                          // pages and allow edge with Prerender outputs\n                          workerResult.isStatic = false\n                          workerResult.hasStaticProps = false\n                        }\n\n                        if (\n                          workerResult.isStatic === false &&\n                          (workerResult.isHybridAmp || workerResult.isAmpOnly)\n                        ) {\n                          hasSsrAmpPages = true\n                        }\n\n                        if (workerResult.isHybridAmp) {\n                          isHybridAmp = true\n                          hybridAmpPages.add(page)\n                        }\n\n                        if (workerResult.isNextImageImported) {\n                          isNextImageImported = true\n                        }\n\n                        if (workerResult.hasStaticProps) {\n                          ssgPages.add(page)\n                          isSSG = true\n\n                          if (\n                            workerResult.prerenderRoutes &&\n                            workerResult.encodedPrerenderRoutes\n                          ) {\n                            additionalSsgPaths.set(\n                              page,\n                              workerResult.prerenderRoutes\n                            )\n                            additionalSsgPathsEncoded.set(\n                              page,\n                              workerResult.encodedPrerenderRoutes\n                            )\n                            ssgPageRoutes = workerResult.prerenderRoutes\n                          }\n\n                          if (workerResult.prerenderFallback === 'blocking') {\n                            ssgBlockingFallbackPages.add(page)\n                          } else if (workerResult.prerenderFallback === true) {\n                            ssgStaticFallbackPages.add(page)\n                          }\n                        } else if (workerResult.hasServerProps) {\n                          serverPropsPages.add(page)\n                        } else if (\n                          workerResult.isStatic &&\n                          !isServerComponent &&\n                          (await customAppGetInitialPropsPromise) === false\n                        ) {\n                          staticPages.add(page)\n                          isStatic = true\n                        } else if (isServerComponent) {\n                          // This is a static server component page that doesn't have\n                          // gSP or gSSP. We still treat it as a SSG page.\n                          ssgPages.add(page)\n                          isSSG = true\n                        }\n\n                        if (hasPages404 && page === '/404') {\n                          if (\n                            !workerResult.isStatic &&\n                            !workerResult.hasStaticProps\n                          ) {\n                            throw new Error(\n                              `\\`pages/404\\` ${STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR}`\n                            )\n                          }\n                          // we need to ensure the 404 lambda is present since we use\n                          // it when _app has getInitialProps\n                          if (\n                            (await customAppGetInitialPropsPromise) &&\n                            !workerResult.hasStaticProps\n                          ) {\n                            staticPages.delete(page)\n                          }\n                        }\n\n                        if (\n                          STATIC_STATUS_PAGES.includes(page) &&\n                          !workerResult.isStatic &&\n                          !workerResult.hasStaticProps\n                        ) {\n                          throw new Error(\n                            `\\`pages${page}\\` ${STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR}`\n                          )\n                        }\n                      }\n                    } catch (err) {\n                      if (\n                        !isError(err) ||\n                        err.message !== 'INVALID_DEFAULT_EXPORT'\n                      )\n                        throw err\n                      invalidPages.add(page)\n                    }\n                  }\n\n                  if (pageType === 'app') {\n                    if (isSSG || isStatic) {\n                      staticAppPagesCount++\n                    } else {\n                      serverAppPagesCount++\n                    }\n                  }\n                }\n\n                pageInfos.set(page, {\n                  size,\n                  totalSize,\n                  isStatic,\n                  isSSG,\n                  isRoutePPREnabled,\n                  isHybridAmp,\n                  ssgPageRoutes,\n                  initialRevalidateSeconds: false,\n                  runtime: pageRuntime,\n                  pageDuration: undefined,\n                  ssgPageDurations: undefined,\n                  hasEmptyPrelude: undefined,\n                })\n              })\n            })\n        )\n\n        const errorPageResult = await errorPageStaticResult\n        const nonStaticErrorPage =\n          (await errorPageHasCustomGetInitialProps) ||\n          (errorPageResult && errorPageResult.hasServerProps)\n\n        const returnValue = {\n          customAppGetInitialProps: await customAppGetInitialPropsPromise,\n          namedExports: await namedExportsPromise,\n          isNextImageImported,\n          hasSsrAmpPages,\n          hasNonStaticErrorPage: nonStaticErrorPage,\n        }\n\n        return returnValue\n      })\n\n      if (postCompileSpinner) postCompileSpinner.stopAndPersist()\n      traceMemoryUsage('Finished collecting page data', nextBuildSpan)\n\n      if (customAppGetInitialProps) {\n        console.warn(\n          bold(yellow(`Warning: `)) +\n            yellow(\n              `You have opted-out of Automatic Static Optimization due to \\`getInitialProps\\` in \\`pages/_app\\`. This does not opt-out pages with \\`getStaticProps\\``\n            )\n        )\n        console.warn(\n          'Read more: https://nextjs.org/docs/messages/opt-out-auto-static-optimization\\n'\n        )\n      }\n\n      if (!hasSsrAmpPages) {\n        requiredServerFilesManifest.ignore.push(\n          path.relative(\n            dir,\n            path.join(\n              path.dirname(\n                require.resolve(\n                  'next/dist/compiled/@ampproject/toolbox-optimizer'\n                )\n              ),\n              '**/*'\n            )\n          )\n        )\n      }\n\n      await writeFunctionsConfigManifest(distDir, functionsConfigManifest)\n\n      if (!isGenerateMode && !buildTracesPromise) {\n        buildTracesPromise = collectBuildTraces({\n          dir,\n          config,\n          distDir,\n          edgeRuntimeRoutes: collectRoutesUsingEdgeRuntime(pageInfos),\n          staticPages: [...staticPages],\n          nextBuildSpan,\n          hasSsrAmpPages,\n          buildTraceContext,\n          outputFileTracingRoot,\n          isFlyingShuttle: !!config.experimental.flyingShuttle,\n        }).catch((err) => {\n          console.error(err)\n          process.exit(1)\n        })\n      }\n\n      if (serverPropsPages.size > 0 || ssgPages.size > 0) {\n        // We update the routes manifest after the build with the\n        // data routes since we can't determine these until after build\n        routesManifest.dataRoutes = getSortedRoutes([\n          ...serverPropsPages,\n          ...ssgPages,\n        ]).map((page) => {\n          return buildDataRoute(page, buildId)\n        })\n\n        await writeManifest(routesManifestPath, routesManifest)\n      }\n\n      // Since custom _app.js can wrap the 404 page we have to opt-out of static optimization if it has getInitialProps\n      // Only export the static 404 when there is no /_error present\n      const useStaticPages404 =\n        !customAppGetInitialProps && (!hasNonStaticErrorPage || hasPages404)\n\n      if (invalidPages.size > 0) {\n        const err = new Error(\n          `Build optimization failed: found page${\n            invalidPages.size === 1 ? '' : 's'\n          } without a React Component as default export in \\n${[...invalidPages]\n            .map((pg) => `pages${pg}`)\n            .join(\n              '\\n'\n            )}\\n\\nSee https://nextjs.org/docs/messages/page-without-valid-component for more info.\\n`\n        ) as NextError\n        err.code = 'BUILD_OPTIMIZATION_FAILED'\n        throw err\n      }\n\n      await writeBuildId(distDir, buildId)\n\n      if (config.experimental.optimizeCss) {\n        const globOrig =\n          require('next/dist/compiled/glob') as typeof import('next/dist/compiled/glob')\n\n        const cssFilePaths = await new Promise<string[]>((resolve, reject) => {\n          globOrig(\n            '**/*.css',\n            { cwd: path.join(distDir, 'static') },\n            (err, files) => {\n              if (err) {\n                return reject(err)\n              }\n              resolve(files)\n            }\n          )\n        })\n\n        requiredServerFilesManifest.files.push(\n          ...cssFilePaths.map((filePath) =>\n            path.join(config.distDir, 'static', filePath)\n          )\n        )\n      }\n\n      const features: EventBuildFeatureUsage[] = [\n        {\n          featureName: 'experimental/optimizeCss',\n          invocationCount: config.experimental.optimizeCss ? 1 : 0,\n        },\n        {\n          featureName: 'experimental/nextScriptWorkers',\n          invocationCount: config.experimental.nextScriptWorkers ? 1 : 0,\n        },\n        {\n          featureName: 'optimizeFonts',\n          invocationCount: config.optimizeFonts ? 1 : 0,\n        },\n        {\n          featureName: 'experimental/ppr',\n          invocationCount: config.experimental.ppr ? 1 : 0,\n        },\n      ]\n      telemetry.record(\n        features.map((feature) => {\n          return {\n            eventName: EVENT_BUILD_FEATURE_USAGE,\n            payload: feature,\n          }\n        })\n      )\n\n      await writeRequiredServerFilesManifest(\n        distDir,\n        requiredServerFilesManifest\n      )\n\n      const middlewareManifest: MiddlewareManifest = await readManifest(\n        path.join(distDir, SERVER_DIRECTORY, MIDDLEWARE_MANIFEST)\n      )\n\n      const finalPrerenderRoutes: { [route: string]: SsgRoute } = {}\n      const finalDynamicRoutes: PrerenderManifest['dynamicRoutes'] = {}\n      const tbdPrerenderRoutes: string[] = []\n      let ssgNotFoundPaths: string[] = []\n\n      const { i18n } = config\n\n      const usedStaticStatusPages = STATIC_STATUS_PAGES.filter(\n        (page) =>\n          mappedPages[page] &&\n          mappedPages[page].startsWith('private-next-pages')\n      )\n      usedStaticStatusPages.forEach((page) => {\n        if (!ssgPages.has(page) && !customAppGetInitialProps) {\n          staticPages.add(page)\n        }\n      })\n\n      const hasPages500 = usedStaticStatusPages.includes('/500')\n      const useDefaultStatic500 =\n        !hasPages500 && !hasNonStaticErrorPage && !customAppGetInitialProps\n\n      const combinedPages = [...staticPages, ...ssgPages]\n      const isApp404Static = appStaticPaths.has(\n        UNDERSCORE_NOT_FOUND_ROUTE_ENTRY\n      )\n      const hasStaticApp404 = hasApp404 && isApp404Static\n\n      // we need to trigger automatic exporting when we have\n      // - static 404/500\n      // - getStaticProps paths\n      // - experimental app is enabled\n      if (\n        !isCompileMode &&\n        (combinedPages.length > 0 ||\n          useStaticPages404 ||\n          useDefaultStatic500 ||\n          appDir)\n      ) {\n        const staticGenerationSpan =\n          nextBuildSpan.traceChild('static-generation')\n        await staticGenerationSpan.traceAsyncFn(async () => {\n          detectConflictingPaths(\n            [\n              ...combinedPages,\n              ...pageKeys.pages.filter((page) => !combinedPages.includes(page)),\n            ],\n            ssgPages,\n            additionalSsgPaths\n          )\n          const exportApp = require('../export')\n            .default as typeof import('../export').default\n\n          const exportConfig: NextConfigComplete = {\n            ...config,\n            // Default map will be the collection of automatic statically exported\n            // pages and incremental pages.\n            // n.b. we cannot handle this above in combinedPages because the dynamic\n            // page must be in the `pages` array, but not in the mapping.\n            exportPathMap: (defaultMap: ExportPathMap) => {\n              // Dynamically routed pages should be prerendered to be used as\n              // a client-side skeleton (fallback) while data is being fetched.\n              // This ensures the end-user never sees a 500 or slow response from the\n              // server.\n              //\n              // Note: prerendering disables automatic static optimization.\n              ssgPages.forEach((page) => {\n                if (isDynamicRoute(page)) {\n                  tbdPrerenderRoutes.push(page)\n\n                  if (ssgStaticFallbackPages.has(page)) {\n                    // Override the rendering for the dynamic page to be treated as a\n                    // fallback render.\n                    if (i18n) {\n                      defaultMap[`/${i18n.defaultLocale}${page}`] = {\n                        page,\n                        query: { __nextFallback: 'true' },\n                      }\n                    } else {\n                      defaultMap[page] = {\n                        page,\n                        query: { __nextFallback: 'true' },\n                      }\n                    }\n                  } else {\n                    // Remove dynamically routed pages from the default path map when\n                    // fallback behavior is disabled.\n                    delete defaultMap[page]\n                  }\n                }\n              })\n\n              // Append the \"well-known\" routes we should prerender for, e.g. blog\n              // post slugs.\n              additionalSsgPaths.forEach((routes, page) => {\n                const encodedRoutes = additionalSsgPathsEncoded.get(page)\n\n                routes.forEach((route, routeIdx) => {\n                  defaultMap[route] = {\n                    page,\n                    query: { __nextSsgPath: encodedRoutes?.[routeIdx] },\n                  }\n                })\n              })\n\n              if (useStaticPages404) {\n                defaultMap['/404'] = {\n                  page: hasPages404 ? '/404' : '/_error',\n                }\n              }\n\n              if (useDefaultStatic500) {\n                defaultMap['/500'] = {\n                  page: '/_error',\n                }\n              }\n\n              // TODO: output manifest specific to app paths and their\n              // revalidate periods and dynamicParams settings\n              appStaticPaths.forEach((routes, originalAppPath) => {\n                const encodedRoutes = appStaticPathsEncoded.get(originalAppPath)\n                const appConfig = appDefaultConfigs.get(originalAppPath)\n\n                routes.forEach((route, routeIdx) => {\n                  defaultMap[route] = {\n                    page: originalAppPath,\n                    query: { __nextSsgPath: encodedRoutes?.[routeIdx] },\n                    _isDynamicError: appConfig?.dynamic === 'error',\n                    _isAppDir: true,\n                    _isRoutePPREnabled: appConfig\n                      ? checkIsRoutePPREnabled(\n                          config.experimental.ppr,\n                          appConfig\n                        )\n                      : undefined,\n                  }\n                })\n              })\n\n              if (i18n) {\n                for (const page of [\n                  ...staticPages,\n                  ...ssgPages,\n                  ...(useStaticPages404 ? ['/404'] : []),\n                  ...(useDefaultStatic500 ? ['/500'] : []),\n                ]) {\n                  const isSsg = ssgPages.has(page)\n                  const isDynamic = isDynamicRoute(page)\n                  const isFallback = isSsg && ssgStaticFallbackPages.has(page)\n\n                  for (const locale of i18n.locales) {\n                    // skip fallback generation for SSG pages without fallback mode\n                    if (isSsg && isDynamic && !isFallback) continue\n                    const outputPath = `/${locale}${page === '/' ? '' : page}`\n\n                    defaultMap[outputPath] = {\n                      page: defaultMap[page]?.page || page,\n                      query: {\n                        __nextLocale: locale,\n                        __nextFallback: isFallback ? 'true' : undefined,\n                      },\n                    }\n                  }\n\n                  if (isSsg) {\n                    // remove non-locale prefixed variant from defaultMap\n                    delete defaultMap[page]\n                  }\n                }\n              }\n\n              return defaultMap\n            },\n          }\n\n          const exportOptions: ExportAppOptions = {\n            nextConfig: exportConfig,\n            enabledDirectories,\n            silent: false,\n            buildExport: true,\n            debugOutput,\n            threads: config.experimental.cpus,\n            pages: combinedPages,\n            outdir: path.join(distDir, 'export'),\n            statusMessage: 'Generating static pages',\n            // The worker already explicitly binds `this` to each of the\n            // exposed methods.\n            exportAppPageWorker: appStaticWorkers?.exportPage,\n            exportPageWorker: pagesStaticWorkers?.exportPage,\n            endWorker: async () => {\n              await pagesStaticWorkers.end()\n              await appStaticWorkers?.end()\n            },\n          }\n\n          const exportResult = await exportApp(\n            dir,\n            exportOptions,\n            nextBuildSpan\n          )\n\n          // If there was no result, there's nothing more to do.\n          if (!exportResult) return\n\n          writeTurborepoAccessTraceResult({\n            distDir: config.distDir,\n            traces: [\n              turborepoAccessTraceResult,\n              ...exportResult.turborepoAccessTraceResults.values(),\n            ],\n          })\n\n          ssgNotFoundPaths = Array.from(exportResult.ssgNotFoundPaths)\n\n          // remove server bundles that were exported\n          for (const page of staticPages) {\n            const serverBundle = getPagePath(page, distDir, undefined, false)\n            await fs.unlink(serverBundle)\n          }\n\n          for (const [originalAppPath, routes] of appStaticPaths) {\n            const page = appNormalizedPaths.get(originalAppPath) || ''\n            const appConfig = appDefaultConfigs.get(originalAppPath) || {}\n            let hasDynamicData =\n              appConfig.revalidate === 0 ||\n              exportResult.byPath.get(page)?.revalidate === 0\n\n            if (hasDynamicData && pageInfos.get(page)?.isStatic) {\n              // if the page was marked as being static, but it contains dynamic data\n              // (ie, in the case of a static generation bailout), then it should be marked dynamic\n              pageInfos.set(page, {\n                ...(pageInfos.get(page) as PageInfo),\n                isStatic: false,\n                isSSG: false,\n              })\n            }\n\n            const isRouteHandler = isAppRouteRoute(originalAppPath)\n\n            // When this is an app page and PPR is enabled, the route supports\n            // partial pre-rendering.\n            const experimentalPPR: true | undefined =\n              !isRouteHandler &&\n              checkIsRoutePPREnabled(config.experimental.ppr, appConfig)\n                ? true\n                : undefined\n\n            // this flag is used to selectively bypass the static cache and invoke the lambda directly\n            // to enable server actions on static routes\n            const bypassFor: RouteHas[] = [\n              { type: 'header', key: ACTION },\n              {\n                type: 'header',\n                key: 'content-type',\n                value: 'multipart/form-data;.*',\n              },\n            ]\n\n            // Always sort the routes to get consistent output in manifests\n            getSortedRoutes(routes).forEach((route) => {\n              if (isDynamicRoute(page) && route === page) return\n              if (route === UNDERSCORE_NOT_FOUND_ROUTE) return\n\n              const {\n                revalidate = appConfig.revalidate ?? false,\n                metadata = {},\n                hasEmptyPrelude,\n                hasPostponed,\n              } = exportResult.byPath.get(route) ?? {}\n\n              pageInfos.set(route, {\n                ...(pageInfos.get(route) as PageInfo),\n                hasPostponed,\n                hasEmptyPrelude,\n              })\n\n              // update the page (eg /blog/[slug]) to also have the postpone metadata\n              pageInfos.set(page, {\n                ...(pageInfos.get(page) as PageInfo),\n                hasPostponed,\n                hasEmptyPrelude,\n              })\n\n              if (revalidate !== 0) {\n                const normalizedRoute = normalizePagePath(route)\n\n                let dataRoute: string | null\n                if (isRouteHandler) {\n                  dataRoute = null\n                } else {\n                  dataRoute = path.posix.join(`${normalizedRoute}${RSC_SUFFIX}`)\n                }\n\n                let prefetchDataRoute: string | null | undefined\n                // We write the `.prefetch.rsc` when the app has PPR enabled, so\n                // always add the prefetch data route to the manifest.\n                if (!isRouteHandler && experimentalPPR) {\n                  prefetchDataRoute = path.posix.join(\n                    `${normalizedRoute}${RSC_PREFETCH_SUFFIX}`\n                  )\n                }\n\n                const routeMeta: Partial<SsgRoute> = {}\n\n                if (metadata.status !== 200) {\n                  routeMeta.initialStatus = metadata.status\n                }\n\n                const exportHeaders = metadata.headers\n                const headerKeys = Object.keys(exportHeaders || {})\n\n                if (exportHeaders && headerKeys.length) {\n                  routeMeta.initialHeaders = {}\n\n                  // normalize header values as initialHeaders\n                  // must be Record<string, string>\n                  for (const key of headerKeys) {\n                    // set-cookie is already handled - the middleware cookie setting case\n                    // isn't needed for the prerender manifest since it can't read cookies\n                    if (key === 'x-middleware-set-cookie') continue\n\n                    let value = exportHeaders[key]\n\n                    if (Array.isArray(value)) {\n                      if (key === 'set-cookie') {\n                        value = value.join(',')\n                      } else {\n                        value = value[value.length - 1]\n                      }\n                    }\n\n                    if (typeof value === 'string') {\n                      routeMeta.initialHeaders[key] = value\n                    }\n                  }\n                }\n\n                finalPrerenderRoutes[route] = {\n                  ...routeMeta,\n                  experimentalPPR,\n                  experimentalBypassFor: bypassFor,\n                  initialRevalidateSeconds: revalidate,\n                  srcRoute: page,\n                  dataRoute,\n                  prefetchDataRoute,\n                }\n              } else {\n                hasDynamicData = true\n                // we might have determined during prerendering that this page\n                // used dynamic data\n                pageInfos.set(route, {\n                  ...(pageInfos.get(route) as PageInfo),\n                  isSSG: false,\n                  isStatic: false,\n                })\n              }\n            })\n\n            if (!hasDynamicData && isDynamicRoute(originalAppPath)) {\n              const normalizedRoute = normalizePagePath(page)\n\n              let dataRoute: string | null = null\n              if (!isRouteHandler) {\n                dataRoute = path.posix.join(`${normalizedRoute}${RSC_SUFFIX}`)\n              }\n\n              let prefetchDataRoute: string | undefined\n\n              // We write the `.prefetch.rsc` when the app has PPR enabled, so\n              // always add the prefetch data route to the manifest.\n              if (!isRouteHandler && isAppPPREnabled) {\n                prefetchDataRoute = path.posix.join(\n                  `${normalizedRoute}${RSC_PREFETCH_SUFFIX}`\n                )\n              }\n\n              pageInfos.set(page, {\n                ...(pageInfos.get(page) as PageInfo),\n                isDynamicAppRoute: true,\n                // if PPR is turned on and the route contains a dynamic segment,\n                // we assume it'll be partially prerendered\n                hasPostponed: experimentalPPR,\n              })\n\n              // TODO: create a separate manifest to allow enforcing\n              // dynamicParams for non-static paths?\n              finalDynamicRoutes[page] = {\n                experimentalPPR,\n                experimentalBypassFor: bypassFor,\n                routeRegex: normalizeRouteRegex(\n                  getNamedRouteRegex(page, false).re.source\n                ),\n                dataRoute,\n                // if dynamicParams are enabled treat as fallback:\n                // 'blocking' if not it's fallback: false\n                fallback: appDynamicParamPaths.has(originalAppPath)\n                  ? null\n                  : false,\n                dataRouteRegex: !dataRoute\n                  ? null\n                  : normalizeRouteRegex(\n                      getNamedRouteRegex(\n                        dataRoute.replace(/\\.rsc$/, ''),\n                        false\n                      ).re.source.replace(/\\(\\?:\\\\\\/\\)\\?\\$$/, '\\\\.rsc$')\n                    ),\n                prefetchDataRoute,\n                prefetchDataRouteRegex: !prefetchDataRoute\n                  ? undefined\n                  : normalizeRouteRegex(\n                      getNamedRouteRegex(\n                        prefetchDataRoute.replace(/\\.prefetch\\.rsc$/, ''),\n                        false\n                      ).re.source.replace(\n                        /\\(\\?:\\\\\\/\\)\\?\\$$/,\n                        '\\\\.prefetch\\\\.rsc$'\n                      )\n                    ),\n              }\n            }\n          }\n\n          const moveExportedPage = async (\n            originPage: string,\n            page: string,\n            file: string,\n            isSsg: boolean,\n            ext: 'html' | 'json',\n            additionalSsgFile = false\n          ) => {\n            return staticGenerationSpan\n              .traceChild('move-exported-page')\n              .traceAsyncFn(async () => {\n                file = `${file}.${ext}`\n                const orig = path.join(exportOptions.outdir, file)\n                const pagePath = getPagePath(\n                  originPage,\n                  distDir,\n                  undefined,\n                  false\n                )\n\n                const relativeDest = path\n                  .relative(\n                    path.join(distDir, SERVER_DIRECTORY),\n                    path.join(\n                      path.join(\n                        pagePath,\n                        // strip leading / and then recurse number of nested dirs\n                        // to place from base folder\n                        originPage\n                          .slice(1)\n                          .split('/')\n                          .map(() => '..')\n                          .join('/')\n                      ),\n                      file\n                    )\n                  )\n                  .replace(/\\\\/g, '/')\n\n                if (\n                  !isSsg &&\n                  !(\n                    // don't add static status page to manifest if it's\n                    // the default generated version e.g. no pages/500\n                    (\n                      STATIC_STATUS_PAGES.includes(page) &&\n                      !usedStaticStatusPages.includes(page)\n                    )\n                  )\n                ) {\n                  pagesManifest[page] = relativeDest\n                }\n\n                const dest = path.join(distDir, SERVER_DIRECTORY, relativeDest)\n                const isNotFound = ssgNotFoundPaths.includes(page)\n\n                // for SSG files with i18n the non-prerendered variants are\n                // output with the locale prefixed so don't attempt moving\n                // without the prefix\n                if ((!i18n || additionalSsgFile) && !isNotFound) {\n                  await fs.mkdir(path.dirname(dest), { recursive: true })\n                  await fs.rename(orig, dest)\n                } else if (i18n && !isSsg) {\n                  // this will be updated with the locale prefixed variant\n                  // since all files are output with the locale prefix\n                  delete pagesManifest[page]\n                }\n\n                if (i18n) {\n                  if (additionalSsgFile) return\n\n                  const localeExt = page === '/' ? path.extname(file) : ''\n                  const relativeDestNoPages = relativeDest.slice(\n                    'pages/'.length\n                  )\n\n                  for (const locale of i18n.locales) {\n                    const curPath = `/${locale}${page === '/' ? '' : page}`\n\n                    if (isSsg && ssgNotFoundPaths.includes(curPath)) {\n                      continue\n                    }\n\n                    const updatedRelativeDest = path\n                      .join(\n                        'pages',\n                        locale + localeExt,\n                        // if it's the top-most index page we want it to be locale.EXT\n                        // instead of locale/index.html\n                        page === '/' ? '' : relativeDestNoPages\n                      )\n                      .replace(/\\\\/g, '/')\n\n                    const updatedOrig = path.join(\n                      exportOptions.outdir,\n                      locale + localeExt,\n                      page === '/' ? '' : file\n                    )\n                    const updatedDest = path.join(\n                      distDir,\n                      SERVER_DIRECTORY,\n                      updatedRelativeDest\n                    )\n\n                    if (!isSsg) {\n                      pagesManifest[curPath] = updatedRelativeDest\n                    }\n                    await fs.mkdir(path.dirname(updatedDest), {\n                      recursive: true,\n                    })\n                    await fs.rename(updatedOrig, updatedDest)\n                  }\n                }\n              })\n          }\n\n          async function moveExportedAppNotFoundTo404() {\n            return staticGenerationSpan\n              .traceChild('move-exported-app-not-found-')\n              .traceAsyncFn(async () => {\n                const orig = path.join(\n                  distDir,\n                  'server',\n                  'app',\n                  '_not-found.html'\n                )\n                const updatedRelativeDest = path\n                  .join('pages', '404.html')\n                  .replace(/\\\\/g, '/')\n\n                if (existsSync(orig)) {\n                  await fs.copyFile(\n                    orig,\n                    path.join(distDir, 'server', updatedRelativeDest)\n                  )\n                  pagesManifest['/404'] = updatedRelativeDest\n                }\n              })\n          }\n\n          // If there's /not-found inside app, we prefer it over the pages 404\n          if (hasStaticApp404) {\n            await moveExportedAppNotFoundTo404()\n          } else {\n            // Only move /404 to /404 when there is no custom 404 as in that case we don't know about the 404 page\n            if (!hasPages404 && !hasApp404 && useStaticPages404) {\n              await moveExportedPage('/_error', '/404', '/404', false, 'html')\n            }\n          }\n\n          if (useDefaultStatic500) {\n            await moveExportedPage('/_error', '/500', '/500', false, 'html')\n          }\n\n          for (const page of combinedPages) {\n            const isSsg = ssgPages.has(page)\n            const isStaticSsgFallback = ssgStaticFallbackPages.has(page)\n            const isDynamic = isDynamicRoute(page)\n            const hasAmp = hybridAmpPages.has(page)\n            const file = normalizePagePath(page)\n\n            const pageInfo = pageInfos.get(page)\n            const durationInfo = exportResult.byPage.get(page)\n            if (pageInfo && durationInfo) {\n              // Set Build Duration\n              if (pageInfo.ssgPageRoutes) {\n                pageInfo.ssgPageDurations = pageInfo.ssgPageRoutes.map(\n                  (pagePath) => {\n                    const duration = durationInfo.durationsByPath.get(pagePath)\n                    if (typeof duration === 'undefined') {\n                      throw new Error(\"Invariant: page wasn't built\")\n                    }\n\n                    return duration\n                  }\n                )\n              }\n              pageInfo.pageDuration = durationInfo.durationsByPath.get(page)\n            }\n\n            // The dynamic version of SSG pages are only prerendered if the\n            // fallback is enabled. Below, we handle the specific prerenders\n            // of these.\n            const hasHtmlOutput = !(isSsg && isDynamic && !isStaticSsgFallback)\n\n            if (hasHtmlOutput) {\n              await moveExportedPage(page, page, file, isSsg, 'html')\n            }\n\n            if (hasAmp && (!isSsg || (isSsg && !isDynamic))) {\n              const ampPage = `${file}.amp`\n              await moveExportedPage(page, ampPage, ampPage, isSsg, 'html')\n\n              if (isSsg) {\n                await moveExportedPage(page, ampPage, ampPage, isSsg, 'json')\n              }\n            }\n\n            if (isSsg) {\n              // For a non-dynamic SSG page, we must copy its data file\n              // from export, we already moved the HTML file above\n              if (!isDynamic) {\n                await moveExportedPage(page, page, file, isSsg, 'json')\n\n                if (i18n) {\n                  // TODO: do we want to show all locale variants in build output\n                  for (const locale of i18n.locales) {\n                    const localePage = `/${locale}${page === '/' ? '' : page}`\n\n                    finalPrerenderRoutes[localePage] = {\n                      initialRevalidateSeconds:\n                        exportResult.byPath.get(localePage)?.revalidate ??\n                        false,\n                      experimentalPPR: undefined,\n                      srcRoute: null,\n                      dataRoute: path.posix.join(\n                        '/_next/data',\n                        buildId,\n                        `${file}.json`\n                      ),\n                      prefetchDataRoute: undefined,\n                    }\n                  }\n                } else {\n                  finalPrerenderRoutes[page] = {\n                    initialRevalidateSeconds:\n                      exportResult.byPath.get(page)?.revalidate ?? false,\n                    experimentalPPR: undefined,\n                    srcRoute: null,\n                    dataRoute: path.posix.join(\n                      '/_next/data',\n                      buildId,\n                      `${file}.json`\n                    ),\n                    // Pages does not have a prefetch data route.\n                    prefetchDataRoute: undefined,\n                  }\n                }\n                // Set Page Revalidation Interval\n                if (pageInfo) {\n                  pageInfo.initialRevalidateSeconds =\n                    exportResult.byPath.get(page)?.revalidate ?? false\n                }\n              } else {\n                // For a dynamic SSG page, we did not copy its data exports and only\n                // copy the fallback HTML file (if present).\n                // We must also copy specific versions of this page as defined by\n                // `getStaticPaths` (additionalSsgPaths).\n                const extraRoutes = additionalSsgPaths.get(page) || []\n                for (const route of extraRoutes) {\n                  const pageFile = normalizePagePath(route)\n                  await moveExportedPage(\n                    page,\n                    route,\n                    pageFile,\n                    isSsg,\n                    'html',\n                    true\n                  )\n                  await moveExportedPage(\n                    page,\n                    route,\n                    pageFile,\n                    isSsg,\n                    'json',\n                    true\n                  )\n\n                  if (hasAmp) {\n                    const ampPage = `${pageFile}.amp`\n                    await moveExportedPage(\n                      page,\n                      ampPage,\n                      ampPage,\n                      isSsg,\n                      'html',\n                      true\n                    )\n                    await moveExportedPage(\n                      page,\n                      ampPage,\n                      ampPage,\n                      isSsg,\n                      'json',\n                      true\n                    )\n                  }\n\n                  const initialRevalidateSeconds =\n                    exportResult.byPath.get(route)?.revalidate ?? false\n\n                  if (typeof initialRevalidateSeconds === 'undefined') {\n                    throw new Error(\"Invariant: page wasn't built\")\n                  }\n\n                  finalPrerenderRoutes[route] = {\n                    initialRevalidateSeconds,\n                    experimentalPPR: undefined,\n                    srcRoute: page,\n                    dataRoute: path.posix.join(\n                      '/_next/data',\n                      buildId,\n                      `${normalizePagePath(route)}.json`\n                    ),\n                    // Pages does not have a prefetch data route.\n                    prefetchDataRoute: undefined,\n                  }\n\n                  // Set route Revalidation Interval\n                  if (pageInfo) {\n                    pageInfo.initialRevalidateSeconds = initialRevalidateSeconds\n                  }\n                }\n              }\n            }\n          }\n\n          // remove temporary export folder\n          await fs.rm(exportOptions.outdir, { recursive: true, force: true })\n          await writeManifest(pagesManifestPath, pagesManifest)\n        })\n      }\n\n      const postBuildSpinner = createSpinner('Finalizing page optimization')\n      let buildTracesSpinner = createSpinner(`Collecting build traces`)\n\n      // ensure the worker is not left hanging\n      pagesStaticWorkers.close()\n      appStaticWorkers?.close()\n\n      const analysisEnd = process.hrtime(analysisBegin)\n      telemetry.record(\n        eventBuildOptimize(pagesPaths, {\n          durationInSeconds: analysisEnd[0],\n          staticPageCount: staticPages.size,\n          staticPropsPageCount: ssgPages.size,\n          serverPropsPageCount: serverPropsPages.size,\n          ssrPageCount:\n            pagesPaths.length -\n            (staticPages.size + ssgPages.size + serverPropsPages.size),\n          hasStatic404: useStaticPages404,\n          hasReportWebVitals:\n            namedExports?.includes('reportWebVitals') ?? false,\n          rewritesCount: combinedRewrites.length,\n          headersCount: headers.length,\n          redirectsCount: redirects.length - 1, // reduce one for trailing slash\n          headersWithHasCount: headers.filter((r: any) => !!r.has).length,\n          rewritesWithHasCount: combinedRewrites.filter((r: any) => !!r.has)\n            .length,\n          redirectsWithHasCount: redirects.filter((r: any) => !!r.has).length,\n          middlewareCount: hasMiddlewareFile ? 1 : 0,\n          totalAppPagesCount,\n          staticAppPagesCount,\n          serverAppPagesCount,\n          edgeRuntimeAppCount,\n          edgeRuntimePagesCount,\n        })\n      )\n\n      if (NextBuildContext.telemetryState) {\n        const events = eventBuildFeatureUsage(\n          NextBuildContext.telemetryState.usages\n        )\n        telemetry.record(events)\n        telemetry.record(\n          eventPackageUsedInGetServerSideProps(\n            NextBuildContext.telemetryState.packagesUsedInServerSideProps\n          )\n        )\n      }\n\n      if (ssgPages.size > 0 || appDir) {\n        tbdPrerenderRoutes.forEach((tbdRoute) => {\n          const normalizedRoute = normalizePagePath(tbdRoute)\n          const dataRoute = path.posix.join(\n            '/_next/data',\n            buildId,\n            `${normalizedRoute}.json`\n          )\n\n          finalDynamicRoutes[tbdRoute] = {\n            routeRegex: normalizeRouteRegex(\n              getNamedRouteRegex(tbdRoute, false).re.source\n            ),\n            experimentalPPR: undefined,\n            dataRoute,\n            fallback: ssgBlockingFallbackPages.has(tbdRoute)\n              ? null\n              : ssgStaticFallbackPages.has(tbdRoute)\n                ? `${normalizedRoute}.html`\n                : false,\n            dataRouteRegex: normalizeRouteRegex(\n              getNamedRouteRegex(\n                dataRoute.replace(/\\.json$/, ''),\n                false\n              ).re.source.replace(/\\(\\?:\\\\\\/\\)\\?\\$$/, '\\\\.json$')\n            ),\n            // Pages does not have a prefetch data route.\n            prefetchDataRoute: undefined,\n            prefetchDataRouteRegex: undefined,\n          }\n        })\n\n        NextBuildContext.previewModeId = previewProps.previewModeId\n        NextBuildContext.fetchCacheKeyPrefix =\n          config.experimental.fetchCacheKeyPrefix\n        NextBuildContext.allowedRevalidateHeaderKeys =\n          config.experimental.allowedRevalidateHeaderKeys\n\n        const prerenderManifest: DeepReadonly<PrerenderManifest> = {\n          version: 4,\n          routes: finalPrerenderRoutes,\n          dynamicRoutes: finalDynamicRoutes,\n          notFoundRoutes: ssgNotFoundPaths,\n          preview: previewProps,\n        }\n        await writePrerenderManifest(distDir, prerenderManifest)\n        await writeClientSsgManifest(prerenderManifest, {\n          distDir,\n          buildId,\n          locales: config.i18n?.locales || [],\n        })\n      } else {\n        await writePrerenderManifest(distDir, {\n          version: 4,\n          routes: {},\n          dynamicRoutes: {},\n          preview: previewProps,\n          notFoundRoutes: [],\n        })\n      }\n\n      await writeImagesManifest(distDir, config)\n      await writeManifest(path.join(distDir, EXPORT_MARKER), {\n        version: 1,\n        hasExportPathMap: typeof config.exportPathMap === 'function',\n        exportTrailingSlash: config.trailingSlash === true,\n        isNextImageImported: isNextImageImported === true,\n      })\n      await fs.unlink(path.join(distDir, EXPORT_DETAIL)).catch((err) => {\n        if (err.code === 'ENOENT') {\n          return Promise.resolve()\n        }\n        return Promise.reject(err)\n      })\n\n      if (Boolean(config.experimental.nextScriptWorkers)) {\n        await nextBuildSpan\n          .traceChild('verify-partytown-setup')\n          .traceAsyncFn(async () => {\n            await verifyPartytownSetup(\n              dir,\n              path.join(distDir, CLIENT_STATIC_FILES_PATH)\n            )\n          })\n      }\n\n      await buildTracesPromise\n\n      if (buildTracesSpinner) {\n        buildTracesSpinner.stopAndPersist()\n        buildTracesSpinner = undefined\n      }\n\n      if (config.output === 'export') {\n        await writeFullyStaticExport(\n          config,\n          incrementalCacheIpcPort,\n          incrementalCacheIpcValidationKey,\n          dir,\n          enabledDirectories,\n          configOutDir,\n          nextBuildSpan\n        )\n      }\n\n      if (config.output === 'standalone') {\n        await writeStandaloneDirectory(\n          nextBuildSpan,\n          distDir,\n          pageKeys,\n          denormalizedAppPages,\n          outputFileTracingRoot,\n          requiredServerFilesManifest,\n          middlewareManifest,\n          hasInstrumentationHook,\n          staticPages,\n          loadedEnvFiles,\n          appDir\n        )\n      }\n\n      if (postBuildSpinner) postBuildSpinner.stopAndPersist()\n      console.log()\n\n      if (debugOutput) {\n        nextBuildSpan\n          .traceChild('print-custom-routes')\n          .traceFn(() => printCustomRoutes({ redirects, rewrites, headers }))\n      }\n\n      await nextBuildSpan.traceChild('print-tree-view').traceAsyncFn(() =>\n        printTreeView(pageKeys, pageInfos, {\n          distPath: distDir,\n          buildId: buildId,\n          pagesDir,\n          useStaticPages404,\n          pageExtensions: config.pageExtensions,\n          appBuildManifest,\n          buildManifest,\n          middlewareManifest,\n          gzipSize: config.experimental.gzipSize,\n        })\n      )\n\n      await nextBuildSpan\n        .traceChild('telemetry-flush')\n        .traceAsyncFn(() => telemetry.flush())\n    })\n  } finally {\n    // Ensure we wait for lockfile patching if present\n    await lockfilePatchPromise.cur\n\n    // Ensure all traces are flushed before finishing the command\n    await flushAllTraces()\n    teardownTraceSubscriber()\n    teardownHeapProfiler()\n\n    if (traceUploadUrl && loadedConfig) {\n      uploadTrace({\n        traceUploadUrl,\n        mode: 'build',\n        projectDir: dir,\n        distDir: loadedConfig.distDir,\n        sync: true,\n      })\n    }\n  }\n}\n"],"names":["loadEnvConfig","bold","yellow","crypto","makeRe","existsSync","promises","fs","os","Worker","defaultConfig","devalue","findUp","nanoid","Sema","path","STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR","PUBLIC_DIR_MIDDLEWARE_CONFLICT","MIDDLEWARE_FILENAME","PAGES_DIR_ALIAS","INSTRUMENTATION_HOOK_FILENAME","RSC_PREFETCH_SUFFIX","RSC_SUFFIX","FileType","fileExists","findPagesDir","loadCustomRoutes","normalizeRouteRegex","nonNullable","recursiveDelete","verifyPartytownSetup","validateTurboNextConfig","BUILD_ID_FILE","BUILD_MANIFEST","CLIENT_STATIC_FILES_PATH","EXPORT_DETAIL","EXPORT_MARKER","AUTOMATIC_FONT_OPTIMIZATION_MANIFEST","IMAGES_MANIFEST","PAGES_MANIFEST","PHASE_PRODUCTION_BUILD","PRERENDER_MANIFEST","REACT_LOADABLE_MANIFEST","ROUTES_MANIFEST","SERVER_DIRECTORY","SERVER_FILES_MANIFEST","STATIC_STATUS_PAGES","MIDDLEWARE_MANIFEST","APP_PATHS_MANIFEST","APP_PATH_ROUTES_MANIFEST","APP_BUILD_MANIFEST","RSC_MODULE_TYPES","NEXT_FONT_MANIFEST","SUBRESOURCE_INTEGRITY_MANIFEST","MIDDLEWARE_BUILD_MANIFEST","MIDDLEWARE_REACT_LOADABLE_MANIFEST","SERVER_REFERENCE_MANIFEST","FUNCTIONS_CONFIG_MANIFEST","UNDERSCORE_NOT_FOUND_ROUTE_ENTRY","UNDERSCORE_NOT_FOUND_ROUTE","getSortedRoutes","isDynamicRoute","loadConfig","normalizePagePath","getPagePath","ciEnvironment","turborepoTraceAccess","TurborepoAccessTraceResult","writeTurborepoAccessTraceResult","eventBuildOptimize","eventCliSession","eventBuildFeatureUsage","eventNextPlugins","EVENT_BUILD_FEATURE_USAGE","eventPackageUsedInGetServerSideProps","eventBuildCompleted","Telemetry","isDynamicMetadataRoute","getPageStaticInfo","createPagesMapping","getPageFilePath","sortByPageExts","PAGE_TYPES","generateBuildId","isWriteable","Log","createSpinner","trace","flushAllTraces","setGlobal","detectConflictingPaths","computeFromManifest","getJsPageSizeInKb","printCustomRoutes","printTreeView","copyTracedFiles","isReservedPage","isAppBuiltinNotFoundPage","collectRoutesUsingEdgeRuntime","writeBuildId","normalizeLocalePath","isError","isEdgeRuntime","recursiveCopy","recursiveReadDir","loadBindings","lockfilePatchPromise","teardownTraceSubscriber","teardownHeapProfiler","createDefineEnv","getNamedRouteRegex","getFilesInDir","eventSwcPlugins","normalizeAppPath","ACTION","NEXT_ROUTER_PREFETCH_HEADER","RSC_HEADER","RSC_CONTENT_TYPE_HEADER","NEXT_ROUTER_STATE_TREE","NEXT_DID_POSTPONE_HEADER","webpackBuild","NextBuildContext","normalizePathSep","isAppRouteRoute","createClientRouterFilter","createValidFileMatcher","startTypeChecking","generateInterceptionRoutesRewrites","buildDataRoute","initialize","initializeIncrementalCache","nodeFs","collectBuildTraces","formatManifest","getStartServerInfo","logStartInfo","hasCustomExportOutput","interopDefault","formatDynamicImportPath","isInterceptionRouteAppPath","getTurbopackJsConfig","handleEntrypoints","handleRouteType","handlePagesErrorRoute","formatIssue","isRelevantWarning","TurbopackManifestLoader","buildCustomRoute","createProgress","traceMemoryUsage","generateEncryptionKeyBase64","uploadTrace","checkIsAppPPREnabled","checkIsRoutePPREnabled","pageToRoute","page","routeRegex","regex","re","source","routeKeys","namedRegex","getCacheDir","distDir","cacheDir","join","isCI","hasNextSupport","hasCache","console","log","prefixes","warn","writeFileUtf8","filePath","content","writeFile","readFileUtf8","readFile","writeManifest","manifest","readManifest","JSON","parse","writePrerenderManifest","writeEdgePartialPrerenderManifest","edgePartialPrerenderManifest","routes","dynamicRoutes","notFoundRoutes","version","preview","previewModeId","previewModeSigningKey","previewModeEncryptionKey","replace","stringify","writeClientSsgManifest","prerenderManifest","buildId","locales","ssgPages","Set","Object","entries","filter","srcRoute","map","route","pathname","keys","sort","clientSsgManifestContent","writeFunctionsConfigManifest","writeRequiredServerFilesManifest","requiredServerFiles","writeImagesManifest","config","images","deviceSizes","imageSizes","sizes","remotePatterns","p","protocol","hostname","port","dot","STANDALONE_DIRECTORY","writeStandaloneDirectory","nextBuildSpan","pageKeys","denormalizedAppPages","outputFileTracingRoot","middlewareManifest","hasInstrumentationHook","staticPages","loadedEnvFiles","appDir","traceChild","traceAsyncFn","pages","file","files","reduce","acc","envFile","includes","push","outputPath","relative","mkdir","dirname","recursive","copyFile","overwrite","originalServerApp","getNumberOfWorkers","experimental","cpus","memoryBasedWorkersCount","Math","max","min","floor","freemem","staticWorkerPath","require","resolve","staticWorkerExposedMethods","createStaticWorker","incrementalCacheIpcPort","incrementalCacheIpcValidationKey","infoPrinted","timeout","staticPageGenerationTimeout","logger","onRestart","method","args","attempts","arg","pagePath","Error","numWorkers","forkOptions","env","process","__NEXT_INCREMENTAL_CACHE_IPC_PORT","undefined","__NEXT_INCREMENTAL_CACHE_IPC_KEY","enableWorkerThreads","workerThreads","exposedMethods","writeFullyStaticExport","dir","enabledDirectories","configOutDir","exportApp","default","pagesWorker","appWorker","buildExport","nextConfig","silent","threads","outdir","exportAppPageWorker","exportPage","exportPageWorker","endWorker","end","close","getBuildId","isGenerateMode","IS_TURBOPACK_BUILD","TURBOPACK","TURBOPACK_BUILD","build","reactProductionProfiling","debugOutput","runLint","noMangling","appDirOnly","turboNextBuild","experimentalBuildMode","traceUploadUrl","isCompileMode","loadedConfig","buildMode","isTurboBuild","String","__NEXT_VERSION","mappedPages","traceFn","turborepoAccessTraceResult","NEXT_DEPLOYMENT_ID","deploymentId","customRoutes","headers","rewrites","redirects","combinedRewrites","beforeFiles","afterFiles","fallback","hasRewrites","length","originalRewrites","_originalRewrites","originalRedirects","_originalRedirects","telemetry","publicDir","pagesDir","app","encryptionKey","isSrcDir","startsWith","hasPublicDir","record","webpackVersion","cliCommand","hasNowJson","cwd","isCustomServer","turboFlag","then","events","envInfo","expFeatureInfo","networkUrl","appUrl","ignoreESLint","Boolean","eslint","ignoreDuringBuilds","shouldLint","typeCheckingOptions","error","flush","exit","buildLintEvent","featureName","invocationCount","eventName","payload","validFileMatcher","pageExtensions","pagesPaths","pathnameFilter","isPageFile","middlewareDetectionRegExp","RegExp","instrumentationHookDetectionRegExp","rootDir","instrumentationHookEnabled","instrumentationHook","rootPaths","some","include","test","hasMiddlewareFile","previewProps","randomBytes","toString","isDev","pagesType","PAGES","pagePaths","mappedAppPages","appPaths","absolutePath","isAppRouterPage","isRootNotFound","ignorePartFilter","part","APP","pageKey","pageFilePath","absolutePagePath","isDynamic","mappedRootPaths","ROOT","pagesPageKeys","conflictingAppPagePaths","appPageKeys","appKey","normalizedAppPageKey","appPath","add","Array","from","basePath","totalAppPagesCount","numConflictingAppPaths","conflictingPublicFiles","hasPages404","hasApp404","hasCustomErrorPage","hasPublicUnderScoreNextDir","hasPublicPageFile","File","numConflicting","nestedReservedPages","match","restrictedRedirectPaths","routesManifestPath","routesManifest","sortedRoutes","staticRoutes","pages404","caseSensitive","caseSensitiveRoutes","r","dataRoutes","i18n","rsc","header","varyHeader","prefetchHeader","didPostponeHeader","contentTypeHeader","suffix","prefetchSuffix","skipMiddlewareUrlNormalize","clientRouterFilter","nonInternalRedirects","internal","clientRouterFilters","clientRouterFilterRedirects","clientRouterFilterAllowedRate","distDirCreated","err","code","cleanDistDir","pagesManifestPath","cacheHandler","requiredServerFilesManifest","serverFilesManifest","configFile","compress","trustHostHeader","isExperimentalCompile","relativeAppDir","sri","optimizeFonts","ignore","turbopackBuild","startTime","hrtime","bindings","useWasmBinary","dev","project","turbo","createProject","projectPath","rootPath","jsConfig","watch","defineEnv","isTurbopack","fetchCacheKeyPrefix","middlewareMatchers","type","entrypointsSubscription","entrypointsSubscribe","currentEntrypoints","global","document","middleware","instrumentation","Map","currentEntryIssues","manifestLoader","emptyRewritesObjToBeImplemented","entrypointsResult","next","done","return","catch","entrypoints","value","topLevelErrors","issue","issues","message","e","logErrors","progress","size","sema","enqueue","fn","acquire","release","Promise","all","writeManifests","pageEntrypoints","errors","warnings","entryIssues","values","severity","duration","buildTraceContext","buildTracesPromise","useBuildWorker","webpackBuildWorker","webpack","runServerAndEdgeInParallel","parallelServerCompiles","collectServerBuildTracesInParallel","parallelServerBuildTraces","setAttribute","info","durationInSeconds","serverBuildPromise","res","buildTraceWorker","edgeRuntimeRoutes","hasSsrAmpPages","isFlyingShuttle","flyingShuttle","edgeBuildPromise","event","compilerDuration","rest","postCompileSpinner","buildManifestPath","appBuildManifestPath","staticAppPagesCount","serverAppPagesCount","edgeRuntimeAppCount","edgeRuntimePagesCount","ssgStaticFallbackPages","ssgBlockingFallbackPages","invalidPages","hybridAmpPages","serverPropsPages","additionalSsgPaths","additionalSsgPathsEncoded","appStaticPaths","appStaticPathsEncoded","appNormalizedPaths","appDynamicParamPaths","appDefaultConfigs","pageInfos","pagesManifest","buildManifest","appBuildManifest","isAppPPREnabled","ppr","appPathRoutes","appPathsManifest","key","NEXT_PHASE","staticWorkerRequestDeduping","CacheHandler","mod","cacheInitialization","fetchCache","flushToDisk","isrFlushToDisk","serverDistDir","maxMemoryCacheSize","cacheMaxMemorySize","getPrerenderManifest","requestHeaders","CurCacheHandler","minimalMode","allowedRevalidateHeaderKeys","ipcPort","ipcValidationKey","pagesStaticWorkers","appStaticWorkers","analysisBegin","staticCheckSpan","functionsConfigManifest","functions","customAppGetInitialProps","namedExports","isNextImageImported","hasNonStaticErrorPage","configFileName","publicRuntimeConfig","serverRuntimeConfig","runtimeEnvConfig","nonStaticErrorPageSpan","errorPageHasCustomGetInitialProps","hasCustomGetInitialProps","checkingApp","errorPageStaticResult","isPageStatic","httpAgentOptions","defaultLocale","nextConfigOutput","output","pprConfig","appPageToCheck","customAppGetInitialPropsPromise","namedExportsPromise","getDefinedNamedExports","computedManifestData","gzipSize","actionManifest","entriesWithAction","id","node","entry","workers","edge","pageType","checkPageSpan","actualPage","totalSize","isRoutePPREnabled","isSSG","isStatic","isServerComponent","isHybridAmp","ssgPageRoutes","find","originalAppPath","originalPath","normalizedPath","staticInfo","extraConfig","pageRuntime","runtime","client","edgeInfo","manifestKey","isPageStaticSpan","workerResult","parentId","getId","set","warnOnce","encodedPrerenderRoutes","prerenderRoutes","appConfig","isInterceptionRoute","revalidate","hasGenerateStaticParams","dynamic","prerenderFallback","hasStaticProps","isAmpOnly","hasServerProps","delete","initialRevalidateSeconds","pageDuration","ssgPageDurations","hasEmptyPrelude","errorPageResult","nonStaticErrorPage","returnValue","stopAndPersist","useStaticPages404","pg","optimizeCss","globOrig","cssFilePaths","reject","features","nextScriptWorkers","feature","finalPrerenderRoutes","finalDynamicRoutes","tbdPrerenderRoutes","ssgNotFoundPaths","usedStaticStatusPages","forEach","has","hasPages500","useDefaultStatic500","combinedPages","isApp404Static","hasStaticApp404","staticGenerationSpan","exportConfig","exportPathMap","defaultMap","query","__nextFallback","encodedRoutes","get","routeIdx","__nextSsgPath","_isDynamicError","_isAppDir","_isRoutePPREnabled","isSsg","isFallback","locale","__nextLocale","exportOptions","statusMessage","exportResult","traces","turborepoAccessTraceResults","serverBundle","unlink","hasDynamicData","byPath","isRouteHandler","experimentalPPR","bypassFor","metadata","hasPostponed","normalizedRoute","dataRoute","posix","prefetchDataRoute","routeMeta","status","initialStatus","exportHeaders","headerKeys","initialHeaders","isArray","experimentalBypassFor","isDynamicAppRoute","dataRouteRegex","prefetchDataRouteRegex","moveExportedPage","originPage","ext","additionalSsgFile","orig","relativeDest","slice","split","dest","isNotFound","rename","localeExt","extname","relativeDestNoPages","curPath","updatedRelativeDest","updatedOrig","updatedDest","moveExportedAppNotFoundTo404","isStaticSsgFallback","hasAmp","pageInfo","durationInfo","byPage","durationsByPath","hasHtmlOutput","ampPage","localePage","extraRoutes","pageFile","rm","force","postBuildSpinner","buildTracesSpinner","analysisEnd","staticPageCount","staticPropsPageCount","serverPropsPageCount","ssrPageCount","hasStatic404","hasReportWebVitals","rewritesCount","headersCount","redirectsCount","headersWithHasCount","rewritesWithHasCount","redirectsWithHasCount","middlewareCount","telemetryState","usages","packagesUsedInServerSideProps","tbdRoute","hasExportPathMap","exportTrailingSlash","trailingSlash","distPath","cur","mode","projectDir","sync"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}