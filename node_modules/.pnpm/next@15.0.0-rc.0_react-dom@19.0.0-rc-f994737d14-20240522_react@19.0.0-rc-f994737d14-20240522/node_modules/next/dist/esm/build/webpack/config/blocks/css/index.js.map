{"version":3,"sources":["../../../../../../src/build/webpack/config/blocks/css/index.ts"],"sourcesContent":["import curry from 'next/dist/compiled/lodash.curry'\nimport type { webpack } from 'next/dist/compiled/webpack/webpack'\nimport { loader, plugin } from '../../helpers'\nimport { pipe } from '../../utils'\nimport type { ConfigurationContext, ConfigurationFn } from '../../utils'\nimport { getCssModuleLoader, getGlobalCssLoader } from './loaders'\nimport { getNextFontLoader } from './loaders/next-font'\nimport {\n  getCustomDocumentError,\n  getGlobalImportError,\n  getGlobalModuleImportError,\n  getLocalModuleImportError,\n} from './messages'\nimport { getPostCssPlugins } from './plugins'\nimport { nonNullable } from '../../../../../lib/non-nullable'\nimport { WEBPACK_LAYERS } from '../../../../../lib/constants'\n\n// RegExps for all Style Sheet variants\nexport const regexLikeCss = /\\.(css|scss|sass)$/\n\n// RegExps for Style Sheets\nconst regexCssGlobal = /(?<!\\.module)\\.css$/\nconst regexCssModules = /\\.module\\.css$/\n\n// RegExps for Syntactically Awesome Style Sheets\nconst regexSassGlobal = /(?<!\\.module)\\.(scss|sass)$/\nconst regexSassModules = /\\.module\\.(scss|sass)$/\n\nconst APP_LAYER_RULE = {\n  or: [\n    WEBPACK_LAYERS.reactServerComponents,\n    WEBPACK_LAYERS.serverSideRendering,\n    WEBPACK_LAYERS.appPagesBrowser,\n  ],\n}\n\nconst PAGES_LAYER_RULE = {\n  not: [\n    WEBPACK_LAYERS.reactServerComponents,\n    WEBPACK_LAYERS.serverSideRendering,\n    WEBPACK_LAYERS.appPagesBrowser,\n  ],\n}\n\n/**\n * Mark a rule as removable if built-in CSS support is disabled\n */\nfunction markRemovable(r: webpack.RuleSetRule): webpack.RuleSetRule {\n  Object.defineProperty(r, Symbol.for('__next_css_remove'), {\n    enumerable: false,\n    value: true,\n  })\n  return r\n}\n\nlet postcssInstancePromise: Promise<any>\nexport async function lazyPostCSS(\n  rootDirectory: string,\n  supportedBrowsers: string[] | undefined,\n  disablePostcssPresetEnv: boolean | undefined,\n  useLightningcss: boolean | undefined\n) {\n  if (!postcssInstancePromise) {\n    postcssInstancePromise = (async () => {\n      const postcss = require('postcss')\n      // @ts-ignore backwards compat\n      postcss.plugin = function postcssPlugin(name, initializer) {\n        function creator(...args: any) {\n          let transformer = initializer(...args)\n          transformer.postcssPlugin = name\n          // transformer.postcssVersion = new Processor().version\n          return transformer\n        }\n\n        let cache: any\n        Object.defineProperty(creator, 'postcss', {\n          get() {\n            if (!cache) cache = creator()\n            return cache\n          },\n        })\n\n        creator.process = function (\n          css: any,\n          processOpts: any,\n          pluginOpts: any\n        ) {\n          return postcss([creator(pluginOpts)]).process(css, processOpts)\n        }\n\n        return creator\n      }\n\n      // @ts-ignore backwards compat\n      postcss.vendor = {\n        /**\n         * Returns the vendor prefix extracted from an input string.\n         *\n         * @example\n         * postcss.vendor.prefix('-moz-tab-size') //=> '-moz-'\n         * postcss.vendor.prefix('tab-size')      //=> ''\n         */\n        prefix: function prefix(prop: string): string {\n          const match = prop.match(/^(-\\w+-)/)\n\n          if (match) {\n            return match[0]\n          }\n\n          return ''\n        },\n\n        /**\n         * Returns the input string stripped of its vendor prefix.\n         *\n         * @example\n         * postcss.vendor.unprefixed('-moz-tab-size') //=> 'tab-size'\n         */\n        unprefixed: function unprefixed(\n          /**\n           * String with or without vendor prefix.\n           */\n          prop: string\n        ): string {\n          return prop.replace(/^-\\w+-/, '')\n        },\n      }\n\n      const postCssPlugins = await getPostCssPlugins(\n        rootDirectory,\n        supportedBrowsers,\n        disablePostcssPresetEnv,\n        useLightningcss\n      )\n\n      return {\n        postcss,\n        postcssWithPlugins: postcss(postCssPlugins),\n      }\n    })()\n  }\n\n  return postcssInstancePromise\n}\n\nexport const css = curry(async function css(\n  ctx: ConfigurationContext,\n  config: webpack.Configuration\n) {\n  const {\n    prependData: sassPrependData,\n    additionalData: sassAdditionalData,\n    ...sassOptions\n  } = ctx.sassOptions\n\n  const lazyPostCSSInitializer = () =>\n    lazyPostCSS(\n      ctx.rootDirectory,\n      ctx.supportedBrowsers,\n      ctx.experimental.disablePostcssPresetEnv,\n      ctx.experimental.useLightningcss\n    )\n\n  const sassPreprocessors: webpack.RuleSetUseItem[] = [\n    // First, process files with `sass-loader`: this inlines content, and\n    // compiles away the proprietary syntax.\n    {\n      loader: require.resolve('next/dist/compiled/sass-loader'),\n      options: {\n        // Source maps are required so that `resolve-url-loader` can locate\n        // files original to their source directory.\n        sourceMap: true,\n        sassOptions: {\n          // The \"fibers\" option is not needed for Node.js 16+, but it's causing\n          // problems for Node.js <= 14 users as you'll have to manually install\n          // the `fibers` package:\n          // https://github.com/webpack-contrib/sass-loader#:~:text=We%20automatically%20inject%20the%20fibers%20package\n          // https://github.com/vercel/next.js/issues/45052\n          // Since it's optional and not required, we'll disable it by default\n          // to avoid the confusion.\n          fibers: false,\n          ...sassOptions,\n        },\n        additionalData: sassPrependData || sassAdditionalData,\n      },\n    },\n    // Then, `sass-loader` will have passed-through CSS imports as-is instead\n    // of inlining them. Because they were inlined, the paths are no longer\n    // correct.\n    // To fix this, we use `resolve-url-loader` to rewrite the CSS\n    // imports to real file paths.\n    {\n      loader: require.resolve('../../../loaders/resolve-url-loader/index'),\n      options: {\n        postcss: lazyPostCSSInitializer,\n        // Source maps are not required here, but we may as well emit\n        // them.\n        sourceMap: true,\n      },\n    },\n  ]\n\n  const fns: ConfigurationFn[] = []\n\n  const googleLoader = require.resolve(\n    'next/dist/compiled/@next/font/google/loader'\n  )\n  const localLoader = require.resolve(\n    'next/dist/compiled/@next/font/local/loader'\n  )\n  const nextFontLoaders: Array<[string | RegExp, string, any?]> = [\n    [require.resolve('next/font/google/target.css'), googleLoader],\n    [require.resolve('next/font/local/target.css'), localLoader],\n  ]\n\n  nextFontLoaders.forEach(([fontLoaderTarget, fontLoaderPath]) => {\n    // Matches the resolved font loaders noop files to run next-font-loader\n    fns.push(\n      loader({\n        oneOf: [\n          markRemovable({\n            sideEffects: false,\n            test: fontLoaderTarget,\n            use: getNextFontLoader(ctx, lazyPostCSSInitializer, fontLoaderPath),\n          }),\n        ],\n      })\n    )\n  })\n\n  // CSS cannot be imported in _document. This comes before everything because\n  // global CSS nor CSS modules work in said file.\n  fns.push(\n    loader({\n      oneOf: [\n        markRemovable({\n          test: regexLikeCss,\n          // Use a loose regex so we don't have to crawl the file system to\n          // find the real file name (if present).\n          issuer: /pages[\\\\/]_document\\./,\n          use: {\n            loader: 'error-loader',\n            options: {\n              reason: getCustomDocumentError(),\n            },\n          },\n        }),\n      ],\n    })\n  )\n\n  const shouldIncludeExternalCSSImports =\n    !!ctx.experimental.craCompat || !!ctx.transpilePackages\n\n  // CSS modules & SASS modules support. They are allowed to be imported in anywhere.\n  fns.push(\n    // CSS Modules should never have side effects. This setting will\n    // allow unused CSS to be removed from the production build.\n    // We ensure this by disallowing `:global()` CSS at the top-level\n    // via the `pure` mode in `css-loader`.\n    loader({\n      oneOf: [\n        // For app dir, we need to match the specific app layer.\n        ctx.hasAppDir\n          ? markRemovable({\n              sideEffects: true,\n              test: regexCssModules,\n              issuerLayer: APP_LAYER_RULE,\n              use: [\n                {\n                  loader: require.resolve(\n                    '../../../loaders/next-flight-css-loader'\n                  ),\n                  options: {\n                    cssModules: true,\n                  },\n                },\n                ...getCssModuleLoader(\n                  { ...ctx, isAppDir: true },\n                  lazyPostCSSInitializer\n                ),\n              ],\n            })\n          : null,\n        markRemovable({\n          sideEffects: true,\n          test: regexCssModules,\n          issuerLayer: PAGES_LAYER_RULE,\n          use: getCssModuleLoader(\n            { ...ctx, isAppDir: false },\n            lazyPostCSSInitializer\n          ),\n        }),\n      ].filter(nonNullable),\n    }),\n    // Opt-in support for Sass (using .scss or .sass extensions).\n    // Sass Modules should never have side effects. This setting will\n    // allow unused Sass to be removed from the production build.\n    // We ensure this by disallowing `:global()` Sass at the top-level\n    // via the `pure` mode in `css-loader`.\n    loader({\n      oneOf: [\n        // For app dir, we need to match the specific app layer.\n        ctx.hasAppDir\n          ? markRemovable({\n              sideEffects: true,\n              test: regexSassModules,\n              issuerLayer: APP_LAYER_RULE,\n              use: [\n                {\n                  loader: require.resolve(\n                    '../../../loaders/next-flight-css-loader'\n                  ),\n                  options: {\n                    cssModules: true,\n                  },\n                },\n                ...getCssModuleLoader(\n                  { ...ctx, isAppDir: true },\n                  lazyPostCSSInitializer,\n                  sassPreprocessors\n                ),\n              ],\n            })\n          : null,\n        markRemovable({\n          sideEffects: true,\n          test: regexSassModules,\n          issuerLayer: PAGES_LAYER_RULE,\n          use: getCssModuleLoader(\n            { ...ctx, isAppDir: false },\n            lazyPostCSSInitializer,\n            sassPreprocessors\n          ),\n        }),\n      ].filter(nonNullable),\n    }),\n    // Throw an error for CSS Modules used outside their supported scope\n    loader({\n      oneOf: [\n        markRemovable({\n          test: [regexCssModules, regexSassModules],\n          use: {\n            loader: 'error-loader',\n            options: {\n              reason: getLocalModuleImportError(),\n            },\n          },\n        }),\n      ],\n    })\n  )\n\n  // Global CSS and SASS support.\n  if (ctx.isServer) {\n    fns.push(\n      loader({\n        oneOf: [\n          ctx.hasAppDir && !ctx.isProduction\n            ? markRemovable({\n                sideEffects: true,\n                test: [regexCssGlobal, regexSassGlobal],\n                issuerLayer: APP_LAYER_RULE,\n                use: {\n                  loader: require.resolve(\n                    '../../../loaders/next-flight-css-loader'\n                  ),\n                  options: {\n                    cssModules: false,\n                  },\n                },\n              })\n            : null,\n          markRemovable({\n            // CSS imports have side effects, even on the server side.\n            sideEffects: true,\n            test: [regexCssGlobal, regexSassGlobal],\n            use: require.resolve('next/dist/compiled/ignore-loader'),\n          }),\n        ].filter(nonNullable),\n      })\n    )\n  } else {\n    // External CSS files are allowed to be loaded when any of the following is true:\n    // - hasAppDir: all CSS files are allowed\n    // - If the CSS file is located in `node_modules`\n    // - If the CSS file is located in another package in a monorepo (outside of the current rootDir)\n    // - If the issuer is pages/_app (matched later)\n    const allowedPagesGlobalCSSPath = ctx.hasAppDir\n      ? undefined\n      : {\n          and: [\n            {\n              or: [\n                /node_modules/,\n                {\n                  not: [ctx.rootDirectory],\n                },\n              ],\n            },\n          ],\n        }\n    const allowedPagesGlobalCSSIssuer = ctx.hasAppDir\n      ? undefined\n      : shouldIncludeExternalCSSImports\n        ? undefined\n        : {\n            and: [ctx.rootDirectory],\n            not: [/node_modules/],\n          }\n\n    fns.push(\n      loader({\n        oneOf: [\n          ...(ctx.hasAppDir\n            ? [\n                markRemovable({\n                  sideEffects: true,\n                  test: regexCssGlobal,\n                  issuerLayer: APP_LAYER_RULE,\n                  use: [\n                    {\n                      loader: require.resolve(\n                        '../../../loaders/next-flight-css-loader'\n                      ),\n                      options: {\n                        cssModules: false,\n                      },\n                    },\n                    ...getGlobalCssLoader(\n                      { ...ctx, isAppDir: true },\n                      lazyPostCSSInitializer\n                    ),\n                  ],\n                }),\n                markRemovable({\n                  sideEffects: true,\n                  test: regexSassGlobal,\n                  issuerLayer: APP_LAYER_RULE,\n                  use: [\n                    {\n                      loader: require.resolve(\n                        '../../../loaders/next-flight-css-loader'\n                      ),\n                      options: {\n                        cssModules: false,\n                      },\n                    },\n                    ...getGlobalCssLoader(\n                      { ...ctx, isAppDir: true },\n                      lazyPostCSSInitializer,\n                      sassPreprocessors\n                    ),\n                  ],\n                }),\n              ]\n            : []),\n          markRemovable({\n            sideEffects: true,\n            test: regexCssGlobal,\n            include: allowedPagesGlobalCSSPath,\n            issuer: allowedPagesGlobalCSSIssuer,\n            issuerLayer: PAGES_LAYER_RULE,\n            use: getGlobalCssLoader(\n              { ...ctx, isAppDir: false },\n              lazyPostCSSInitializer\n            ),\n          }),\n          markRemovable({\n            sideEffects: true,\n            test: regexSassGlobal,\n            include: allowedPagesGlobalCSSPath,\n            issuer: allowedPagesGlobalCSSIssuer,\n            issuerLayer: PAGES_LAYER_RULE,\n            use: getGlobalCssLoader(\n              { ...ctx, isAppDir: false },\n              lazyPostCSSInitializer,\n              sassPreprocessors\n            ),\n          }),\n        ].filter(nonNullable),\n      })\n    )\n\n    if (ctx.customAppFile) {\n      fns.push(\n        loader({\n          oneOf: [\n            markRemovable({\n              sideEffects: true,\n              test: regexCssGlobal,\n              issuer: { and: [ctx.customAppFile] },\n              use: getGlobalCssLoader(\n                { ...ctx, isAppDir: false },\n                lazyPostCSSInitializer\n              ),\n            }),\n          ],\n        }),\n        loader({\n          oneOf: [\n            markRemovable({\n              sideEffects: true,\n              test: regexSassGlobal,\n              issuer: { and: [ctx.customAppFile] },\n              use: getGlobalCssLoader(\n                { ...ctx, isAppDir: false },\n                lazyPostCSSInitializer,\n                sassPreprocessors\n              ),\n            }),\n          ],\n        })\n      )\n    }\n  }\n\n  // Throw an error for Global CSS used inside of `node_modules`\n  if (!shouldIncludeExternalCSSImports) {\n    fns.push(\n      loader({\n        oneOf: [\n          markRemovable({\n            test: [regexCssGlobal, regexSassGlobal],\n            issuer: { and: [/node_modules/] },\n            use: {\n              loader: 'error-loader',\n              options: {\n                reason: getGlobalModuleImportError(),\n              },\n            },\n          }),\n        ],\n      })\n    )\n  }\n\n  // Throw an error for Global CSS used outside of our custom <App> file\n  fns.push(\n    loader({\n      oneOf: [\n        markRemovable({\n          test: [regexCssGlobal, regexSassGlobal],\n          issuer: ctx.hasAppDir\n            ? {\n                // If it's inside the app dir, but not importing from a layout file,\n                // throw an error.\n                and: [ctx.rootDirectory],\n                not: [/layout\\.(js|mjs|jsx|ts|tsx)$/],\n              }\n            : undefined,\n          use: {\n            loader: 'error-loader',\n            options: {\n              reason: getGlobalImportError(),\n            },\n          },\n        }),\n      ],\n    })\n  )\n\n  if (ctx.isClient) {\n    // Automatically transform references to files (i.e. url()) into URLs\n    // e.g. url(./logo.svg)\n    fns.push(\n      loader({\n        oneOf: [\n          markRemovable({\n            // This should only be applied to CSS files\n            issuer: regexLikeCss,\n            // Exclude extensions that webpack handles by default\n            exclude: [\n              /\\.(js|mjs|jsx|ts|tsx)$/,\n              /\\.html$/,\n              /\\.json$/,\n              /\\.webpack\\[[^\\]]+\\]$/,\n            ],\n            // `asset/resource` always emits a URL reference, where `asset`\n            // might inline the asset as a data URI\n            type: 'asset/resource',\n          }),\n        ],\n      })\n    )\n  }\n\n  // Enable full mini-css-extract-plugin hmr for prod mode pages or app dir\n  if (ctx.isClient && (ctx.isProduction || ctx.hasAppDir)) {\n    // Extract CSS as CSS file(s) in the client-side production bundle.\n    const MiniCssExtractPlugin =\n      require('../../../plugins/mini-css-extract-plugin').default\n    fns.push(\n      plugin(\n        // @ts-ignore webpack 5 compat\n        new MiniCssExtractPlugin({\n          filename: ctx.isProduction\n            ? 'static/css/[contenthash].css'\n            : 'static/css/[name].css',\n          chunkFilename: ctx.isProduction\n            ? 'static/css/[contenthash].css'\n            : 'static/css/[name].css',\n          // Next.js guarantees that CSS order \"doesn't matter\", due to imposed\n          // restrictions:\n          // 1. Global CSS can only be defined in a single entrypoint (_app)\n          // 2. CSS Modules generate scoped class names by default and cannot\n          //    include Global CSS (:global() selector).\n          //\n          // While not a perfect guarantee (e.g. liberal use of `:global()`\n          // selector), this assumption is required to code-split CSS.\n          //\n          // If this warning were to trigger, it'd be unactionable by the user,\n          // but likely not valid -- so we disable it.\n          ignoreOrder: true,\n        })\n      )\n    )\n  }\n\n  const fn = pipe(...fns)\n  return fn(config)\n})\n"],"names":["curry","loader","plugin","pipe","getCssModuleLoader","getGlobalCssLoader","getNextFontLoader","getCustomDocumentError","getGlobalImportError","getGlobalModuleImportError","getLocalModuleImportError","getPostCssPlugins","nonNullable","WEBPACK_LAYERS","regexLikeCss","regexCssGlobal","regexCssModules","regexSassGlobal","regexSassModules","APP_LAYER_RULE","or","reactServerComponents","serverSideRendering","appPagesBrowser","PAGES_LAYER_RULE","not","markRemovable","r","Object","defineProperty","Symbol","for","enumerable","value","postcssInstancePromise","lazyPostCSS","rootDirectory","supportedBrowsers","disablePostcssPresetEnv","useLightningcss","postcss","require","postcssPlugin","name","initializer","creator","args","transformer","cache","get","process","css","processOpts","pluginOpts","vendor","prefix","prop","match","unprefixed","replace","postCssPlugins","postcssWithPlugins","ctx","config","prependData","sassPrependData","additionalData","sassAdditionalData","sassOptions","lazyPostCSSInitializer","experimental","sassPreprocessors","resolve","options","sourceMap","fibers","fns","googleLoader","localLoader","nextFontLoaders","forEach","fontLoaderTarget","fontLoaderPath","push","oneOf","sideEffects","test","use","issuer","reason","shouldIncludeExternalCSSImports","craCompat","transpilePackages","hasAppDir","issuerLayer","cssModules","isAppDir","filter","isServer","isProduction","allowedPagesGlobalCSSPath","undefined","and","allowedPagesGlobalCSSIssuer","include","customAppFile","isClient","exclude","type","MiniCssExtractPlugin","default","filename","chunkFilename","ignoreOrder","fn"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}