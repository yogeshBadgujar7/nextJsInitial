{"version":3,"sources":["../../../src/server/app-render/required-scripts.tsx"],"sourcesContent":["import { encodeURIPath } from '../../shared/lib/encode-uri-path'\nimport type { BuildManifest } from '../get-page-files'\n\nimport ReactDOM from 'react-dom'\n\nexport function getRequiredScripts(\n  buildManifest: BuildManifest,\n  assetPrefix: string,\n  crossOrigin: undefined | '' | 'anonymous' | 'use-credentials',\n  SRIManifest: undefined | Record<string, string>,\n  qs: string,\n  nonce: string | undefined\n): [\n  () => void,\n  { src: string; integrity?: string; crossOrigin?: string | undefined },\n] {\n  let preinitScripts: () => void\n  let preinitScriptCommands: string[] = []\n  const bootstrapScript: {\n    src: string\n    integrity?: string\n    crossOrigin?: string | undefined\n  } = {\n    src: '',\n    crossOrigin,\n  }\n\n  const files = buildManifest.rootMainFiles.map(encodeURIPath)\n  if (files.length === 0) {\n    throw new Error(\n      'Invariant: missing bootstrap script. This is a bug in Next.js'\n    )\n  }\n  if (SRIManifest) {\n    bootstrapScript.src = `${assetPrefix}/_next/` + files[0] + qs\n    bootstrapScript.integrity = SRIManifest[files[0]]\n\n    for (let i = 1; i < files.length; i++) {\n      const src = `${assetPrefix}/_next/` + files[i] + qs\n      const integrity = SRIManifest[files[i]]\n      preinitScriptCommands.push(src, integrity)\n    }\n    preinitScripts = () => {\n      // preinitScriptCommands is a double indexed array of src/integrity pairs\n      for (let i = 0; i < preinitScriptCommands.length; i += 2) {\n        ReactDOM.preinit(preinitScriptCommands[i], {\n          as: 'script',\n          integrity: preinitScriptCommands[i + 1],\n          crossOrigin,\n          nonce,\n        })\n      }\n    }\n  } else {\n    bootstrapScript.src = `${assetPrefix}/_next/` + files[0] + qs\n\n    for (let i = 1; i < files.length; i++) {\n      const src = `${assetPrefix}/_next/` + files[i] + qs\n      preinitScriptCommands.push(src)\n    }\n    preinitScripts = () => {\n      // preinitScriptCommands is a singled indexed array of src values\n      for (let i = 0; i < preinitScriptCommands.length; i++) {\n        ReactDOM.preinit(preinitScriptCommands[i], {\n          as: 'script',\n          nonce,\n          crossOrigin,\n        })\n      }\n    }\n  }\n\n  return [preinitScripts, bootstrapScript]\n}\n"],"names":["getRequiredScripts","buildManifest","assetPrefix","crossOrigin","SRIManifest","qs","nonce","preinitScripts","preinitScriptCommands","bootstrapScript","src","files","rootMainFiles","map","encodeURIPath","length","Error","integrity","i","push","ReactDOM","preinit","as"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAKgBA;;;eAAAA;;;+BALc;iEAGT;;;;;;AAEd,SAASA,mBACdC,aAA4B,EAC5BC,WAAmB,EACnBC,WAA6D,EAC7DC,WAA+C,EAC/CC,EAAU,EACVC,KAAyB;IAKzB,IAAIC;IACJ,IAAIC,wBAAkC,EAAE;IACxC,MAAMC,kBAIF;QACFC,KAAK;QACLP;IACF;IAEA,MAAMQ,QAAQV,cAAcW,aAAa,CAACC,GAAG,CAACC,4BAAa;IAC3D,IAAIH,MAAMI,MAAM,KAAK,GAAG;QACtB,MAAM,IAAIC,MACR;IAEJ;IACA,IAAIZ,aAAa;QACfK,gBAAgBC,GAAG,GAAG,CAAC,EAAER,YAAY,OAAO,CAAC,GAAGS,KAAK,CAAC,EAAE,GAAGN;QAC3DI,gBAAgBQ,SAAS,GAAGb,WAAW,CAACO,KAAK,CAAC,EAAE,CAAC;QAEjD,IAAK,IAAIO,IAAI,GAAGA,IAAIP,MAAMI,MAAM,EAAEG,IAAK;YACrC,MAAMR,MAAM,CAAC,EAAER,YAAY,OAAO,CAAC,GAAGS,KAAK,CAACO,EAAE,GAAGb;YACjD,MAAMY,YAAYb,WAAW,CAACO,KAAK,CAACO,EAAE,CAAC;YACvCV,sBAAsBW,IAAI,CAACT,KAAKO;QAClC;QACAV,iBAAiB;YACf,yEAAyE;YACzE,IAAK,IAAIW,IAAI,GAAGA,IAAIV,sBAAsBO,MAAM,EAAEG,KAAK,EAAG;gBACxDE,iBAAQ,CAACC,OAAO,CAACb,qBAAqB,CAACU,EAAE,EAAE;oBACzCI,IAAI;oBACJL,WAAWT,qBAAqB,CAACU,IAAI,EAAE;oBACvCf;oBACAG;gBACF;YACF;QACF;IACF,OAAO;QACLG,gBAAgBC,GAAG,GAAG,CAAC,EAAER,YAAY,OAAO,CAAC,GAAGS,KAAK,CAAC,EAAE,GAAGN;QAE3D,IAAK,IAAIa,IAAI,GAAGA,IAAIP,MAAMI,MAAM,EAAEG,IAAK;YACrC,MAAMR,MAAM,CAAC,EAAER,YAAY,OAAO,CAAC,GAAGS,KAAK,CAACO,EAAE,GAAGb;YACjDG,sBAAsBW,IAAI,CAACT;QAC7B;QACAH,iBAAiB;YACf,iEAAiE;YACjE,IAAK,IAAIW,IAAI,GAAGA,IAAIV,sBAAsBO,MAAM,EAAEG,IAAK;gBACrDE,iBAAQ,CAACC,OAAO,CAACb,qBAAqB,CAACU,EAAE,EAAE;oBACzCI,IAAI;oBACJhB;oBACAH;gBACF;YACF;QACF;IACF;IAEA,OAAO;QAACI;QAAgBE;KAAgB;AAC1C"}