{"version":3,"sources":["../../../src/server/response-cache/utils.ts"],"sourcesContent":["import type { IncrementalCacheItem, ResponseCacheEntry } from './types'\n\nimport RenderResult from '../render-result'\n\nexport async function fromResponseCacheEntry(\n  cacheEntry: ResponseCacheEntry\n): Promise<IncrementalCacheItem> {\n  return {\n    ...cacheEntry,\n    value:\n      cacheEntry.value?.kind === 'PAGE'\n        ? {\n            kind: 'PAGE',\n            html: await cacheEntry.value.html.toUnchunkedString(true),\n            postponed: cacheEntry.value.postponed,\n            pageData: cacheEntry.value.pageData,\n            headers: cacheEntry.value.headers,\n            status: cacheEntry.value.status,\n          }\n        : cacheEntry.value,\n  }\n}\n\nexport async function toResponseCacheEntry(\n  response: IncrementalCacheItem\n): Promise<ResponseCacheEntry | null> {\n  if (!response) return null\n\n  if (response.value?.kind === 'FETCH') {\n    throw new Error(\n      'Invariant: unexpected cachedResponse of kind fetch in response cache'\n    )\n  }\n\n  return {\n    isMiss: response.isMiss,\n    isStale: response.isStale,\n    revalidate: response.revalidate,\n    value:\n      response.value?.kind === 'PAGE'\n        ? {\n            kind: 'PAGE',\n            html: RenderResult.fromStatic(response.value.html),\n            pageData: response.value.pageData,\n            postponed: response.value.postponed,\n            headers: response.value.headers,\n            status: response.value.status,\n          }\n        : response.value,\n  }\n}\n"],"names":["fromResponseCacheEntry","toResponseCacheEntry","cacheEntry","value","kind","html","toUnchunkedString","postponed","pageData","headers","status","response","Error","isMiss","isStale","revalidate","RenderResult","fromStatic"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;;;;;IAIsBA,sBAAsB;eAAtBA;;IAmBAC,oBAAoB;eAApBA;;;qEArBG;;;;;;AAElB,eAAeD,uBACpBE,UAA8B;QAK1BA;IAHJ,OAAO;QACL,GAAGA,UAAU;QACbC,OACED,EAAAA,oBAAAA,WAAWC,KAAK,qBAAhBD,kBAAkBE,IAAI,MAAK,SACvB;YACEA,MAAM;YACNC,MAAM,MAAMH,WAAWC,KAAK,CAACE,IAAI,CAACC,iBAAiB,CAAC;YACpDC,WAAWL,WAAWC,KAAK,CAACI,SAAS;YACrCC,UAAUN,WAAWC,KAAK,CAACK,QAAQ;YACnCC,SAASP,WAAWC,KAAK,CAACM,OAAO;YACjCC,QAAQR,WAAWC,KAAK,CAACO,MAAM;QACjC,IACAR,WAAWC,KAAK;IACxB;AACF;AAEO,eAAeF,qBACpBU,QAA8B;QAI1BA,iBAWAA;IAbJ,IAAI,CAACA,UAAU,OAAO;IAEtB,IAAIA,EAAAA,kBAAAA,SAASR,KAAK,qBAAdQ,gBAAgBP,IAAI,MAAK,SAAS;QACpC,MAAM,IAAIQ,MACR;IAEJ;IAEA,OAAO;QACLC,QAAQF,SAASE,MAAM;QACvBC,SAASH,SAASG,OAAO;QACzBC,YAAYJ,SAASI,UAAU;QAC/BZ,OACEQ,EAAAA,mBAAAA,SAASR,KAAK,qBAAdQ,iBAAgBP,IAAI,MAAK,SACrB;YACEA,MAAM;YACNC,MAAMW,qBAAY,CAACC,UAAU,CAACN,SAASR,KAAK,CAACE,IAAI;YACjDG,UAAUG,SAASR,KAAK,CAACK,QAAQ;YACjCD,WAAWI,SAASR,KAAK,CAACI,SAAS;YACnCE,SAASE,SAASR,KAAK,CAACM,OAAO;YAC/BC,QAAQC,SAASR,KAAK,CAACO,MAAM;QAC/B,IACAC,SAASR,KAAK;IACtB;AACF"}