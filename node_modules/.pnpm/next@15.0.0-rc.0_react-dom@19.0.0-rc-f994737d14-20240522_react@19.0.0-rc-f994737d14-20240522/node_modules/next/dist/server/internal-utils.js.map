{"version":3,"sources":["../../src/server/internal-utils.ts"],"sourcesContent":["import type { IncomingHttpHeaders } from 'http'\nimport type { NextParsedUrlQuery } from './request-meta'\n\nimport { NEXT_RSC_UNION_QUERY } from '../client/components/app-router-headers'\nimport { INTERNAL_HEADERS } from '../shared/lib/constants'\n\nconst INTERNAL_QUERY_NAMES = [\n  '__nextFallback',\n  '__nextLocale',\n  '__nextInferredLocaleFromDefault',\n  '__nextDefaultLocale',\n  '__nextIsNotFound',\n  NEXT_RSC_UNION_QUERY,\n] as const\n\nconst EDGE_EXTENDED_INTERNAL_QUERY_NAMES = ['__nextDataReq'] as const\n\nexport function stripInternalQueries(query: NextParsedUrlQuery) {\n  for (const name of INTERNAL_QUERY_NAMES) {\n    delete query[name]\n  }\n}\n\nexport function stripInternalSearchParams<T extends string | URL>(\n  url: T,\n  isEdge: boolean\n): T {\n  const isStringUrl = typeof url === 'string'\n  const instance = isStringUrl ? new URL(url) : (url as URL)\n  for (const name of INTERNAL_QUERY_NAMES) {\n    instance.searchParams.delete(name)\n  }\n\n  if (isEdge) {\n    for (const name of EDGE_EXTENDED_INTERNAL_QUERY_NAMES) {\n      instance.searchParams.delete(name)\n    }\n  }\n\n  return (isStringUrl ? instance.toString() : instance) as T\n}\n\n/**\n * Strip internal headers from the request headers.\n *\n * @param headers the headers to strip of internal headers\n */\nexport function stripInternalHeaders(headers: IncomingHttpHeaders) {\n  for (const key of INTERNAL_HEADERS) {\n    delete headers[key]\n  }\n}\n"],"names":["stripInternalHeaders","stripInternalQueries","stripInternalSearchParams","INTERNAL_QUERY_NAMES","NEXT_RSC_UNION_QUERY","EDGE_EXTENDED_INTERNAL_QUERY_NAMES","query","name","url","isEdge","isStringUrl","instance","URL","searchParams","delete","toString","headers","key","INTERNAL_HEADERS"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;;;;;;IA+CgBA,oBAAoB;eAApBA;;IA9BAC,oBAAoB;eAApBA;;IAMAC,yBAAyB;eAAzBA;;;kCApBqB;2BACJ;AAEjC,MAAMC,uBAAuB;IAC3B;IACA;IACA;IACA;IACA;IACAC,sCAAoB;CACrB;AAED,MAAMC,qCAAqC;IAAC;CAAgB;AAErD,SAASJ,qBAAqBK,KAAyB;IAC5D,KAAK,MAAMC,QAAQJ,qBAAsB;QACvC,OAAOG,KAAK,CAACC,KAAK;IACpB;AACF;AAEO,SAASL,0BACdM,GAAM,EACNC,MAAe;IAEf,MAAMC,cAAc,OAAOF,QAAQ;IACnC,MAAMG,WAAWD,cAAc,IAAIE,IAAIJ,OAAQA;IAC/C,KAAK,MAAMD,QAAQJ,qBAAsB;QACvCQ,SAASE,YAAY,CAACC,MAAM,CAACP;IAC/B;IAEA,IAAIE,QAAQ;QACV,KAAK,MAAMF,QAAQF,mCAAoC;YACrDM,SAASE,YAAY,CAACC,MAAM,CAACP;QAC/B;IACF;IAEA,OAAQG,cAAcC,SAASI,QAAQ,KAAKJ;AAC9C;AAOO,SAASX,qBAAqBgB,OAA4B;IAC/D,KAAK,MAAMC,OAAOC,2BAAgB,CAAE;QAClC,OAAOF,OAAO,CAACC,IAAI;IACrB;AACF"}