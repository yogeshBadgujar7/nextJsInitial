{"version":3,"sources":["../../../src/server/web/globals.ts"],"sourcesContent":["declare const _ENTRIES: any\n\nasync function registerInstrumentation() {\n  const register =\n    '_ENTRIES' in globalThis &&\n    _ENTRIES.middleware_instrumentation &&\n    (await _ENTRIES.middleware_instrumentation).register\n  if (register) {\n    try {\n      await register()\n    } catch (err: any) {\n      err.message = `An error occurred while loading instrumentation hook: ${err.message}`\n      throw err\n    }\n  }\n}\n\nlet registerInstrumentationPromise: Promise<void> | null = null\nexport function ensureInstrumentationRegistered() {\n  if (!registerInstrumentationPromise) {\n    registerInstrumentationPromise = registerInstrumentation()\n  }\n  return registerInstrumentationPromise\n}\n\nfunction getUnsupportedModuleErrorMessage(module: string) {\n  // warning: if you change these messages, you must adjust how react-dev-overlay's middleware detects modules not found\n  return `The edge runtime does not support Node.js '${module}' module.\nLearn More: https://nextjs.org/docs/messages/node-module-in-edge-runtime`\n}\n\nfunction __import_unsupported(moduleName: string) {\n  const proxy: any = new Proxy(function () {}, {\n    get(_obj, prop) {\n      if (prop === 'then') {\n        return {}\n      }\n      throw new Error(getUnsupportedModuleErrorMessage(moduleName))\n    },\n    construct() {\n      throw new Error(getUnsupportedModuleErrorMessage(moduleName))\n    },\n    apply(_target, _this, args) {\n      if (typeof args[0] === 'function') {\n        return args[0](proxy)\n      }\n      throw new Error(getUnsupportedModuleErrorMessage(moduleName))\n    },\n  })\n  return new Proxy({}, { get: () => proxy })\n}\n\nfunction enhanceGlobals() {\n  // The condition is true when the \"process\" module is provided\n  if (process !== global.process) {\n    // prefer local process but global.process has correct \"env\"\n    process.env = global.process.env\n    global.process = process\n  }\n\n  // to allow building code that import but does not use node.js modules,\n  // webpack will expect this function to exist in global scope\n  Object.defineProperty(globalThis, '__import_unsupported', {\n    value: __import_unsupported,\n    enumerable: false,\n    configurable: false,\n  })\n\n  // Eagerly fire instrumentation hook to make the startup faster.\n  void ensureInstrumentationRegistered()\n}\n\nenhanceGlobals()\n"],"names":["ensureInstrumentationRegistered","registerInstrumentation","register","globalThis","_ENTRIES","middleware_instrumentation","err","message","registerInstrumentationPromise","getUnsupportedModuleErrorMessage","module","__import_unsupported","moduleName","proxy","Proxy","get","_obj","prop","Error","construct","apply","_target","_this","args","enhanceGlobals","process","global","env","Object","defineProperty","value","enumerable","configurable"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAkBgBA;;;eAAAA;;;AAhBhB,eAAeC;IACb,MAAMC,WACJ,cAAcC,cACdC,SAASC,0BAA0B,IACnC,AAAC,CAAA,MAAMD,SAASC,0BAA0B,AAAD,EAAGH,QAAQ;IACtD,IAAIA,UAAU;QACZ,IAAI;YACF,MAAMA;QACR,EAAE,OAAOI,KAAU;YACjBA,IAAIC,OAAO,GAAG,CAAC,sDAAsD,EAAED,IAAIC,OAAO,CAAC,CAAC;YACpF,MAAMD;QACR;IACF;AACF;AAEA,IAAIE,iCAAuD;AACpD,SAASR;IACd,IAAI,CAACQ,gCAAgC;QACnCA,iCAAiCP;IACnC;IACA,OAAOO;AACT;AAEA,SAASC,iCAAiCC,MAAc;IACtD,sHAAsH;IACtH,OAAO,CAAC,2CAA2C,EAAEA,OAAO;wEACU,CAAC;AACzE;AAEA,SAASC,qBAAqBC,UAAkB;IAC9C,MAAMC,QAAa,IAAIC,MAAM,YAAa,GAAG;QAC3CC,KAAIC,IAAI,EAAEC,IAAI;YACZ,IAAIA,SAAS,QAAQ;gBACnB,OAAO,CAAC;YACV;YACA,MAAM,IAAIC,MAAMT,iCAAiCG;QACnD;QACAO;YACE,MAAM,IAAID,MAAMT,iCAAiCG;QACnD;QACAQ,OAAMC,OAAO,EAAEC,KAAK,EAAEC,IAAI;YACxB,IAAI,OAAOA,IAAI,CAAC,EAAE,KAAK,YAAY;gBACjC,OAAOA,IAAI,CAAC,EAAE,CAACV;YACjB;YACA,MAAM,IAAIK,MAAMT,iCAAiCG;QACnD;IACF;IACA,OAAO,IAAIE,MAAM,CAAC,GAAG;QAAEC,KAAK,IAAMF;IAAM;AAC1C;AAEA,SAASW;IACP,8DAA8D;IAC9D,IAAIC,YAAYC,OAAOD,OAAO,EAAE;QAC9B,4DAA4D;QAC5DA,QAAQE,GAAG,GAAGD,OAAOD,OAAO,CAACE,GAAG;QAChCD,OAAOD,OAAO,GAAGA;IACnB;IAEA,uEAAuE;IACvE,6DAA6D;IAC7DG,OAAOC,cAAc,CAAC1B,YAAY,wBAAwB;QACxD2B,OAAOnB;QACPoB,YAAY;QACZC,cAAc;IAChB;IAEA,gEAAgE;IAChE,KAAKhC;AACP;AAEAwB"}